// {{{ 2 "IncludeGuard" "PragmaOnce"
#pragma once
// }} ""
#include "HSLSeqLib.hsl"
#include "HSLStrLib.hsl"
#include "HSLDevLib.hsl"
#include "HSLUtilLib.hsl"
#include "HSLUtilLib2.hsl"
#include "HSLExtensions\\File.hsl"
#include "HSLDeckVisualize.hsl"
#include "HSLExtensions\\Directory.hsl"
#include "STAR Tools\\Resources\\SubMethods\\HelperLibrary.hs_"
#include "HSL_MethodHelper.hsl"
#include "Firmware Libraries\\Channel_Query_1mL.hs_"
#include "HSLMlStarStepReturnLib.hsl"
#include "HSLFilLib.hsl"
#include "HSLExtensions\\Venus.hsl"
#include "STAR Tools\\Resources\\SubMethods\\Tip Tool Global Variables.hsl"
#include "STAR Tools\\Resources\\SubMethods\\TIP_OFFSET_GLOBAL.hsl"
#include "STAR Tools\\Resources\\SubMethods\\TipCounterGlobal.hsl"
#include "HSLErrLib.hsl"
#include "HSLExtensions\\Core.hsl"
/* {{ 2 "LibraryInsertLine" "" */ // }} ""
// {{ 2 "TemplateIncludeBlock" ""
#include "HSLMETEDLib.hs_"
#include "HSLMECCLib.hs_"
#include "HSLPTLLib.hsl"
// }} ""
// {{{ 2 "LibraryNamespace" "Begin"
namespace STAR_TIP_TOOLS {
// }} ""
/* {{ 2 "VariableInsertLine" "" */ // }} ""
// {{{ 2 "SubmethodForwardDeclaration" ""
private function ABSTRACT(  ) void ;
function BuildChannelPattern( variable i_int_NumActiveChannels, variable i_int_TotalChannels, variable & o_str_ChPattern ) void ;
function DefragTipRacks1mL( device & ML_STAR, sequence & io_seq_Tips ) void ;
function DefragTipRacks5mL( device & ML_STAR, sequence & io_seq_Tips ) void ;
function Get1mLChannelCount( device & ML_STAR, variable & o_int_Total1mLChannels ) void ;
function Get5mLChannelCount( device & ML_STAR, variable & o_int_Total5mLChannels ) void ;
function GetTipCounter( device & ML_STAR, sequence & io_seqTips, variable & o_strTipCounter ) void ;
function GetTipType( device & Instrument, sequence i_seq_Tips, variable & o_int_TipType ) void ;
function Optimized1mLTipPickup( device & ML_STAR, sequence & io_seq_TipSequence, sequence i_seq_ControlSequence, variable i_str_TipCounter, variable & o_str_ChannelPattern ) void ;
function Optimized1mLTipPickup2( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_str_ChannelPattern ) void ;
function Optimized5mLTipPickup( device & ML_STAR, sequence & io_seq_TipSequence, sequence i_seq_ControlSequence, variable i_str_TipCounter, variable & o_str_ChannelPattern ) void ;
function Optimized5mLTipPickup2( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_str_ChannelPattern ) void ;
function ResetInputSequence( device & Instrument, sequence & io_seq_SequenceToReset ) void ;
function TipCapacityCheck( device & Instrument, sequence i_seq_TipsToCheck, variable & o_flt_TipCapacity ) void ;
function TipCheck( device & Instrument, sequence & io_seq_Tips, variable i_str_TipCounter, variable i_int_TipsNeeded ) void ;
function TipCheck2( device & Instrument, sequence & io_seq_Tips, sequence & i_seq_ControlSequence, variable i_str_TipCounter ) void ;
function TipCheckMPH96( device & Instrument, sequence & io_seq_Tips, variable i_str_TipCounter ) void ;
function TipCountNeeded_Add( variable i_str_TipCounter, variable i_int_NumberOfTips ) void ;
function TipCountNeeded_Get( variable i_str_TipCounter, variable & o_int_NumberOfTips ) void ;
function TipCountNeeded_Reset( variable i_str_TipCounter ) void ;
function TipCounter_Edit( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_int_TimeOut ) void ;
function TipCounter_Read( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter ) void ;
function TipCounter_SetShow( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_int_TimeOut, variable i_int_StartPosition, variable i_int_EndPosition ) void ;
function TipCounter_Write( device & ML_STAR, sequence i_seq_TipSequence, variable i_str_TipCounter ) void ;
function TipTypeCheck1mL( device & ML_STAR, variable i_str_ReturnFromTipPickUp, sequence & o_seq_IncorrectTipReturn, variable & o_str_IncorrectChannels ) variable ;
function TipTypeLength_Get( variable i_int_TipType, variable & o_flt_TipLength ) void ;
private function _ConvertChannelPatternToArray( variable i_str_ChannelPattern, variable & o_arr_ChannelPatternArray[] ) void ;
private function _ConvertToInteger( variable & io_Value ) void ;
private function _DetermineTipCheckLC( variable i_int_TipType, variable & o_str_LiquidClass, variable & o_flt_CheckVolume ) void ;
private function _GetCurrentPosition( device & Instrument, sequence i_seq_Labware, variable & o_flt_X_Coord, variable & o_flt_Y_Coord, variable & o_flt_Z_Coord ) void ;
private function _GetSequenceName( device & Instrument, sequence i_seq_SequenceToCheck, variable & o_strSequenceName, variable & o_intTotalPositions ) void ;
private function _GetSequencePosition( device & Instrument, sequence i_seq_LabwareSequence, variable & o_str_LabID, variable & o_str_PosID ) variable ;
private function _GetTipCounterFolderPath( variable & o_str_TipCounterFolder ) void ;
private function _GetTipCounterName( variable i_strInstrumentClass, variable i_intTipType, variable & o_strTipCounterName ) variable ;
private function _GetTipType( device & Instrument, variable i_str_LabwareID, variable & o_int_TipType ) void ;
private function _LocalTipCounterRead( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter ) void ;
private function _Lookup( variable & array[], variable item ) variable ;
private function _RemoveInvalidCharacters( variable & io_str_Value ) void ;
private function _SortSequenceLabIDXY( device & Instrument, sequence & io_Sequence ) void ;
private function _SortSequenceYPriority( device & Instrument, sequence & io_Sequence ) void ;
// }} ""
function _InitLibrary() {
// {{ 2 "AutoInitBlock" ""
PTL::SetWashingStateDefault("RinseTime1", 5);
PTL::SetWashingStateDefault("SoakTime1", 5);
PTL::SetWashingStateDefault("FlowRate1", 11);
PTL::SetWashingStateDefault("RinseTime2", 0);
PTL::SetWashingStateDefault("SoakTime2", 0);
PTL::SetWashingStateDefault("FlowRate2", 11);
PTL::SetWashingStateDefault("DrainingTime", 10);
PTL::SetWashingStateDefault("StartWashLiquid", 0);
PTL::SetLoadingStateDefault("RecoveryOptionContinue", hslTrue);
PTL::SetLoadingStateDefault("RecoveryOptionExclude", hslTrue);
PTL::SetLoadingStateDefault("RecoveryOptionDefault", 0);
PTL::SetLoadingStateDefault("KitLotCheckEnabled", hslFalse);
HELPERLIBRARY::_InitLibrary();
CHANNEL_QUERY_1ML::_InitLibrary();
// }} ""
}
function _ExitLibrary() {
// {{ 2 "AutoExitBlock" ""
HELPERLIBRARY::_ExitLibrary();
CHANNEL_QUERY_1ML::_ExitLibrary();
// }} ""
}
// {{{ 5 "TipCheck" "Begin"
function TipCheck( device & Instrument, sequence & io_seq_Tips, variable i_str_TipCounter, variable i_int_TipsNeeded ) void {
// }} ""
private dialog customDialog744B3B2C09884d30895B6C1E10766D83;
private variable int_CurrentPosition;
private variable flt_TipCapacity;
private variable str_TipMessage;
private variable int_EndPosition;
private variable int_PositionsRemaining;
private variable str_TipName;
// {{ 5 "TipCheck" "InitLocals"
// }} ""
// {{ 894 1 0 "20d37af7_42c5_48c0_9b1eb8cb1c1a2f59" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========  Check tip sequence"));
// }} ""
// {{{ 895 1 0 "63e247f5_0586_4d9d_a36642a258643532" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(Instrument, io_seq_Tips, flt_TipCapacity);
// }} ""
// {{ 896 1 0 "2b82175b_83a7_405c_b65a34b9e46e1f7a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 897 1 0 "97c669f0_8796_4282_aa21d0c8886c6ff8" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 898 1 0 "2b82175b_83a7_405c_b65a34b9e46e1f7a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 899 1 0 "a4d9de3d_e1fa_4433_9711e4672f229117" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 900 1 0 "f1e6b1d8_ad4a_414c_9d2828c43525b7c2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 901 1 0 "4f61a638_dc22_415e_90249e60c9404ebc" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (1 == 1)
{
// }} ""
// {{ 902 1 0 "bedb9fca_3f54_424f_9beb5aa63d090b89" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
int_CurrentPosition = io_seq_Tips.GetCurrentPosition();
// }} ""
// {{ 903 1 0 "577ff63b_1195_4960_8add66ffd1685d64" "{B31F353D-5D80-11d4-A5EB-0050DA737D89}"
int_EndPosition = io_seq_Tips.GetCount();
// }} ""
// {{ 904 1 0 "9e95efd9_a298_485e_94ce963cebf5590d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_CurrentPosition == 0)
{
// }} ""
// {{ 905 1 0 "7be0ed57_06b1_4154_810e771cec107ef0" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_CurrentPosition = int_EndPosition + 1;
// }} ""
// {{ 906 1 0 "9e95efd9_a298_485e_94ce963cebf5590d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 907 1 0 "390dc4f6_5aba_4b6c_b5160d53bb1b367e" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_PositionsRemaining = int_EndPosition - int_CurrentPosition;
// }} ""
// {{ 908 1 0 "6dec19df_5a08_4ebf_b461f0944afd0f6c" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_PositionsRemaining = int_PositionsRemaining + 1;
// }} ""
Trace("     ","Positions Remaining:  ",int_PositionsRemaining,"  Tips Needed:  ",i_int_TipsNeeded);
// {{ 910 1 0 "7afdb781_322b_4b3d_97a69d64f7288f41" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_PositionsRemaining >= i_int_TipsNeeded)
{
// }} ""
// {{ 911 1 0 "ca4a590d_1794_49ff_ab921d0335ea1632" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Sufficient tips found"));
// }} ""
// {{ 912 1 0 "90bd48f4_6428_4e24_8aee6ffc6a4f080d" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 913 1 0 "7afdb781_322b_4b3d_97a69d64f7288f41" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 914 1 0 "6e5eb41e_94d9_4526_bb1d3eae47ceefab" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{ 915 1 0 "0c2c9630_1875_4875_b86fdd57f5b7d89c" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialog744B3B2C09884d30895B6C1E10766D83.InitCustomDialog( "0c2c9630_1875_4875_b86fdd57f5b7d89c" );
customDialog744B3B2C09884d30895B6C1E10766D83.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialog744B3B2C09884d30895B6C1E10766D83.ShowCustomDialog();
// }} ""
// {{ 916 1 0 "1f4a57a0_cacd_41df_bdc4b6ea0bf34b8c" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 917 1 0 "f6a95e2b_32b5_4661_ad84020c5f275a15" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(Instrument, io_seq_Tips);
// }} ""
// {{{ 918 1 0 "ab819147_6041_403b_9a5582b2ec5c45b9" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(Instrument, io_seq_Tips, i_str_TipCounter, 99999);
// }} ""
// {{ 919 1 0 "4f61a638_dc22_415e_90249e60c9404ebc" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{{ 5 "TipCheck" "End"
}
// }} ""
// {{{ 5 "TipCapacityCheck" "Begin"
function TipCapacityCheck( device & Instrument, sequence i_seq_TipsToCheck, variable & o_flt_TipCapacity ) void {
// }} ""
private variable int_TipType;
// {{ 5 "TipCapacityCheck" "InitLocals"
o_flt_TipCapacity = 0;
// }} ""
// {{{ 834 1 0 "5acd7023_0bc7_4818_a40d7eee380ae8fb" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
GetTipType(Instrument, i_seq_TipsToCheck, int_TipType);
// }} ""
// {{ 835 1 0 "37df6113_b1bb_4b34_98674dde094046e2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 0.0;
// }} ""
// {{ 836 1 0 "724c9f85_2cca_4894_8cce089cf2a93cdc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 0)
{
// }} ""
// {{ 837 1 0 "8408eb6a_f7f6_4568_8ab27c31bfd4ecc1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 300;
// }} ""
// {{ 838 1 0 "724c9f85_2cca_4894_8cce089cf2a93cdc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 839 1 0 "1dac2fb5_ead3_4171_bd8fe83671f7b0e6" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 1)
{
// }} ""
// {{ 840 1 0 "eaf49332_c626_4ceb_abc2be7cc5fdaa7b" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 300;
// }} ""
// {{ 841 1 0 "1dac2fb5_ead3_4171_bd8fe83671f7b0e6" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 842 1 0 "7ddcede3_2194_4d3e_a0af4fccd289f5b1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 2)
{
// }} ""
// {{ 843 1 0 "727368dc_e86f_49eb_b112f5f419cb9068" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 10;
// }} ""
// {{ 844 1 0 "7ddcede3_2194_4d3e_a0af4fccd289f5b1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 845 1 0 "31f0cab2_97cb_4606_b745604b1f0ee009" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 3)
{
// }} ""
// {{ 846 1 0 "f7fe5c37_0cee_499c_88d2128f371c3017" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 10;
// }} ""
// {{ 847 1 0 "31f0cab2_97cb_4606_b745604b1f0ee009" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 848 1 0 "08de228d_2737_433d_8c932fc0e355e4f7" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 4)
{
// }} ""
// {{ 849 1 0 "6dbf9b76_76a1_459f_aae8e57f05aa6295" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 1000;
// }} ""
// {{ 850 1 0 "08de228d_2737_433d_8c932fc0e355e4f7" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 851 1 0 "6c5b9b89_199f_46dc_81db24f9799e403a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 5)
{
// }} ""
// {{ 852 1 0 "0be9e9f8_719f_4af2_945ba2962af931b3" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 1000;
// }} ""
// {{ 853 1 0 "6c5b9b89_199f_46dc_81db24f9799e403a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 854 1 0 "43a56000_861c_4a8e_9aebcd2ef238b710" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 25)
{
// }} ""
// {{ 855 1 0 "67c8a424_42ad_4c34_8d7732b8950d6ff6" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 5000;
// }} ""
// {{ 856 1 0 "43a56000_861c_4a8e_9aebcd2ef238b710" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 857 1 0 "348f5714_4a67_43a7_99537d603cd64168" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 20)
{
// }} ""
// {{ 858 1 0 "5a0d6660_968b_46d4_a5177a28e06729b2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 859 1 0 "348f5714_4a67_43a7_99537d603cd64168" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 860 1 0 "869425a9_fd1c_45a8_ad838092abf4c1c2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 22)
{
// }} ""
// {{ 861 1 0 "3b42329e_767a_41ae_85e86cf971d71c6b" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 862 1 0 "869425a9_fd1c_45a8_ad838092abf4c1c2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 863 1 0 "b13534c9_52f0_428d_bb048803ae5c1413" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 23)
{
// }} ""
// {{ 864 1 0 "6ddbcac7_6a8a_44d1_80db1aec63ad9c50" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 865 1 0 "b13534c9_52f0_428d_bb048803ae5c1413" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 866 1 0 "0c6b1023_f259_466a_acf8bc85bb57b18d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 28)
{
// }} ""
// {{ 867 1 0 "2b0a806f_1243_41c1_a570191f55d33c4d" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 300;
// }} ""
// {{ 868 1 0 "0c6b1023_f259_466a_acf8bc85bb57b18d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 869 1 0 "442b682a_875c_4b80_8a92043330ba6a19" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 29)
{
// }} ""
// {{ 870 1 0 "1e696872_ed22_4e82_b4e8fe64209d3780" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 4000;
// }} ""
// {{ 871 1 0 "442b682a_875c_4b80_8a92043330ba6a19" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 872 1 0 "c664b7fd_b641_4157_a175988142334859" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 30)
{
// }} ""
// {{ 873 1 0 "6a559380_270a_463f_a4c9ffffbd3aac55" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 300;
// }} ""
// {{ 874 1 0 "c664b7fd_b641_4157_a175988142334859" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 875 1 0 "81e5aaad_5b17_42dd_82c0aa96f359bb6b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 31)
{
// }} ""
// {{ 876 1 0 "e9e6cde7_2966_498b_a40e4102e29a8f9b" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 877 1 0 "81e5aaad_5b17_42dd_82c0aa96f359bb6b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 878 1 0 "d6b2320f_a55d_4119_b661b7a6694547c0" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 32)
{
// }} ""
// {{ 879 1 0 "cfb248a3_ef4f_4893_aa23e8316f7f3df9" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 10;
// }} ""
// {{ 880 1 0 "d6b2320f_a55d_4119_b661b7a6694547c0" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 881 1 0 "a3f2a355_5919_461d_b35612d57a875ad2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 33)
{
// }} ""
// {{ 882 1 0 "41cbb26e_0dea_4756_89fa27da92edaf93" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 883 1 0 "a3f2a355_5919_461d_b35612d57a875ad2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 884 1 0 "66ce6902_021f_4ed5_b7c68dcee1321ef9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 37)
{
// }} ""
// {{ 885 1 0 "a1364e46_b2f5_44df_aeb2979d9cfb2373" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 886 1 0 "66ce6902_021f_4ed5_b7c68dcee1321ef9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 887 1 0 "62447ab4_a62c_43f0_8f887f9487e1d044" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 54)
{
// }} ""
// {{ 888 1 0 "5f273041_192d_4578_abf220be5035a7bf" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 889 1 0 "62447ab4_a62c_43f0_8f887f9487e1d044" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 890 1 0 "d2f4c43d_25ea_49f9_a20daa15a34fea3b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipType == 55)
{
// }} ""
// {{ 891 1 0 "48a7c3cd_0410_4191_b95b13185027b7f0" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipCapacity = 50;
// }} ""
// {{ 892 1 0 "d2f4c43d_25ea_49f9_a20daa15a34fea3b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "TipCapacityCheck" "End"
}
// }} ""
// {{{ 5 "ResetInputSequence" "Begin"
function ResetInputSequence( device & Instrument, sequence & io_seq_SequenceToReset ) void {
// }} ""
// {{ 5 "ResetInputSequence" "InitLocals"
// }} ""
{
   Instrument.CopyResetSequence(io_seq_SequenceToReset.GetName(),io_seq_SequenceToReset);
}
// {{{ 5 "ResetInputSequence" "End"
}
// }} ""
// {{{ 5 "_GetTipType" "Begin"
private function _GetTipType( device & Instrument, variable i_str_LabwareID, variable & o_int_TipType ) void {
// }} ""
private variable str_TipType;
private variable l_blnLabwareValid;
// {{ 5 "_GetTipType" "InitLocals"
o_int_TipType = 0;
// }} ""
// {{ 1505 1 0 "1a62786f_584f_4f26_bc4065d566fd5dc1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_int_TipType = Translate("");
// }} ""
// {{{ 1506 1 0 "bc306722_b1e3_432a_b658f38829d79187" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_blnLabwareValid = DevIsValidLabwareForCurrentDeckLayout(Instrument, i_str_LabwareID);
// }} ""
// {{ 1507 1 0 "82438236_d020_4d53_95dd022cad4935e5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_blnLabwareValid == BOOLEON::FALSE)
{
// }} ""
// {{ 1508 1 0 "f024f1e9_464d_46ed_95d53b187d6f838e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_int_TipType = -1;
// }} ""
// {{{ 1509 1 0 "1500461c_2a44_48af_a1694bfdaf4b3ad8" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return;
// }} ""
// {{ 1510 1 0 "82438236_d020_4d53_95dd022cad4935e5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1511 1 0 "4068be5b_0aae_4eda_a54f5aa22e6cdb02" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
onerror goto errLabel_249D904FC42842d08D85570423A0E5BA ;
err.Clear();
// }} ""
// {{{ 1512 1 0 "4b95e849_d3be_426d_9f1f42456398debf" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipType = DevGetLabwareData(Instrument, i_str_LabwareID, Translate("MlStarTipRack"));
// }} ""
// {{ 1513 1 0 "4068be5b_0aae_4eda_a54f5aa22e6cdb02" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
errLabel_249D904FC42842d08D85570423A0E5BA : {}
onerror goto 0;
if (err.GetId() != 0)   /* skip handler if no error */
{
// }} ""
// {{ 1514 1 0 "4068be5b_0aae_4eda_a54f5aa22e6cdb02" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
}   /* end if from skip handler if no error */
// }} ""
// {{ 1515 1 0 "11116cbc_4610_436d_86e9b81132d467db" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (str_TipType == "")
{
// }} ""
// {{ 1516 1 0 "656fb1d7_8840_431f_83859534bbac8c8c" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
onerror goto errLabel_D141C798D15C4da1BB545B0D45A22EA9 ;
err.Clear();
// }} ""
// {{{ 1517 1 0 "9d205585_76a4_4de6_9da35d7ca9aada09" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipType = DevGetLabwareData(Instrument, i_str_LabwareID, Translate("MlStarXLTipRack"));
// }} ""
// {{ 1518 1 0 "656fb1d7_8840_431f_83859534bbac8c8c" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
errLabel_D141C798D15C4da1BB545B0D45A22EA9 : {}
onerror goto 0;
if (err.GetId() != 0)   /* skip handler if no error */
{
// }} ""
// {{ 1519 1 0 "656fb1d7_8840_431f_83859534bbac8c8c" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
}   /* end if from skip handler if no error */
// }} ""
// {{ 1520 1 0 "11116cbc_4610_436d_86e9b81132d467db" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1521 1 0 "f381c6f2_d3ed_4d7d_8e91422dbecea2c8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (str_TipType == "")
{
// }} ""
// {{ 1522 1 0 "d2c01c5e_8c79_47c5_995b443342752764" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
str_TipType = Translate("-1");
// }} ""
// {{ 1523 1 0 "f381c6f2_d3ed_4d7d_8e91422dbecea2c8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1524 1 0 "47b74f62_3bdc_49b1_93c1c75427714546" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_int_TipType = StrIVal(str_TipType);
// }} ""
// {{{ 5 "_GetTipType" "End"
}
// }} ""
// {{{ 5 "TipCheck2" "Begin"
function TipCheck2( device & Instrument, sequence & io_seq_Tips, sequence & i_seq_ControlSequence, variable i_str_TipCounter ) void {
// }} ""
private dialog customDialogC77B630404D944d48FC1D9E60E9120AE;
private variable int_CurrentPosition;
private variable flt_TipCapacity;
private variable str_TipMessage;
private variable int_EndPosition;
private variable int_PositionsRemaining;
private variable str_TipName;
private variable int_TipsNeeded;
// {{ 5 "TipCheck2" "InitLocals"
// }} ""
// {{ 921 1 0 "4736cee6_e877_4bd3_9dab579c996cd4c9" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========  Check tip sequence"));
// }} ""
// {{{ 922 1 0 "33703ccc_8702_4a1f_8224a143d99a0d4e" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(Instrument, io_seq_Tips, flt_TipCapacity);
// }} ""
// {{{ 923 1 0 "22eb11e1_681f_43b6_8421142de2b98378" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(Instrument, i_seq_ControlSequence);
// }} ""
// {{{ 924 1 0 "bf1ffab2_f375_4cc3_a5cf98832a6901a0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TipsNeeded = SeqGetTotal(i_seq_ControlSequence);
// }} ""
// {{ 925 1 0 "576f3a55_a08d_4eed_add6b834981efa2e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 926 1 0 "016dea6a_3902_4c64_b523dcaa413a22e3" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 927 1 0 "576f3a55_a08d_4eed_add6b834981efa2e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 928 1 0 "cb9fbc97_cf2f_460c_9ece6b7f33304065" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 929 1 0 "e3dec0ce_3629_4018_b7751a308318793d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 930 1 0 "f82fd335_b558_48a7_97cf2a3bb688add1" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (1 == 1)
{
// }} ""
// {{ 931 1 0 "96a9a49f_bc5e_4a94_89197d407b8c6616" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
int_CurrentPosition = io_seq_Tips.GetCurrentPosition();
// }} ""
// {{ 932 1 0 "c47e33a2_9ca3_4182_87fb1c1bd734c23f" "{B31F353D-5D80-11d4-A5EB-0050DA737D89}"
int_EndPosition = io_seq_Tips.GetCount();
// }} ""
// {{ 933 1 0 "ab5c1ebd_39b1_425b_82dfb88ab28f038b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_CurrentPosition == 0)
{
// }} ""
// {{ 934 1 0 "a4dab5a2_9cb3_4d18_b661bd9c85c6f4f6" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_CurrentPosition = int_EndPosition + 1;
// }} ""
// {{ 935 1 0 "ab5c1ebd_39b1_425b_82dfb88ab28f038b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 936 1 0 "155d00a8_ea31_4c0a_bb5ff6e4e869ad6c" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_PositionsRemaining = int_EndPosition - int_CurrentPosition;
// }} ""
// {{ 937 1 0 "bbe4b0ae_bb9e_4357_b695588d2526ca0b" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_PositionsRemaining = int_PositionsRemaining + 1;
// }} ""
Trace("     ","Positions Remaining:  ",int_PositionsRemaining,"  Tips Needed:  ",int_TipsNeeded);
// {{ 939 1 0 "8b02d45b_8c78_4d75_97fa5483577a55b5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_PositionsRemaining >= int_TipsNeeded)
{
// }} ""
// {{ 940 1 0 "10618e24_5bac_4198_a70bbe9df1b5a27b" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Sufficient tips found"));
// }} ""
// {{ 941 1 0 "617073f9_b4fc_4cc9_8b3f6c207326161d" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 942 1 0 "8b02d45b_8c78_4d75_97fa5483577a55b5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 943 1 0 "91677878_bede_4129_a82bf7e848502029" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{ 944 1 0 "19498ec0_f9c5_4ff4_9cc05772164c8178" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialogC77B630404D944d48FC1D9E60E9120AE.InitCustomDialog( "19498ec0_f9c5_4ff4_9cc05772164c8178" );
customDialogC77B630404D944d48FC1D9E60E9120AE.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialogC77B630404D944d48FC1D9E60E9120AE.ShowCustomDialog();
// }} ""
// {{ 945 1 0 "7dea5860_6031_4660_85e364c9dbee12d6" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 946 1 0 "8ae5f50d_72aa_4f79_a637a7612e918fcd" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(Instrument, io_seq_Tips);
// }} ""
// {{{ 947 1 0 "16538be0_8312_4d59_9ad21593ca89a7c7" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(Instrument, io_seq_Tips, i_str_TipCounter, 99999);
// }} ""
// {{ 948 1 0 "f82fd335_b558_48a7_97cf2a3bb688add1" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{{ 5 "TipCheck2" "End"
}
// }} ""
// {{{ 5 "_GetSequencePosition" "Begin"
private function _GetSequencePosition( device & Instrument, sequence i_seq_LabwareSequence, variable & o_str_LabID, variable & o_str_PosID ) variable {
// }} ""
private variable bool_SequenceValid;
// {{ 5 "_GetSequencePosition" "InitLocals"
o_str_LabID = 0;
o_str_PosID = 0;
// }} ""
// {{ 1464 1 0 "0249bdb6_b139_41cb_b2354a27f1af9e08" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bool_SequenceValid = 1;
// }} ""
// {{ 1465 1 0 "be7c9f6e_511b_4b3b_927db8e1b6b7c988" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LabID = Translate("");
// }} ""
// {{ 1466 1 0 "9519998c_8f23_4ebe_a5c4eabad32bdee9" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_PosID = Translate("");
// }} ""
// {{ 1467 1 0 "d6eba368_eae1_40a7_b6c5bf2155532bbc" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
onerror goto errLabel_C92BECA6FC3E4dd1A039451E8CBA8702 ;
err.Clear();
// }} ""
// {{{ 1468 1 0 "ed639d40_4467_449e_8c1965227cc90d90" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_str_LabID = SeqGetLabwareId(i_seq_LabwareSequence);
// }} ""
// {{{ 1469 1 0 "3a779886_b181_4f86_b281e0015d5a8887" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_str_PosID = SeqGetPositionId(i_seq_LabwareSequence);
// }} ""
// {{ 1470 1 0 "700d58a9_2c2d_4489_90baf6f1d2d2c315" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (o_str_LabID == "")
{
// }} ""
// {{ 1471 1 0 "832a1752_998e_4f49_b857e0996e0a52a6" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bool_SequenceValid = 0;
// }} ""
// {{ 1472 1 0 "700d58a9_2c2d_4489_90baf6f1d2d2c315" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1473 1 0 "d6eba368_eae1_40a7_b6c5bf2155532bbc" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
errLabel_C92BECA6FC3E4dd1A039451E8CBA8702 : {}
onerror goto 0;
if (err.GetId() != 0)   /* skip handler if no error */
{
// }} ""
// {{ 1474 1 0 "05939dc1_2f24_494c_ac724dd879d8829d" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bool_SequenceValid = 0;
// }} ""
// {{ 1475 1 0 "d6eba368_eae1_40a7_b6c5bf2155532bbc" "{3293659E-F71E-472f-AFB4-6A674E32B114}"
}   /* end if from skip handler if no error */
// }} ""
// {{{ 1476 1 0 "c6bd0d6f_3f6c_45e5_82a0cfed313836ec" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (bool_SequenceValid);
// }} ""
// {{{ 5 "_GetSequencePosition" "End"
}
// }} ""
// {{{ 5 "_Lookup" "Begin"
private function _Lookup( variable & array[], variable item ) variable {
// }} ""
private variable index;
private variable lookupreturn;
// {{ 5 "_Lookup" "InitLocals"
// }} ""
// {{{ 1544 1 0 "129b6c75_8a30_4682_891d77ee018a8969" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
lookupreturn = Util::Lookup(array, item, index);
// }} ""
// {{ 1545 1 0 "09b67dfd_0ac1_4981_94acbe252ef1c89a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (lookupreturn > 0)
{
// }} ""
// {{ 1546 1 0 "0792c953_6291_43b9_b3e04048cc84bda3" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
index = index + 1;
// }} ""
// {{{ 1547 1 0 "54f7927e_06fa_4cbc_a833d020c1a302b0" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (index);
// }} ""
// {{ 1548 1 0 "09b67dfd_0ac1_4981_94acbe252ef1c89a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1549 1 0 "a9b6bd42_a2f2_4a14_997e6d861f6512e6" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (0);
// }} ""
// {{ 1550 1 0 "09b67dfd_0ac1_4981_94acbe252ef1c89a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "_Lookup" "End"
}
// }} ""
// {{{ 5 "Get1mLChannelCount" "Begin"
function Get1mLChannelCount( device & ML_STAR, variable & o_int_Total1mLChannels ) void {
// }} ""
// {{ 5 "Get1mLChannelCount" "InitLocals"
o_int_Total1mLChannels = 0;
// }} ""
// {{ 334 1 0 "f1adfa2b_bfab_48fc_9b2b3743d272cb59" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_int_Total1mLChannels = 0;
// }} ""
// {{{ 335 1 0 "c462871e_4083_4a4a_8378cfa7b56dc0c0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_int_Total1mLChannels = DevGetCfgValueWithKey(ML_STAR, 1);
// }} ""
// {{{ 5 "Get1mLChannelCount" "End"
}
// }} ""
// {{{ 5 "Get5mLChannelCount" "Begin"
function Get5mLChannelCount( device & ML_STAR, variable & o_int_Total5mLChannels ) void {
// }} ""
// {{ 5 "Get5mLChannelCount" "InitLocals"
o_int_Total5mLChannels = 0;
// }} ""
// {{ 337 1 0 "0d81e43a_6414_4bc8_ad29c300dd89c06f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_int_Total5mLChannels = 0;
// }} ""
// {{{ 338 1 0 "0d3a874c_ede8_4602_aca172efcb0ce4fb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_int_Total5mLChannels = DevGetCfgValueWithKey(ML_STAR, 43);
// }} ""
// {{{ 5 "Get5mLChannelCount" "End"
}
// }} ""
// {{{ 5 "BuildChannelPattern" "Begin"
function BuildChannelPattern( variable i_int_NumActiveChannels, variable i_int_TotalChannels, variable & o_str_ChPattern ) void {
// }} ""
// {{ 5 "BuildChannelPattern" "InitLocals"
o_str_ChPattern = 0;
// }} ""
// {{ 3 1 0 "442a541c_055c_4e82_b21b38f292913dae" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_ChPattern = Translate("");
// }} ""
// {{{ 4 1 0 "45fca93e_eaf0_4dff_9a1504f672d39516" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_str_ChPattern = StrFillLeft(o_str_ChPattern, Translate("1"), i_int_NumActiveChannels);
// }} ""
// {{{ 5 1 0 "4d3d06fe_ee44_452a_b5145e7af635479a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_str_ChPattern = StrFillRight(o_str_ChPattern, Translate("0"), i_int_TotalChannels);
// }} ""
// {{{ 6 1 0 "dc336566_fb85_43d1_b6c4a860e4677917" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_str_ChPattern = StrLeft(o_str_ChPattern, i_int_TotalChannels);
// }} ""
// {{{ 5 "BuildChannelPattern" "End"
}
// }} ""
// {{{ 5 "_GetCurrentPosition" "Begin"
private function _GetCurrentPosition( device & Instrument, sequence i_seq_Labware, variable & o_flt_X_Coord, variable & o_flt_Y_Coord, variable & o_flt_Z_Coord ) void {
// }} ""
private variable flt_NotUsed;
private variable str_LabID;
private variable bool_SequenceValid;
private variable str_PosID;
// {{ 5 "_GetCurrentPosition" "InitLocals"
o_flt_X_Coord = 0;
o_flt_Y_Coord = 0;
o_flt_Z_Coord = 0;
// }} ""
// {{{ 1454 1 0 "5aa4ba6d_f9b3_4e88_8a0c5ccfc77d66f6" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
bool_SequenceValid = _GetSequencePosition(Instrument, i_seq_Labware, str_LabID, str_PosID);
// }} ""
// {{ 1455 1 0 "799ecc9e_7a16_4a47_813bd0db1910a670" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_X_Coord = 0.0;
// }} ""
// {{ 1456 1 0 "5e11b1c1_141d_418f_88d64f1b5cb19b95" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_Y_Coord = 0.0;
// }} ""
// {{ 1457 1 0 "67ec7b16_2230_402e_8a5ab9f70f1a9855" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_Z_Coord = 0.0;
// }} ""
// {{{ 1458 1 0 "6a8c5ab9_e14f_4879_98fe65f7f0c53726" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevGetLabwarePositionEx(Instrument, str_LabID, str_PosID, o_flt_X_Coord, o_flt_Y_Coord, o_flt_Z_Coord, flt_NotUsed);
// }} ""
// {{{ 5 "_GetCurrentPosition" "End"
}
// }} ""
// {{{ 5 "_ConvertChannelPatternToArray" "Begin"
private function _ConvertChannelPatternToArray( variable i_str_ChannelPattern, variable & o_arr_ChannelPatternArray[] ) void {
// }} ""
private variable int_NumChannels;
private variable i;
private variable str_CurrentValue;
private variable a;
// {{ 5 "_ConvertChannelPatternToArray" "InitLocals"
o_arr_ChannelPatternArray.SetSize( 0);
// }} ""
// {{{ 1404 1 0 "06b2f1a7_0b1f_4d1d_a1aeae59c574c897" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_NumChannels = StrGetLength(i_str_ChannelPattern);
// }} ""
// {{ 1405 1 0 "6ac43b49_c568_46bf_83f054a8bd1bba22" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
o_arr_ChannelPatternArray.SetSize(int_NumChannels);
// }} ""
// {{ 1406 1 0 "bd3240ad_3177_4f85_a8b8a3083c93e7e7" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(i = 0; i < int_NumChannels;)
{
i = i + 1;
// }} ""
// {{ 1407 1 0 "fdc2ba4a_66c3_49c2_8ecc79882c713937" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
a = i - 1;
// }} ""
// {{{ 1408 1 0 "a405cdf6_c7ad_4e71_af8ee101dc14539d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_CurrentValue = StrMid(i_str_ChannelPattern, a, 1);
// }} ""
// {{ 1409 1 0 "d2b4e568_34eb_45b8_9bbb48165db274cf" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
o_arr_ChannelPatternArray.SetAt(i-1, str_CurrentValue);
// }} ""
// {{ 1410 1 0 "bd3240ad_3177_4f85_a8b8a3083c93e7e7" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{{ 5 "_ConvertChannelPatternToArray" "End"
}
// }} ""
// {{{ 5 "TipCounter_Read" "Begin"
function TipCounter_Read( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter ) void {
// }} ""
private variable _strFunctionName;
private variable l_strSequenceName;
private variable l_intTotalPositions;
private variable l_intAvailable;
private variable l_strError;
private variable l_strInstrumentClass;
private variable l_intTipType;
private variable l_strLabID;
private variable l_intEmptyCheck;
// {{ 5 "TipCounter_Read" "InitLocals"
// }} ""
// {{ 1080 1 0 "6117d2c7_9d78_4ed0_b367fe38cce076fe" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1081 1 0 "0ed1b0a9_4cc9_4bfd_862bd4b5f712346f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 1083 1 0 "355f8269_db9a_452a_b1e8760e7dabfead" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 1084 1 0 "6117d2c7_9d78_4ed0_b367fe38cce076fe" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1085 1 0 "53837490_2f1f_401f_a9cc15c489052470" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_OFFSET_GLOBAL::INIT::InitializeVariables();
// }} ""
// {{{ 1086 1 0 "c01f5a4f_1fa5_4baa_8872152538320f96" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::InitTipCountingLibrary();
// }} ""
// {{{ 1087 1 0 "71f58ffa_fa1c_430d_b30d954c9dddc95b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_TipCounter = StrConcat2(i_str_TipCounter, Translate(""));
// }} ""
// {{ 1088 1 0 "eebba49d_5c03_4e96_b039eabe3397576c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_str_TipCounter == "")
{
// }} ""
// {{{ 1089 1 0 "d33584ba_f81d_431e_99b8e85339d54452" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strError = StrConcat4(Translate("Tip counter '"), i_str_TipCounter, Translate("' is invalid!"), Translate(""));
// }} ""
// {{{ 1090 1 0 "1640eb03_b351_4c45_812694e5e1add217" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
ErrRaise(101, l_strError);
// }} ""
// {{ 1091 1 0 "eebba49d_5c03_4e96_b039eabe3397576c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 1092 1 0 "a0032f9c_f15d_4d7b_94aebc13d05c60ff" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(io_seq_TipSequence);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 1093 1 0 "21128557_40e2_4386_ad4e2c3b10f8da13" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
l_strLabID = Translate("");
// }} ""
// {{ 1094 1 0 "f2f910f6_dacd_432d_809d8ccfa157dfe9" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
l_intEmptyCheck = io_seq_TipSequence.GetCurrentPosition();
// }} ""
{
   sequence sequenceObj;

   ML_STAR.CopyResetSequence(io_seq_TipSequence.GetName(), sequenceObj);
   l_strLabID = sequenceObj.GetLabwareId();

   //if(l_intEmptyCheck == 0) ML_STAR.CopyResetSequence(io_seq_TipSequence.GetName(), io_seq_TipSequence);
}
// {{{ 1096 1 0 "0d20fe9a_9419_4d9c_a92eb674a2e0084e" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetSequenceName(ML_STAR, io_seq_TipSequence, l_strSequenceName, l_intTotalPositions);
// }} ""
// {{{ 1097 1 0 "63d8bc89_903e_4479_be6bd3964142cad4" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(ML_STAR, l_strLabID, l_intTipType);
// }} ""
// {{ 1098 1 0 "5795afa1_b0d2_4c24_a57fbd05f1563135" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_intTipType != -1)
{
// }} ""
// {{{ 1099 1 0 "e1e16609_cdf1_4d3e_a370fbdf42c04031" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strInstrumentClass = DevGetInstrumentName(ML_STAR);
// }} ""
// {{{ 1100 1 0 "89ff3037_39d2_47f6_9579049e418d2af9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CheckTipCounterName(i_str_TipCounter);
// }} ""
// {{{ 1101 1 0 "7effbb23_b214_4c00_addd965d3373a886" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Read tip counter:  "), i_str_TipCounter);
// }} ""
// {{{ 1102 1 0 "cd3bedc5_c20e_4d93_8bfadb78b972c9d5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::ReadFromHxElementCounter(ML_STAR, io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1103 1 0 "7fdfc934_1dbc_492e_99b201a00a1a2b46" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_intAvailable = SeqGetTotal(io_seq_TipSequence);
// }} ""
// {{{ 1104 1 0 "90284beb_b4e9_49ff_a50e5593845f2a17" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE08(l_strSequenceName, Translate(" :: "), l_intAvailable, Translate(" / "), l_intTotalPositions, Translate(""), Translate(""), Translate(""));
// }} ""
// {{{ 1105 1 0 "3a8669ae_40cf_4b29_ba3198964b65e4e2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, io_seq_TipSequence, 5, Translate(""));
// }} ""
// {{ 1106 1 0 "5795afa1_b0d2_4c24_a57fbd05f1563135" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1107 1 0 "51e7c6c3_e38b_4019_bbda42a12e3d766c" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("COULD NOT DETERMINE TIP TYPE!"));
// }} ""
// {{ 1108 1 0 "5795afa1_b0d2_4c24_a57fbd05f1563135" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1109 1 0 "87f8cf68_441d_40a9_b1c2b470b62a48e7" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1110 1 0 "09610392_7d07_4759_b0de8ab27f87e492" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1111 1 0 "87f8cf68_441d_40a9_b1c2b470b62a48e7" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "TipCounter_Read" "End"
}
// }} ""
// {{{ 5 "TipCounter_Write" "Begin"
function TipCounter_Write( device & ML_STAR, sequence i_seq_TipSequence, variable i_str_TipCounter ) void {
// }} ""
private variable _strFunctionName;
private variable l_strSequenceName;
private variable l_intTotalPositions;
private variable l_intAvailable;
private variable l_strError;
private variable l_strInstrumentClass;
private variable l_intTipType;
private variable l_strLabID;
private variable l_intEmptyCheck;
private sequence l_seqTemp;
private variable l_strName;
// {{ 5 "TipCounter_Write" "InitLocals"
// }} ""
// {{ 1150 1 0 "fec747c3_faef_4a21_90b6a4a208c00a87" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1151 1 0 "3f464d5d_89ea_49c0_88835d3e8dd9a361" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 1153 1 0 "bfad08e1_9041_4224_a0b458c7738c9a4a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 1154 1 0 "fec747c3_faef_4a21_90b6a4a208c00a87" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1155 1 0 "167741a1_0111_4e10_b93a75f0487a79a9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::InitTipCountingLibrary();
// }} ""
// {{{ 1156 1 0 "2f70b95c_7d18_44a1_89bb72cabec4d109" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_TipCounter = StrConcat2(i_str_TipCounter, Translate(""));
// }} ""
// {{ 1157 1 0 "a939d8c0_303b_48dc_813a30dd841b8bc5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_str_TipCounter == "")
{
// }} ""
// {{{ 1158 1 0 "a1ef771b_c6ce_4bd2_a7cdc6e7f3315510" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strError = StrConcat4(Translate("Tip counter '"), i_str_TipCounter, Translate("' is invalid!"), Translate(""));
// }} ""
// {{{ 1159 1 0 "9fd10ae0_4d16_497a_b0ae6976c8081f7f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
ErrRaise(101, l_strError);
// }} ""
// {{ 1160 1 0 "a939d8c0_303b_48dc_813a30dd841b8bc5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1161 1 0 "ab969e6b_5ee0_4805_b7c1b313c6c24505" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
l_intEmptyCheck = i_seq_TipSequence.GetCurrentPosition();
// }} ""
// {{ 1162 1 0 "a06d3952_b183_4f7e_bf87997201cf5d16" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_intEmptyCheck == 0)
{
// }} ""
// {{{ 1163 1 0 "459e0ee3_5bce_4373_ad7396220af154a9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strName = SeqGetName(i_seq_TipSequence);
// }} ""
// {{ 1164 1 0 "885a00f5_47b0_4162_b2f781b368aae648" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_strName == "seq_Temp")
{
// }} ""
// {{ 1165 1 0 "2cca1468_5ea0_4754_913b28029ebc8d92" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
i_seq_TipSequence.SetCurrentPosition(1);
// }} ""
// {{{ 1166 1 0 "29831b8c_d095_4f26_9d7c9a90e1d8f224" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(i_seq_TipSequence);
// }} ""
// {{ 1167 1 0 "e1119b16_91e4_40b6_b50c17bca9b36c4c" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
i_seq_TipSequence.SetCurrentPosition(0);
// }} ""
// {{ 1168 1 0 "885a00f5_47b0_4162_b2f781b368aae648" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1169 1 0 "b7f8f92f_034a_42c7_bc238cc3e15dd6e0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(l_seqTemp);
// }} ""
ML_STAR.CopyResetSequence(i_seq_TipSequence.GetName(), l_seqTemp);
// {{{ 1171 1 0 "f9bad9ac_773b_4e53_9854a691cbc91b39" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(l_seqTemp);
// }} ""
// {{ 1172 1 0 "885a00f5_47b0_4162_b2f781b368aae648" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1173 1 0 "15c97361_a84f_4d01_9d1d39bc4357fe2f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::RemoveUsedPositions(ML_STAR, i_seq_TipSequence);
// }} ""
// {{ 1174 1 0 "a06d3952_b183_4f7e_bf87997201cf5d16" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1175 1 0 "ad0d4e16_dc64_4044_92bffd692f80de64" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::RemoveUsedPositions(ML_STAR, i_seq_TipSequence);
// }} ""
// {{{ 1176 1 0 "3009a105_d684_4924_88d3f48156e41df9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(i_seq_TipSequence);
// }} ""
// {{ 1177 1 0 "a06d3952_b183_4f7e_bf87997201cf5d16" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1178 1 0 "c27cd0a8_f09e_4322_8cfce011d8b6b2c4" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetSequenceName(ML_STAR, i_seq_TipSequence, l_strSequenceName, l_intTotalPositions);
// }} ""
// {{{ 1179 1 0 "f02c1b7d_1e5f_41c0_886939edf81582e6" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(ML_STAR, l_strLabID, l_intTipType);
// }} ""
// {{ 1180 1 0 "670d6f87_c8e2_4125_ae2de7ff382bcd6c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_intTipType != -1)
{
// }} ""
// {{{ 1181 1 0 "d218d1e7_e9d8_422f_97d39177ddb93835" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strInstrumentClass = DevGetInstrumentName(ML_STAR);
// }} ""
// {{{ 1182 1 0 "793c6ebb_910a_4489_aa21c1ebc17c18fd" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CheckTipCounterName(i_str_TipCounter);
// }} ""
// {{{ 1183 1 0 "75aca573_0231_409d_9e248bfcd5ccd80d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Read tip counter:  "), i_str_TipCounter);
// }} ""
// {{{ 1184 1 0 "096aaa63_3b23_45e5_bcdbc9f50bc21f7b" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_SortSequenceLabIDXY(ML_STAR, i_seq_TipSequence);
// }} ""
// {{{ 1185 1 0 "3d5ad483_19c1_4b3c_873cd10d97232158" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CreateNewHxElementCounter(i_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1186 1 0 "621256a3_de73_4ec3_bc80d1dcbd9d6573" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::WriteHxElementCounter(i_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1187 1 0 "1e091ae4_cd73_4cc9_888d64739220c130" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_intAvailable = SeqGetTotal(i_seq_TipSequence);
// }} ""
// {{{ 1188 1 0 "952c4eee_dae1_4d6e_b390cc6e97769b9c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE08(l_strSequenceName, Translate(" :: "), l_intAvailable, Translate(" / "), l_intTotalPositions, Translate(""), Translate(""), Translate(""));
// }} ""
// {{ 1189 1 0 "670d6f87_c8e2_4125_ae2de7ff382bcd6c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1190 1 0 "4898c18b_c2bb_4c39_845a7009758fe72a" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("COULD NOT DETERMINE TIP TYPE!"));
// }} ""
// {{ 1191 1 0 "670d6f87_c8e2_4125_ae2de7ff382bcd6c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1192 1 0 "9695c773_7904_4f7c_aee8d8f25dda0e4e" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1193 1 0 "48854ae1_2d4e_430f_a3158df30f108a64" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1194 1 0 "9695c773_7904_4f7c_aee8d8f25dda0e4e" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "TipCounter_Write" "End"
}
// }} ""
// {{{ 5 "TipCounter_Edit" "Begin"
function TipCounter_Edit( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_int_TimeOut ) void {
// }} ""
private variable _strFunctionName;
private variable l_strSequenceName;
private variable l_intTotalPositions;
private variable l_intAvailable;
private variable l_strError;
private variable l_intTipType;
private variable l_strInstrumentClass;
private variable l_strLabID;
private variable l_intEmptyCheck;
// {{ 5 "TipCounter_Edit" "InitLocals"
// }} ""
// {{ 1042 1 0 "5d4f2ecd_cce3_4645_84cd61c9af23eb43" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1043 1 0 "cc28f8a7_6875_4c9a_88c7705e8b6e1047" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 1045 1 0 "fdd649b0_f87f_4a07_987b00c6c13d568a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 1046 1 0 "5d4f2ecd_cce3_4645_84cd61c9af23eb43" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1047 1 0 "ee834717_cc00_44e1_911b9b9f54f94a34" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_OFFSET_GLOBAL::INIT::InitializeVariables();
// }} ""
// {{{ 1048 1 0 "fb9a44f3_3431_45a4_999c38c47fe1abaa" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::InitTipCountingLibrary();
// }} ""
// {{{ 1049 1 0 "5ab33cd2_adec_4a68_a6bc21cb7d286d03" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_TipCounter = StrConcat2(i_str_TipCounter, Translate(""));
// }} ""
// {{ 1050 1 0 "4665d479_18dc_4e07_87988e57c91e0c00" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_str_TipCounter == "")
{
// }} ""
// {{{ 1051 1 0 "e2b20421_ffed_4b77_8504d4af5730cf2d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strError = StrConcat4(Translate("Tip counter '"), i_str_TipCounter, Translate("' is invalid!"), Translate(""));
// }} ""
// {{{ 1052 1 0 "87aac4ea_28d1_49a2_a56755fe79862f96" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
ErrRaise(101, l_strError);
// }} ""
// {{ 1053 1 0 "4665d479_18dc_4e07_87988e57c91e0c00" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1054 1 0 "5fadcde7_447e_4235_b8171941c768446c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
l_strLabID = Translate("");
// }} ""
// {{ 1055 1 0 "630e94af_3026_4f8e_818dd941298045dc" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
l_intEmptyCheck = io_seq_TipSequence.GetCurrentPosition();
// }} ""
{
   sequence sequenceObj;

   ML_STAR.CopyResetSequence(io_seq_TipSequence.GetName(), sequenceObj);
   l_strLabID = sequenceObj.GetLabwareId();

   //if(l_intEmptyCheck == 0) ML_STAR.CopyResetSequence(io_seq_TipSequence.GetName(), io_seq_TipSequence);
}
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 1057 1 0 "dbf660f7_c909_4039_993198d1c25e8238" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(io_seq_TipSequence);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 1058 1 0 "220c6440_58de_4a3f_868822b42d597fb0" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetSequenceName(ML_STAR, io_seq_TipSequence, l_strSequenceName, l_intTotalPositions);
// }} ""
// {{{ 1059 1 0 "3cf61fdd_0f5e_4292_8983e97e0a43311b" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(ML_STAR, l_strLabID, l_intTipType);
// }} ""
// {{ 1060 1 0 "4512ee8f_76d7_4237_bea5c356e06b16bf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_intTipType != -1)
{
// }} ""
// {{{ 1061 1 0 "0d0c9784_ce96_45ca_a861eef0442b617c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strInstrumentClass = DevGetInstrumentName(ML_STAR);
// }} ""
// {{{ 1062 1 0 "6d5b02b8_f668_4966_9a0b900f757c4383" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CheckTipCounterName(i_str_TipCounter);
// }} ""
// {{{ 1063 1 0 "04ccf350_98aa_44e6_81dbe31a272dd891" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Read tip counter:  "), i_str_TipCounter);
// }} ""
// {{{ 1064 1 0 "92ef9a83_72b5_4cdc_8687073a59085311" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CreateNewHxElementCounter(io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1065 1 0 "61644db6_a2e2_466f_b1125e910a196249" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::ReadFromHxElementCounter(ML_STAR, io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1066 1 0 "e40ba698_540c_4294_b3b174eb434b882e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::RemoveUsedPositions(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 1067 1 0 "8e95e599_2006_496b_81fe651702bc7640" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::EditSequence(ML_STAR, io_seq_TipSequence, BOOLEON::TRUE, i_int_TimeOut);
// }} ""
// {{{ 1068 1 0 "3cb60390_447d_41b9_a218eb71434170b6" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_SortSequenceLabIDXY(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 1069 1 0 "e1dafdfc_b293_4647_84b08ec5d7ec85cb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::WriteHxElementCounter(io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1070 1 0 "9c161379_d014_4bb4_b427ac8e1ec7fe1a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_intAvailable = SeqGetTotal(io_seq_TipSequence);
// }} ""
// {{{ 1071 1 0 "f35ae057_8ad2_48df_8d16e0d3634c52a9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE08(l_strSequenceName, Translate(" :: "), l_intAvailable, Translate(" / "), l_intTotalPositions, Translate(""), Translate(""), Translate(""));
// }} ""
// {{{ 1072 1 0 "4c11d504_9fdb_40e3_b16f6832e61329e6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, io_seq_TipSequence, 5, Translate(""));
// }} ""
// {{ 1073 1 0 "4512ee8f_76d7_4237_bea5c356e06b16bf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1074 1 0 "a1ec7d18_ec8d_48a9_8486b40762a850cf" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("COULD NOT DETERMINE TIP TYPE!"));
// }} ""
// {{ 1075 1 0 "4512ee8f_76d7_4237_bea5c356e06b16bf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1076 1 0 "4be8ea44_3057_4a43_ba7d13e5201732c6" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1077 1 0 "dbb96dfb_97e8_45ff_be1fad5514d9e063" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1078 1 0 "4be8ea44_3057_4a43_ba7d13e5201732c6" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "TipCounter_Edit" "End"
}
// }} ""
// {{{ 5 "_GetTipCounterFolderPath" "Begin"
private function _GetTipCounterFolderPath( variable & o_str_TipCounterFolder ) void {
// }} ""
private variable str_FileName;
private variable str_SubFileName;
// {{ 5 "_GetTipCounterFolderPath" "InitLocals"
o_str_TipCounterFolder = 0;
// }} ""
// {{ 1478 1 0 "2b06dc86_4bb8_46ee_b5970a1f7c27ba60" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_TipCounterFolder = Translate("");
// }} ""
// {{ 1479 1 0 "16adaf2f_023c_48d8_ad5b0c635de6357a" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
str_SubFileName = Translate("");
// }} ""
str_SubFileName = GetFileName();
// {{{ 1481 1 0 "39f859cc_4597_49de_b143af932b069fb2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_FileName = HSLExtensions::File::GetFileName(str_SubFileName);
// }} ""
// {{{ 1482 1 0 "507f0293_4e4b_46ba_af66a9f4af51c12b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(str_SubFileName, str_FileName, Translate(""));
// }} ""
// {{{ 1483 1 0 "2681f1eb_6bb4_4267_94638129989cb8e5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_str_TipCounterFolder = StrConcat8(str_SubFileName, Translate("\\"), Translate("Resources"), Translate("\\"), Translate("TipCounters"), Translate("\\"), Translate(""), Translate(""));
// }} ""
// {{{ 1484 1 0 "aecf018e_8deb_42d6_9d19a7b778551de3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(o_str_TipCounterFolder, Translate("\\"), Translate("\\\\"));
// }} ""
// {{{ 1485 1 0 "38b4ebc0_520e_4d88_b35c378bc7b782c6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::Directory::Create(o_str_TipCounterFolder);
// }} ""
// {{{ 5 "_GetTipCounterFolderPath" "End"
}
// }} ""
// {{{ 5 "_RemoveInvalidCharacters" "Begin"
private function _RemoveInvalidCharacters( variable & io_str_Value ) void {
// }} ""
// {{ 5 "_RemoveInvalidCharacters" "InitLocals"
// }} ""
// {{{ 1552 1 0 "0c288e1c_8ff8_42db_b7aede6bf8822bb0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate(" "), Translate("_"));
// }} ""
// {{{ 1553 1 0 "dd5a9374_f426_4bc2_9e1d186c1064b8c5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("."), Translate("_"));
// }} ""
// {{{ 1554 1 0 "e9cb4757_60a6_4bf1_b3216a135debeda3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("-"), Translate("_"));
// }} ""
// {{{ 1555 1 0 "0fcd2931_e831_46e3_bf2ebc49d5789ada" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("+"), Translate("_"));
// }} ""
// {{{ 1556 1 0 "30fc4303_49ab_4163_a11bb0203c555a0c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("@"), Translate("_"));
// }} ""
// {{{ 1557 1 0 "9e76b03b_e058_46a4_925c7db021a80734" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("!"), Translate("_"));
// }} ""
// {{{ 1558 1 0 "593f059e_e4b1_419b_8d49283698ffe238" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("#"), Translate("_"));
// }} ""
// {{{ 1559 1 0 "f9e7db57_ec42_4fb5_a07f2930f0cda1b0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("$"), Translate("_"));
// }} ""
// {{{ 1560 1 0 "8cab63ac_3e01_4138_aebd3571db44f3a7" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("%"), Translate("_"));
// }} ""
// {{{ 1561 1 0 "ae1621bf_0945_4059_96511e9f4d9694da" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("^"), Translate("_"));
// }} ""
// {{{ 1562 1 0 "7be9e888_54cc_43a1_bb433be10ad2a925" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("&"), Translate("_"));
// }} ""
// {{{ 1563 1 0 "ae817bea_7ebb_458e_bd7d34f3c8b4158a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("*"), Translate("_"));
// }} ""
// {{{ 1564 1 0 "d3054bfb_bbcb_4268_a218bda709c29331" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("("), Translate("_"));
// }} ""
// {{{ 1565 1 0 "38b914d0_5acc_4dae_8be315534185e9ba" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate(")"), Translate("_"));
// }} ""
// {{{ 1566 1 0 "61ef0255_1b56_4440_a9a47df0976443a0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(io_str_Value, Translate("="), Translate("_"));
// }} ""
// {{{ 5 "_RemoveInvalidCharacters" "End"
}
// }} ""
// {{{ 5 "TipTypeCheck1mL" "Begin"
function TipTypeCheck1mL( device & ML_STAR, variable i_str_ReturnFromTipPickUp, sequence & o_seq_IncorrectTipReturn, variable & o_str_IncorrectChannels ) variable {
// }} ""
private variable _strFunctionName;
private variable int_Total1mLChannels;
private variable int_TotalPositions;
private variable int_CurrentAspirationMode;
private variable str_LibraryFolderPath;
private variable str_CenterSpotFilePath;
private variable int_Position;
private variable str_LabwareID;
private variable arr_LabwareIDs[];
private variable arr_PositionIDs[];
private variable arr_TipTypes[];
private variable int_ChannelIndex;
private variable arr_Channel[];
private variable str_PositionID;
private variable int_TipType;
private variable flt_ChCoord_Y;
private variable flt_ChCoord_Z;
private variable flt_ChCoord_X;
private variable arr_TempLabware[];
private variable str_TempLabwareID;
private sequence seq_TempAspPosition;
private variable int_TotalTempLabware;
private variable str_ChannelPattern;
private variable bln_SimulationMode;
private variable flt_NotUsed;
private variable str_LiquidClass;
private variable str_ReturnAsp;
private variable int_Recovery;
private variable arr_TipCorrect[];
private variable str_ChannelPattern_Return;
private variable int_NumChanReturns;
private variable int_RetryCheck;
private sequence seq_TempReturnPositions;
private variable bln_LabwareExists;
private variable i;
private variable ret_int_AllGood;
private variable int_TADM_Mode;
private variable flt_AspVolume;
private variable arr_LiquidClasses[];
private variable arr_AspVolumes[];
// {{ 5 "TipTypeCheck1mL" "InitLocals"
{ sequence __temp; o_seq_IncorrectTipReturn = __temp; }
o_str_IncorrectChannels = 0;
// }} ""
// {{ 1196 1 0 "c197a365_652a_4711_bc8e2e213294d9cd" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1197 1 0 "d1938873_b69f_4c69_98b078f15d3ee78e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 1199 1 0 "a187b8e6_1d78_4927_ab4cc39f0318f69c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 1200 1 0 "c197a365_652a_4711_bc8e2e213294d9cd" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1201 1 0 "83e7a2e2_8707_4eaa_a66deaba012db3a1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
ret_int_AllGood = -1;
// }} ""
// {{ 1202 1 0 "b84b1b1b_aabc_49b1_8fe427b0dc06ddf6" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_IncorrectChannels = Translate("");
// }} ""
// {{{ 1203 1 0 "d534fd0a_d777_4c5e_86a145a7a16f7740" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(o_seq_IncorrectTipReturn);
// }} ""
// {{{ 1204 1 0 "cc6fd535_2e9c_4e83_b23dbd179f66dee9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bln_SimulationMode = Util::GetSimulationMode();
// }} ""
// {{{ 1205 1 0 "78a85b00_1fbe_41c5_b94b89cf25dbc487" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LibraryFolderPath = FilGetLibraryPath();
// }} ""
// {{{ 1206 1 0 "ea828ab9_9542_4073_b06551978e5c501e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_CenterSpotFilePath = StrConcat4(str_LibraryFolderPath, Translate("\\STAR Tools\\Resources\\SubMethods\\"), Translate("CenterSpot"), Translate(".rck"));
// }} ""
// {{{ 1207 1 0 "0e180322_5d6d_47a2_b5582b8285320f93" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
CHANNEL_QUERY_1ML::RequestAspirationMonitoringMode(ML_STAR, int_CurrentAspirationMode);
// }} ""
// {{ 1208 1 0 "517dcc68_a376_4dcc_8b1d6e4ddca2879b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_CurrentAspirationMode == 0)
{
// }} ""
// {{ 1209 1 0 "18ed8ac2_2e13_43e9_8cd8550b9ac480d6" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========================================\nASPIRATION MONITORING IS MAD\n========================================="));
// }} ""
// {{ 1210 1 0 "517dcc68_a376_4dcc_8b1d6e4ddca2879b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1211 1 0 "ec2c4197_058a_4d4e_9fc523239ba447cf" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========================================\nASPIRATION MONITORING IS TADM\n========================================="));
// }} ""
// {{ 1212 1 0 "517dcc68_a376_4dcc_8b1d6e4ddca2879b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1213 1 0 "21ccb402_e87e_4c52_968744f861f6f288" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TADM_Mode = HSLExtensions::Venus::GetTadmMode(ML_STAR);
// }} ""
// {{ 1214 1 0 "fc87d37d_e101_49c3_98107d7b7b0a840e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TADM_Mode == 1)
{
// }} ""
// {{ 1215 1 0 "76e71649_8e93_4fe5_963e97c0739ac1d0" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========================================\nTADM IS IN RECORDING MODE\n========================================="));
// }} ""
// {{ 1216 1 0 "fc87d37d_e101_49c3_98107d7b7b0a840e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1217 1 0 "49606005_8e26_46dc_8cc883b87a7ae18c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TADM_Mode == 2)
{
// }} ""
// {{ 1218 1 0 "d904edb9_af4e_4841_b57c56dd7704c21e" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========================================\nTADM IS IN MONITORING MODE\n========================================="));
// }} ""
// {{ 1219 1 0 "49606005_8e26_46dc_8cc883b87a7ae18c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1220 1 0 "b3e8640a_12f6_48bf_be9923e28da5de37" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get1mLChannelCount(ML_STAR, int_Total1mLChannels);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 1221 1 0 "04f958bf_119a_41a8_b997dd06b1c0ac62" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (str_LiquidClass == "")
{
// }} ""
// {{ 1222 1 0 "20b81a37_1c32_4acb_8fb27603f306f9aa" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("==========================================================\nTIP TYPE NOT COMPATIBLE WITH CHECK\n=========================================================="));
// }} ""
// {{ 1223 1 0 "05fba4f2_c2a3_4b2b_b0c1a9d7c049aae0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1224 1 0 "9263d8f6_8560_45ec_8320b40843dd390f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1225 1 0 "05fba4f2_c2a3_4b2b_b0c1a9d7c049aae0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1226 1 0 "45910900_a966_42f2_a5898068f2751db0" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (ret_int_AllGood);
// }} ""
// {{ 1227 1 0 "04f958bf_119a_41a8_b997dd06b1c0ac62" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 1228 1 0 "7c9cef53_4c25_4f3d_967ea334c255f222" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_TempLabware.SetSize(0);
// }} ""
// {{ 1229 1 0 "dafd9fcc_6593_47fd_8934e06e19a2765b" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_RetryCheck = 0; int_RetryCheck < 1;)
{
int_RetryCheck = int_RetryCheck + 1;
// }} ""
// {{ 1230 1 0 "922ac80c_37e1_456e_a8305e9faa2a9d31" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1231 1 0 "8180eb7e_b178_4a3e_8391fb8c8136c823" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_Channel.SetSize(int_Total1mLChannels);
// }} ""
// {{ 1232 1 0 "3e882a31_1d37_482c_9c4b0b1240c5d48e" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_LabwareIDs.SetSize(int_Total1mLChannels);
// }} ""
// {{ 1233 1 0 "6185ff1f_15fd_41e6_9d9f76e86d0c9053" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PositionIDs.SetSize(int_Total1mLChannels);
// }} ""
// {{ 1234 1 0 "5a1b6778_86bb_4ed1_92e0fc4921b0e48c" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_TipTypes.SetSize(int_Total1mLChannels);
// }} ""
// {{ 1235 1 0 "f0af711c_4d52_4cab_8b697d9decb4392e" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_LiquidClasses.SetSize(int_Total1mLChannels);
// }} ""
// {{ 1236 1 0 "a3eb9f68_a387_423a_b1431cb911f9916b" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_AspVolumes.SetSize(int_Total1mLChannels);
// }} ""
// {{ 1237 1 0 "b0fd0d17_0538_44b1_b2a59ce0e53990c2" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_TipCorrect.SetSize(int_Total1mLChannels);
// }} ""
// {{{ 1238 1 0 "2e95bd1c_2c44_40f4_ba491b25b0d6534d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TempAspPosition);
// }} ""
// {{ 1239 1 0 "fbc9c6f5_ba72_42fb_ac5c85aa746f1db7" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_Total1mLChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 1240 1 0 "59afd2ea_a5b4_4b99_a2bd00644ac88810" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_Channel.SetAt(int_ChannelIndex-1, int_ChannelIndex);
// }} ""
// {{ 1241 1 0 "450a7b01_5bcf_4610_aba5736c0fb0f74a" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_LabwareIDs.SetAt(int_ChannelIndex-1, Translate(""));
// }} ""
// {{ 1242 1 0 "62b57256_bf32_4807_aab7199590927b06" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_PositionIDs.SetAt(int_ChannelIndex-1, Translate(""));
// }} ""
// {{ 1243 1 0 "ffcc8b0c_a7e1_4afc_864e3e891a75049c" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_LiquidClasses.SetAt(int_ChannelIndex-1, Translate(""));
// }} ""
// {{ 1244 1 0 "46ece4db_6456_4398_bafcf1827f13a8df" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_TipTypes.SetAt(int_ChannelIndex-1, -1);
// }} ""
// {{ 1245 1 0 "5564149e_c466_4ea1_88f39fc5b767e133" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_TipCorrect.SetAt(int_ChannelIndex-1, 0);
// }} ""
// {{ 1246 1 0 "5e44a6fb_ce85_479c_b80f7bae1f4dfdf3" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_AspVolumes.SetAt(int_ChannelIndex-1, 0);
// }} ""
// {{ 1247 1 0 "fbc9c6f5_ba72_42fb_ac5c85aa746f1db7" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 1248 1 0 "c61a2058_b490_4709_8abffb8af3e5dcf5" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
str_ChannelPattern = Translate("");
// }} ""
// {{ 1249 1 0 "922ac80c_37e1_456e_a8305e9faa2a9d31" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1250 1 0 "f46259f9_839a_475d_95191190f191a3e0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1251 1 0 "c08d8f18_1b7c_4789_8cb09e5a15c216b9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TotalPositions = StepReturn::GetNumberOfPositions(i_str_ReturnFromTipPickUp);
// }} ""
// {{ 1252 1 0 "06b5bb00_8927_4b2d_b43b9dc0706d067f" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_Total1mLChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{{ 1253 1 0 "7ce3d53c_193e_4de7_8712e4a9c0c32adf" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_Position = StepReturn::GetPositionFromNum(int_ChannelIndex, i_str_ReturnFromTipPickUp);
// }} ""
// {{{ 1254 1 0 "be1ca465_e0ad_48ac_bca45940395761d2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabwareID = StepReturn::GetLabwareId(int_Position, i_str_ReturnFromTipPickUp);
// }} ""
// {{{ 1255 1 0 "fbc8e0e7_fdf5_46a9_a05ec1b587a4729b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PositionID = StepReturn::GetPositionId(int_Position, i_str_ReturnFromTipPickUp);
// }} ""
// {{ 1256 1 0 "248f3641_6715_460b_a6ab9f6795e980ac" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (str_LabwareID != "")
{
// }} ""
// {{{ 1257 1 0 "58371f21_ca6e_472e_84c99bcae73b796d" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(ML_STAR, str_LabwareID, int_TipType);
// }} ""
// {{ 1258 1 0 "e280ce4f_d329_4a0f_aede4cf0d2d3f34d" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_LabwareIDs.SetAt(int_ChannelIndex-1, str_LabwareID);
// }} ""
// {{ 1259 1 0 "1c229233_cb95_49d3_869a0d62a730558e" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_PositionIDs.SetAt(int_ChannelIndex-1, str_PositionID);
// }} ""
// {{ 1260 1 0 "d4220e64_1b2d_408f_a2a22470a36ce42c" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_TipTypes.SetAt(int_ChannelIndex-1, int_TipType);
// }} ""
// {{{ 1261 1 0 "8f94afeb_70a8_40be_a78945e77ff8fcd4" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_DetermineTipCheckLC(int_TipType, str_LiquidClass, flt_AspVolume);
// }} ""
// {{ 1262 1 0 "bdb91223_c3f9_492e_a874a53b71d1b4f6" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_LiquidClasses.SetAt(int_ChannelIndex-1, str_LiquidClass);
// }} ""
// {{ 1263 1 0 "8d470313_fb82_48bd_b3b7f76bd6052f58" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_AspVolumes.SetAt(int_ChannelIndex-1, flt_AspVolume);
// }} ""
// {{ 1264 1 0 "4f5e7b15_6cfc_4d36_b875e52afce252cc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_SimulationMode == BOOLEON::FALSE)
{
// }} ""
// {{{ 1265 1 0 "c582a9d3_48fa_4e6f_b7c41dcb69f64ca5" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
CHANNEL_QUERY_1ML::Get_Channel_Position(ML_STAR, int_ChannelIndex, flt_ChCoord_X, flt_ChCoord_Y, flt_ChCoord_Z);
// }} ""
// {{ 1266 1 0 "4f5e7b15_6cfc_4d36_b875e52afce252cc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1267 1 0 "61b2c8fc_61c5_47ed_bc26f49a720f631c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevGetLabwarePositionEx(ML_STAR, str_LabwareID, str_PositionID, flt_ChCoord_X, flt_ChCoord_Y, flt_NotUsed, flt_NotUsed);
// }} ""
// {{ 1268 1 0 "2976dbe5_b9d6_4954_a5371c393f942221" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_ChCoord_Z = 245.0;
// }} ""
// {{ 1269 1 0 "4f5e7b15_6cfc_4d36_b875e52afce252cc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 1270 1 0 "80433dee_11bd_4c71_8b867665b3741796" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
flt_ChCoord_Z = flt_ChCoord_Z - 1.0;
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 1271 1 0 "7342ca41_62c1_43ca_bc5037292c7f0383" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TempLabwareID = StrConcat12(int_ChannelIndex, Translate("_"), str_LabwareID, Translate("_"), str_PositionID, Translate("_"), int_TipType, Translate(""), Translate(""), Translate(""), Translate(""), Translate(""));
// }} ""
// {{ 1272 1 0 "9d4bf1da_2fe6_4803_b67c27c05f28a1f0" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_TempLabware.AddAsLast(str_TempLabwareID);
// }} ""
// {{{ 1273 1 0 "2205e385_b421_4209_aea2ea4eb71b7886" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bln_LabwareExists = DevIsValidLabwareForCurrentDeckLayout(ML_STAR, str_TempLabwareID);
// }} ""
// {{ 1274 1 0 "f91e5773_d9ed_4b64_b56b2446a30b8968" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_LabwareExists == BOOLEON::TRUE)
{
// }} ""
// {{{ 1275 1 0 "7edff0a3_0cdf_43ae_bceeaec5502988fc" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevRemoveLabware(ML_STAR, str_TempLabwareID);
// }} ""
// {{ 1276 1 0 "f91e5773_d9ed_4b64_b56b2446a30b8968" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1277 1 0 "1b37d023_7d80_4592_893ae7d5826fc6c1" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevAddLabware(ML_STAR, str_TempLabwareID, str_CenterSpotFilePath, flt_ChCoord_X, flt_ChCoord_Y, flt_ChCoord_Z, 0.0);
// }} ""
// {{{ 1278 1 0 "62bc4fb9_ed22_4597_9425a1eb7df6070e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern = StrConcat2(str_ChannelPattern, Translate("1"));
// }} ""
// {{{ 1279 1 0 "0b9030f5_e4f5_41f2_a71371a55de701a7" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqAdd(seq_TempAspPosition, str_TempLabwareID, Translate("1"));
// }} ""
// {{ 1280 1 0 "248f3641_6715_460b_a6ab9f6795e980ac" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1281 1 0 "8ae1e577_d55a_46ae_a973ac9f45d17174" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern = StrConcat2(str_ChannelPattern, Translate("0"));
// }} ""
// {{ 1282 1 0 "248f3641_6715_460b_a6ab9f6795e980ac" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1283 1 0 "06b5bb00_8927_4b2d_b43b9dc0706d067f" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 1284 1 0 "f973ee25_d547_42e7_9604da92dd228c9f" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TempAspPosition.SetCurrentPosition(1);
// }} ""
// {{{ 1285 1 0 "0fc938e5_6f2d_47a6_a3dbd75b3d51c739" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Channel Pattern to check:  "), str_ChannelPattern);
// }} ""
// {{{ 1286 1 0 "dcadf68d_414a_4dd2_a0fe371c90229e72" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_4(Translate("Channel   Tip Type      Labware ID      Position ID"), arr_Channel, arr_TipTypes, arr_LabwareIDs, arr_PositionIDs);
// }} ""
// {{ 1287 1 0 "3f8acc35_08fe_48e6_bc7575af4472e9ba" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalTempLabware=arr_TempLabware.GetSize();
// }} ""
// {{ 1288 1 0 "9fa0f677_b97a_4f4d_8d2f5199dfe2f860" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TotalTempLabware == 0)
{
// }} ""
// {{ 1289 1 0 "0449715c_88b6_4af7_b86b9554f6708033" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("==========================================================\nNO TIPS TO CHECK\n=========================================================="));
// }} ""
// {{ 1290 1 0 "02e5af70_5413_4545_8d3b15cf959677b3" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1291 1 0 "6e250af5_025b_4042_a03b27bbd4e6076b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1292 1 0 "02e5af70_5413_4545_8d3b15cf959677b3" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1293 1 0 "fbd1dab6_c526_42cb_b25a5d41d1acbc9e" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (ret_int_AllGood);
// }} ""
// {{ 1294 1 0 "9fa0f677_b97a_4f4d_8d2f5199dfe2f860" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1295 1 0 "f46259f9_839a_475d_95191190f191a3e0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1296 1 0 "6c82ae62_7962_4a56_9252fec95f94a116" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========================================\nSET MODE TO TADM\n========================================="));
// }} ""
// {{{ 1297 1 0 "909e9559_d8e2_4b74_8dfed42f0633ff7d" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
CHANNEL_QUERY_1ML::SetAspirationMonitoringMode(ML_STAR, 1);
// }} ""
// {{ 1298 1 0 "cdfafa82_ef09_4f58_b317dfe9b1c34c6f" "ML_STAR:{541143F5-7FA2-11D3-AD85-0004ACB1DCB2}"
{
	variable arrRetValues[];
	arrRetValues = ML_STAR._541143F5_7FA2_11D3_AD85_0004ACB1DCB2("cdfafa82_ef09_4f58_b317dfe9b1c34c6f"); // Aspirate
	str_ReturnAsp = arrRetValues[2];
}
// }} ""
// {{ 1299 1 0 "9056cfd0_c24a_42c7_a2b32c95be2629e4" "ML_STAR:{541143F8-7FA2-11D3-AD85-0004ACB1DCB2}"
{
	variable arrRetValues[];
	arrRetValues = ML_STAR._541143F8_7FA2_11D3_AD85_0004ACB1DCB2("9056cfd0_c24a_42c7_a2b32c95be2629e4"); // Dispense
}
// }} ""
// {{ 1300 1 0 "e7c1812c_48a8_45b0_93adcbeb8e3342f3" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========================================\nSET MODE BACK TO INITIAL SETTING\n========================================="));
// }} ""
// {{{ 1301 1 0 "2e754af7_afa8_4ba2_a3417ff5e5f780ea" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
CHANNEL_QUERY_1ML::SetAspirationMonitoringMode(ML_STAR, int_CurrentAspirationMode);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 1302 1 0 "7bb47b2f_6b13_41e2_adc58af9757fcdc9" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1303 1 0 "9c3a1936_ef46_4968_8c510a5804d61506" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_Total1mLChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 1304 1 0 "dcb9d387_e5d6_45f7_8161858fc7e0d7bf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (arr_LabwareIDs.ElementAt( int_ChannelIndex -1) != "")
{
// }} ""
// {{{ 1305 1 0 "a545d0ae_6b79_4541_a4a83c394051b24a" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
CHANNEL_QUERY_1ML::InitializeDispenseDrive(ML_STAR, int_ChannelIndex);
// }} ""
// {{ 1306 1 0 "dcb9d387_e5d6_45f7_8161858fc7e0d7bf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1307 1 0 "9c3a1936_ef46_4968_8c510a5804d61506" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 1308 1 0 "7bb47b2f_6b13_41e2_adc58af9757fcdc9" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 1309 1 0 "7e93e943_ac1e_4a1d_bb90976cb3163b4d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1310 1 0 "b167cada_75d6_40e6_aa0f6df4be3e5025" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TempReturnPositions);
// }} ""
// {{ 1311 1 0 "8ff5abbb_1ed3_4170_b6bc724cee7f2e84" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
str_ChannelPattern_Return = Translate("");
// }} ""
// {{ 1312 1 0 "3d6e0f20_cb3d_46dc_8dc375f29a39779f" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_Total1mLChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{{ 1313 1 0 "0cf7e6c8_3237_44fd_88145007eedf4143" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_Position = StepReturn::GetPositionFromNum(int_ChannelIndex, str_ReturnAsp);
// }} ""
// {{ 1314 1 0 "332dd716_c8b8_42d2_b28eae0d8b0421ee" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 1315 1 0 "8ea4d45d_ae67_4402_8c9826c0329bf511" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_Recovery = StepReturn::GetRecoveryButton(int_Position, str_ReturnAsp);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 1316 1 0 "c7d010a0_aa65_437f_945f2e77758a5bf0" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_SimulationMode == BOOLEON::TRUE)
{
// }} ""
// {{ 1317 1 0 "2bc2d9d4_0054_4f8a_992bee0b09fd1f0f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelIndex == 2)
{
// }} ""
// {{ 1318 1 0 "e911c42f_99e6_46ae_aeafa2cb66e2c44c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_Recovery = 9;
// }} ""
// {{ 1319 1 0 "2bc2d9d4_0054_4f8a_992bee0b09fd1f0f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1320 1 0 "c7d010a0_aa65_437f_945f2e77758a5bf0" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 1321 1 0 "5d9a91bf_c869_4d92_857f848557c6502d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (arr_LabwareIDs.ElementAt( int_ChannelIndex -1) != "")
{
// }} ""
// {{ 1322 1 0 "8beb0111_d6dc_41fd_9a6a0b14f8637118" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_Recovery != 9)
{
// }} ""
// {{ 1323 1 0 "8943ac95_90b4_40ad_a61d79e8c409c162" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_TipCorrect.SetAt(int_ChannelIndex-1, 1);
// }} ""
// {{{ 1324 1 0 "f8fde6e4_bac5_4338_9e986c25e7cddf5d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern_Return = StrConcat2(str_ChannelPattern_Return, Translate("0"));
// }} ""
// {{ 1325 1 0 "8beb0111_d6dc_41fd_9a6a0b14f8637118" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1326 1 0 "c9508edb_cb51_458b_9d11163f9e3bd232" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern_Return = StrConcat2(str_ChannelPattern_Return, Translate("1"));
// }} ""
// {{{ 1327 1 0 "58618165_591f_4826_980718bd7cb5a8e5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqAdd(o_seq_IncorrectTipReturn, arr_LabwareIDs.ElementAt( int_ChannelIndex -1), arr_PositionIDs.ElementAt( int_ChannelIndex -1));
// }} ""
// {{ 1328 1 0 "8beb0111_d6dc_41fd_9a6a0b14f8637118" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1329 1 0 "5d9a91bf_c869_4d92_857f848557c6502d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1330 1 0 "c44ae60b_3b66_4839_aa4c70c049fa9ab3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern_Return = StrConcat2(str_ChannelPattern_Return, Translate("0"));
// }} ""
// {{ 1331 1 0 "5d9a91bf_c869_4d92_857f848557c6502d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1332 1 0 "3d6e0f20_cb3d_46dc_8dc375f29a39779f" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 1333 1 0 "3e16a6b2_790d_4ee2_ad9f45aeafa3070a" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
o_seq_IncorrectTipReturn.SetCurrentPosition(1);
// }} ""
// {{ 1334 1 0 "7e93e943_ac1e_4a1d_bb90976cb3163b4d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1335 1 0 "ac203bec_9375_4d37_bd08ed9c4be164eb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_NumChanReturns = StrReplace(str_ChannelPattern_Return, Translate("1"), Translate("1"));
// }} ""
// {{ 1336 1 0 "cb67b4d3_1f7e_452b_b0864cb5504d5abb" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_IncorrectChannels = str_ChannelPattern_Return;
// }} ""
// {{ 1337 1 0 "d40ce8b4_7236_44a7_992ef1bdd10ee45e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_NumChanReturns == 0)
{
// }} ""
// {{ 1338 1 0 "b78ff777_1b1c_4a04_b74b3646125008a8" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("--------------------------- TIPS CORRECT"));
// }} ""
// {{ 1339 1 0 "ff813b08_a672_47d3_b26eea4086ce28ce" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
ret_int_AllGood = 1;
// }} ""
// {{ 1340 1 0 "4c226991_d35d_4f14_951b60faf886b3c9" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 1341 1 0 "d40ce8b4_7236_44a7_992ef1bdd10ee45e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1342 1 0 "ce326c4f_1f53_4180_9f1d8888f1ba4978" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
ret_int_AllGood = 0;
// }} ""
// {{ 1343 1 0 "1e65999b_7f65_4bbd_8ac97d8e4bbe1bb7" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("--------------------------- WRONG TIPS DETECTED"));
// }} ""
// {{{ 1344 1 0 "339edff5_4f39_47b6_98d07ea3b1660f7c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Wrong channels detected:  "), o_str_IncorrectChannels);
// }} ""
// {{{ 1345 1 0 "254b7cc0_e054_4493_aa843db18bbb3134" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceSequence(o_seq_IncorrectTipReturn);
// }} ""
// {{{ 1346 1 0 "9b027dd2_5083_4670_a602631f9a15ce6d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, o_seq_IncorrectTipReturn, 6, Translate("Make positions flash"));
// }} ""
// {{ 1347 1 0 "dafd9fcc_6593_47fd_8934e06e19a2765b" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 1348 1 0 "76793e63_129b_4a5a_b5ba4757c55c2797" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1349 1 0 "1571c21e_8b54_4abb_95375415f780d60a" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalTempLabware=arr_TempLabware.GetSize();
// }} ""
// {{ 1350 1 0 "42552639_d644_4c97_a5b3d6d1c78f9105" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(i = 0; i < int_TotalTempLabware;)
{
i = i + 1;
// }} ""
// {{{ 1351 1 0 "7d89928a_cbe0_4733_ad1737a6e68ab4c9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevRemoveLabware(ML_STAR, arr_TempLabware.ElementAt( i -1));
// }} ""
// {{ 1352 1 0 "42552639_d644_4c97_a5b3d6d1c78f9105" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 1353 1 0 "76793e63_129b_4a5a_b5ba4757c55c2797" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1354 1 0 "bde491a6_7223_4742_a0b63af96376c7c0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1355 1 0 "150f84a2_8b0a_4ad7_8f4da942ffba5693" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1356 1 0 "bde491a6_7223_4742_a0b63af96376c7c0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1357 1 0 "921a5bca_141d_4b12_8c2a6e25103050ca" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (ret_int_AllGood);
// }} ""
// {{{ 5 "TipTypeCheck1mL" "End"
}
// }} ""
// {{{ 5 "_DetermineTipCheckLC" "Begin"
private function _DetermineTipCheckLC( variable i_int_TipType, variable & o_str_LiquidClass, variable & o_flt_CheckVolume ) void {
// }} ""
// {{ 5 "_DetermineTipCheckLC" "InitLocals"
o_str_LiquidClass = 0;
o_flt_CheckVolume = 0;
// }} ""
// {{ 1415 1 0 "3c6cc16b_6c09_4208_b3ca4e9561a32e66" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("");
// }} ""
// {{ 1416 1 0 "d8360e8e_3f6a_4d24_945013a59b561291" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 0.0;
// }} ""
// {{ 1417 1 0 "6073460d_a770_40f0_b13901669dd817dc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 0)
{
// }} ""
// {{ 1418 1 0 "0bc59d4f_41b7_4248_8f293d18faee6409" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_300");
// }} ""
// {{ 1419 1 0 "9fee1ba1_b033_49f2_bf8c9ed585adbde3" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 50.0;
// }} ""
// {{ 1420 1 0 "6073460d_a770_40f0_b13901669dd817dc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1421 1 0 "18f888ff_735e_47c4_be74f4beb3a47a24" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 1)
{
// }} ""
// {{ 1422 1 0 "83cecb4d_2b9f_4ea1_923eac5dfe09dc6d" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_300F");
// }} ""
// {{ 1423 1 0 "0f98b07a_b368_44af_8125b6b4f768d1d7" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 50.0;
// }} ""
// {{ 1424 1 0 "18f888ff_735e_47c4_be74f4beb3a47a24" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1425 1 0 "515fc94e_04b6_4085_a877bf3b3531fd18" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 4)
{
// }} ""
// {{ 1426 1 0 "2f3ed17e_d92f_4a54_84baefa29fec4086" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_1000");
// }} ""
// {{ 1427 1 0 "3b802ffd_eb01_46d5_b1102095f2a956de" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 100.0;
// }} ""
// {{ 1428 1 0 "515fc94e_04b6_4085_a877bf3b3531fd18" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1429 1 0 "95cd2950_531b_4830_8e1030d0788a0c1a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 5)
{
// }} ""
// {{ 1430 1 0 "e99a5e31_95d4_4a25_a2a982e53ac02bc8" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_1000F");
// }} ""
// {{ 1431 1 0 "2ce759d7_8d36_4265_9ae6a49b35a69950" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 100.0;
// }} ""
// {{ 1432 1 0 "95cd2950_531b_4830_8e1030d0788a0c1a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1433 1 0 "0fa95a42_ed6c_4ed8_94c9b2f476501cd1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 22)
{
// }} ""
// {{ 1434 1 0 "23293b94_c8ed_4284_8bc54389f63edae2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_50");
// }} ""
// {{ 1435 1 0 "afb1cbdb_e318_4ae4_8ca6fadb5f67a53f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 50.0;
// }} ""
// {{ 1436 1 0 "0fa95a42_ed6c_4ed8_94c9b2f476501cd1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1437 1 0 "0cbb9ab1_b95e_4717_b4f767ab685c70fc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 23)
{
// }} ""
// {{ 1438 1 0 "5537415c_5378_4ab0_9bdb6e40f5538086" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_50F");
// }} ""
// {{ 1439 1 0 "bb02449e_aa84_4a18_8738bafdc33763fd" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 50.0;
// }} ""
// {{ 1440 1 0 "0cbb9ab1_b95e_4717_b4f767ab685c70fc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1441 1 0 "6d62beec_090a_4f66_b8a01619759a288b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 23)
{
// }} ""
// {{ 1442 1 0 "1d864239_2340_4ad6_b25d61046b2622ba" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_50F");
// }} ""
// {{ 1443 1 0 "e67e4d58_939f_41af_ad229cfd726dafc1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 50.0;
// }} ""
// {{ 1444 1 0 "6d62beec_090a_4f66_b8a01619759a288b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1445 1 0 "a85a8339_304b_4b50_8c0919c28812615d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 36)
{
// }} ""
// {{ 1446 1 0 "ce4152aa_4497_493a_8eefa2d3b3037568" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_300Slim");
// }} ""
// {{ 1447 1 0 "a2d2b096_d3ce_4bdb_ba9689ae9febd97f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 100.0;
// }} ""
// {{ 1448 1 0 "a85a8339_304b_4b50_8c0919c28812615d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1449 1 0 "8984b254_f072_4e3a_858e9346b1820f50" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 45)
{
// }} ""
// {{ 1450 1 0 "8686c57e_e218_4a45_a561993e37a8f35e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_LiquidClass = Translate("TipCheck_300SlimF");
// }} ""
// {{ 1451 1 0 "54dc2a3e_cb04_4374_8c5c982fcf1ca3de" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_CheckVolume = 100.0;
// }} ""
// {{ 1452 1 0 "8984b254_f072_4e3a_858e9346b1820f50" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "_DetermineTipCheckLC" "End"
}
// }} ""
// {{{ 5 "GetTipType" "Begin"
function GetTipType( device & Instrument, sequence i_seq_Tips, variable & o_int_TipType ) void {
// }} ""
private variable str_LabID;
private variable bln_LabwareValid;
// {{ 5 "GetTipType" "InitLocals"
o_int_TipType = 0;
// }} ""
// {{ 363 1 0 "c122f1a0_3179_4fad_aa020c1aa31558a5" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_int_TipType = -1;
// }} ""
// {{{ 364 1 0 "f12bbb2d_b804_4824_8037bb3b41a36a22" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(Instrument, i_seq_Tips);
// }} ""
// {{{ 365 1 0 "4207203d_8c77_4985_8e764dacb1537101" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(i_seq_Tips);
// }} ""
// {{{ 366 1 0 "94f70d03_3d04_4b32_84b74067987fede5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bln_LabwareValid = DevIsValidLabwareForCurrentDeckLayout(Instrument, str_LabID);
// }} ""
// {{ 367 1 0 "d026cfc1_011a_45d3_91500913e1ffd82a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_LabwareValid == BOOLEON::TRUE)
{
// }} ""
// {{{ 368 1 0 "3d638c8e_678c_4b02_bc44348f5cff3075" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(Instrument, str_LabID, o_int_TipType);
// }} ""
// {{ 369 1 0 "d026cfc1_011a_45d3_91500913e1ffd82a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "GetTipType" "End"
}
// }} ""
// {{{ 5 "TipCountNeeded_Add" "Begin"
function TipCountNeeded_Add( variable i_str_TipCounter, variable i_int_NumberOfTips ) void {
// }} ""
private variable int_Index;
private variable int_ExistingTipCount;
private variable int_NewTipCountNeeded;
// {{ 5 "TipCountNeeded_Add" "InitLocals"
// }} ""
// {{ 981 1 0 "ce14fb1a_d26a_434c_a3082c1fc107ba46" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (TT_GLOBAL_VARIABLES::TIP_COUNT::LIBRARY_INITIALIZED == BOOLEON::FALSE)
{
// }} ""
// {{{ 982 1 0 "54d1c37f_7859_4565_9e776a4eebca3b0e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TT_GLOBAL_VARIABLES::TIP_COUNT::InitializeVariables();
// }} ""
// {{ 983 1 0 "3d825e6f_4902_4d91_a6b290beb5a29103" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.SetSize(0);
// }} ""
// {{ 984 1 0 "1715ee1c_09f6_47b2_9af574d60f4a446f" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER.SetSize(0);
// }} ""
// {{ 985 1 0 "2aa69005_b253_4600_8222a5f156c84e20" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
TT_GLOBAL_VARIABLES::TIP_COUNT::LIBRARY_INITIALIZED = BOOLEON::TRUE;
// }} ""
// {{ 986 1 0 "ce14fb1a_d26a_434c_a3082c1fc107ba46" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 987 1 0 "31897509_654f_4820_8853391c568a0f56" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
int_Index = _Lookup(TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER, i_str_TipCounter);
// }} ""
// {{ 988 1 0 "a392c5dc_2ef7_4642_84a14905b3c26d10" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_Index == 0)
{
// }} ""
// {{ 989 1 0 "f5128674_afd1_45af_93aa8c5c1fafccca" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 990 1 0 "addcf9d1_5101_4102_ba001bfe51e079d4" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER.AddAsLast(i_str_TipCounter);
// }} ""
// {{ 991 1 0 "f3447a19_3bbd_474e_840639a593e05208" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.AddAsLast(i_int_NumberOfTips);
// }} ""
// {{ 992 1 0 "a392c5dc_2ef7_4642_84a14905b3c26d10" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 993 1 0 "9b2dc097_8a55_4501_b1aaa4a1f515ff7e" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 994 1 0 "e61cbf70_414e_4a8f_bc168f271030b052" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
int_ExistingTipCount=TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.GetAt(int_Index-1);
// }} ""
// {{ 995 1 0 "09cdd327_7c4b_47e3_8299a3f06a12ee60" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_NewTipCountNeeded = int_ExistingTipCount + i_int_NumberOfTips;
// }} ""
// {{ 996 1 0 "c77445ad_ab12_411d_87c2d8861504eaa4" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.SetAt(int_Index-1, int_NewTipCountNeeded);
// }} ""
// {{ 997 1 0 "a392c5dc_2ef7_4642_84a14905b3c26d10" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "TipCountNeeded_Add" "End"
}
// }} ""
// {{{ 5 "TipCountNeeded_Get" "Begin"
function TipCountNeeded_Get( variable i_str_TipCounter, variable & o_int_NumberOfTips ) void {
// }} ""
private variable int_Index;
private variable _strFunctionName;
private variable l_blnSuccess;
// {{ 5 "TipCountNeeded_Get" "InitLocals"
o_int_NumberOfTips = 0;
// }} ""
// {{ 999 1 0 "fe51a147_cf1e_41cd_9e8925815115d043" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1000 1 0 "53fa9dda_eefb_4d81_8cf59518d4ea8433" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 1002 1 0 "ae419cc8_c1f7_468e_9fb8103e60f99c54" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 1003 1 0 "fe51a147_cf1e_41cd_9e8925815115d043" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1004 1 0 "22e66bfe_5701_49c9_ace477e40e4a0a3c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (TT_GLOBAL_VARIABLES::TIP_COUNT::LIBRARY_INITIALIZED == BOOLEON::FALSE)
{
// }} ""
// {{{ 1005 1 0 "67d38e73_e2d6_4990_86a70b75dc81a248" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TT_GLOBAL_VARIABLES::TIP_COUNT::InitializeVariables();
// }} ""
// {{ 1006 1 0 "dfaa6cd1_9c45_4aa9_a5723c61fa1437b6" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.SetSize(0);
// }} ""
// {{ 1007 1 0 "2a8d2f1f_045a_4c98_a0931b9b38cece60" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER.SetSize(0);
// }} ""
// {{ 1008 1 0 "2a92794d_2fda_4045_bf3e1948e145ebc7" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
TT_GLOBAL_VARIABLES::TIP_COUNT::LIBRARY_INITIALIZED = BOOLEON::TRUE;
// }} ""
// {{ 1009 1 0 "22e66bfe_5701_49c9_ace477e40e4a0a3c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1010 1 0 "6d18b751_791f_45a5_aade04f7f944f635" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
int_Index = _Lookup(TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER, i_str_TipCounter);
// }} ""
// {{ 1011 1 0 "acb2c48d_8ae7_4a29_a8097e14ef5bcf02" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_int_NumberOfTips = 0;
// }} ""
// {{ 1012 1 0 "248099f1_fb51_4840_b9400439a39481f8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_Index == 0)
{
// }} ""
// {{ 1013 1 0 "6c88a6af_7e1a_4077_8e0653901ab8ac3b" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 1014 1 0 "8318c148_2374_4bbd_b75666881797fb32" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER.AddAsLast(i_str_TipCounter);
// }} ""
// {{ 1015 1 0 "71e3f35d_b18b_413d_90e2e1d6cfbe2876" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.AddAsLast(o_int_NumberOfTips);
// }} ""
// {{ 1016 1 0 "248099f1_fb51_4840_b9400439a39481f8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1017 1 0 "c6e0f767_5345_4d5e_bdce2339860c617e" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 1018 1 0 "34e40e7a_08a1_43f0_88071e50e077116a" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
o_int_NumberOfTips=TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.GetAt(int_Index-1);
// }} ""
// {{ 1019 1 0 "248099f1_fb51_4840_b9400439a39481f8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1020 1 0 "9dac6ab6_b012_4400_86020573db704d76" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
o_int_NumberOfTips = HSLExtensions::Core::ConvertToInteger(o_int_NumberOfTips, l_blnSuccess);
// }} ""
// {{{ 1021 1 0 "84ff38df_c360_4444_a51a421df1e42707" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE04(Translate("Tip Counter:  "), i_str_TipCounter, Translate("  --  Current Tips Needed:  "), o_int_NumberOfTips);
// }} ""
// {{ 1022 1 0 "7d3f95fa_dda8_4d43_92f29a96b82a42bc" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1023 1 0 "93425d71_7939_4287_be64db60633b6cb4" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1024 1 0 "7d3f95fa_dda8_4d43_92f29a96b82a42bc" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "TipCountNeeded_Get" "End"
}
// }} ""
// {{{ 5 "TipTypeLength_Get" "Begin"
function TipTypeLength_Get( variable i_int_TipType, variable & o_flt_TipLength ) void {
// }} ""
private variable bln_LengthFound;
// {{ 5 "TipTypeLength_Get" "InitLocals"
o_flt_TipLength = 0;
// }} ""
// {{ 1359 1 0 "fe589990_6870_43df_bfd1e9faf86e803f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_LengthFound = 0;
// }} ""
// {{ 1360 1 0 "1ed7caad_a128_43bb_82ce06b4c3131169" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 0.0;
// }} ""
// {{ 1361 1 0 "a0651279_e5b6_4b52_8e6c7dbb0bd447de" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 0)
{
// }} ""
// {{ 1362 1 0 "f9aa172b_e330_4d6f_a14f6c513eaf93d4" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 51.9;
// }} ""
// {{ 1363 1 0 "a0651279_e5b6_4b52_8e6c7dbb0bd447de" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1364 1 0 "9cc6b7cb_e219_4d23_b031252b150c9f16" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 1)
{
// }} ""
// {{ 1365 1 0 "6e516f62_716f_48bf_9c1e6e7a81c4452c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 51.9;
// }} ""
// {{ 1366 1 0 "9cc6b7cb_e219_4d23_b031252b150c9f16" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1367 1 0 "5076c5e0_c6bb_4dc3_89b32db8f08b84d4" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 30)
{
// }} ""
// {{ 1368 1 0 "2131c885_eefe_476b_9b59803057796d9e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 51.9;
// }} ""
// {{ 1369 1 0 "5076c5e0_c6bb_4dc3_89b32db8f08b84d4" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1370 1 0 "4639b2ac_4068_49fb_bc0c6e9d216bed26" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 2)
{
// }} ""
// {{ 1371 1 0 "84e599c1_dbe9_4021_aa01e7741d261f1e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 21.9;
// }} ""
// {{ 1372 1 0 "4639b2ac_4068_49fb_bc0c6e9d216bed26" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1373 1 0 "cb13f7c0_d1d9_4382_a4cb4b79565a9091" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 3)
{
// }} ""
// {{ 1374 1 0 "c60099b6_2368_45dc_9352fb97d6444a46" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 21.9;
// }} ""
// {{ 1375 1 0 "cb13f7c0_d1d9_4382_a4cb4b79565a9091" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1376 1 0 "12672466_9f69_4109_92a6d77ef2da3205" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 32)
{
// }} ""
// {{ 1377 1 0 "6548c5ee_71f8_4df6_9426d0bc3df655e0" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 21.9;
// }} ""
// {{ 1378 1 0 "12672466_9f69_4109_92a6d77ef2da3205" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1379 1 0 "bb33bab1_31e0_4a68_8ae9592ce3a1536f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 4)
{
// }} ""
// {{ 1380 1 0 "c53f0fbb_6514_467a_bc7bf3f45ce273e9" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 87.1;
// }} ""
// {{ 1381 1 0 "bb33bab1_31e0_4a68_8ae9592ce3a1536f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1382 1 0 "a3b5aad0_b81e_4410_97305964a024f900" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 5)
{
// }} ""
// {{ 1383 1 0 "cc87d368_3eba_488e_a8c8d9defbc76f7f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 87.1;
// }} ""
// {{ 1384 1 0 "a3b5aad0_b81e_4410_97305964a024f900" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1385 1 0 "048e1037_760f_41fe_8b704da0de9e401a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 10)
{
// }} ""
// {{ 1386 1 0 "7b325932_78c2_42a5_9ae7491ae62ab6fe" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 51.9;
// }} ""
// {{ 1387 1 0 "048e1037_760f_41fe_8b704da0de9e401a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1388 1 0 "0eb0a3ba_9edf_49d2_a448d059974a02c4" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 22)
{
// }} ""
// {{ 1389 1 0 "dfcb2ad6_f97f_4b23_a2f729fda6d27107" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 42.4;
// }} ""
// {{ 1390 1 0 "0eb0a3ba_9edf_49d2_a448d059974a02c4" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1391 1 0 "52de7a1e_2aa5_4f27_8e3ae45aa981c1cb" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 23)
{
// }} ""
// {{ 1392 1 0 "55667f2f_2149_4b87_913e3369132c06ee" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 42.4;
// }} ""
// {{ 1393 1 0 "52de7a1e_2aa5_4f27_8e3ae45aa981c1cb" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1394 1 0 "0fe34872_bffe_43ab_8e4836e3f18f48bb" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 31)
{
// }} ""
// {{ 1395 1 0 "1ca28080_2208_430a_a9fc6e67e8dcf0eb" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 42.4;
// }} ""
// {{ 1396 1 0 "0fe34872_bffe_43ab_8e4836e3f18f48bb" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1397 1 0 "32716e2b_815f_4e12_b59354f8043552de" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 36)
{
// }} ""
// {{ 1398 1 0 "c169b895_ade8_44c7_b47795bf114db758" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 87.0;
// }} ""
// {{ 1399 1 0 "32716e2b_815f_4e12_b59354f8043552de" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1400 1 0 "65cf7499_952e_48d1_9771094b5a32118c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_int_TipType == 45)
{
// }} ""
// {{ 1401 1 0 "4334f250_387c_41da_a5fc235e0012acd8" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_flt_TipLength = 87.0;
// }} ""
// {{ 1402 1 0 "65cf7499_952e_48d1_9771094b5a32118c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "TipTypeLength_Get" "End"
}
// }} ""
// {{{ 5 "TipCheckMPH96" "Begin"
function TipCheckMPH96( device & Instrument, sequence & io_seq_Tips, variable i_str_TipCounter ) void {
// }} ""
private dialog customDialogD43E7E782FE34cdaA671A8701DC07C7B;
private variable int_CurrentPosition;
private variable flt_TipCapacity;
private variable str_TipMessage;
private variable int_EndPosition;
private variable int_PositionsRemaining;
private variable str_TipName;
private variable int_TipsNeeded;
// {{ 5 "TipCheckMPH96" "InitLocals"
// }} ""
// {{ 950 1 0 "7fceda9a_1390_4d11_b04ce80259e13a0a" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("=========  Check tip sequence"));
// }} ""
// {{{ 951 1 0 "a94b6eab_b7b8_41df_a17e24e356efb5e0" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(Instrument, io_seq_Tips, flt_TipCapacity);
// }} ""
// {{ 952 1 0 "ccb4fef8_4bb4_4607_8330134e81ac792c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 953 1 0 "0ddf6a85_217b_40b8_92b0c770711a227e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 954 1 0 "ccb4fef8_4bb4_4607_8330134e81ac792c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 955 1 0 "9cf7e486_a614_4589_8731b4e125b8a5ee" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 956 1 0 "a9b6a77a_7ca9_4e74_ad74041d87a8c2c4" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 957 1 0 "2aca5e0f_584f_4584_b1b7b559bbf2be10" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_TipsNeeded = 96;
// }} ""
// {{ 958 1 0 "c055fdb8_c847_4b26_86ec1462966260e3" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (1 == 1)
{
// }} ""
// {{ 959 1 0 "da6b2b50_0180_4b4b_82ce31b8ea8ec6fb" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
int_CurrentPosition = io_seq_Tips.GetCurrentPosition();
// }} ""
// {{ 960 1 0 "d0c66ddd_21af_4ab4_b9ab7b6dab5e2c24" "{B31F353D-5D80-11d4-A5EB-0050DA737D89}"
int_EndPosition = io_seq_Tips.GetCount();
// }} ""
// {{ 961 1 0 "661bfaaa_426f_4084_88afb86a2c14d8f5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_CurrentPosition == 0)
{
// }} ""
// {{ 962 1 0 "3cd2488b_6e27_4a4b_a7c403f717af2537" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_CurrentPosition = int_EndPosition + 1;
// }} ""
// {{ 963 1 0 "661bfaaa_426f_4084_88afb86a2c14d8f5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 964 1 0 "3921ea91_0697_4547_8df43da55dab8db7" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_PositionsRemaining = int_EndPosition - int_CurrentPosition;
// }} ""
// {{ 965 1 0 "d75a8109_d99f_465d_bc11296389bc857b" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_PositionsRemaining = int_PositionsRemaining + 1;
// }} ""
// {{ 966 1 0 "6c1f1188_67c0_4dcb_8f401015521d1da9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_PositionsRemaining > 0)
{
// }} ""
// {{{ 967 1 0 "a5029a33_09a5_4619_b48aacaf609829a2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_PositionsRemaining = SeqGetPositionCountForCurrLabware(io_seq_Tips);
// }} ""
// {{ 968 1 0 "6c1f1188_67c0_4dcb_8f401015521d1da9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
Trace("     ","Positions Remaining:  ",int_PositionsRemaining,"  Tips Needed:  ",int_TipsNeeded);
// {{ 970 1 0 "46efc6b4_8501_4bb1_ac16bd625ccb9049" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_PositionsRemaining >= int_TipsNeeded)
{
// }} ""
// {{ 971 1 0 "1049c334_689e_4c66_82fb21acb84d412f" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Sufficient tips found"));
// }} ""
// {{ 972 1 0 "48d95800_42b4_4221_8bdf7833727fefb4" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 973 1 0 "46efc6b4_8501_4bb1_ac16bd625ccb9049" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 974 1 0 "cff4e35a_66a9_47d4_ac2f416a3927314d" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{ 975 1 0 "8e6a0a2d_5251_4cf4_a0d3fd1351563c78" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialogD43E7E782FE34cdaA671A8701DC07C7B.InitCustomDialog( "8e6a0a2d_5251_4cf4_a0d3fd1351563c78" );
customDialogD43E7E782FE34cdaA671A8701DC07C7B.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialogD43E7E782FE34cdaA671A8701DC07C7B.ShowCustomDialog();
// }} ""
// {{ 976 1 0 "5676a1da_d935_4dd4_bfce5ac45d9afeb9" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 977 1 0 "62d1393d_580f_4ccf_9b08320fb031cfb7" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(Instrument, io_seq_Tips);
// }} ""
// {{{ 978 1 0 "d6232f6f_c1a1_4617_a97c647bbd0d544d" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(Instrument, io_seq_Tips, i_str_TipCounter, 99999);
// }} ""
// {{ 979 1 0 "c055fdb8_c847_4b26_86ec1462966260e3" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{{ 5 "TipCheckMPH96" "End"
}
// }} ""
// {{{ 5 "_LocalTipCounterRead" "Begin"
private function _LocalTipCounterRead( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter ) void {
// }} ""
private variable bln_SimMode;
private variable bln_FileExists;
private variable str_TipCounterFolder;
private variable str_TipCounter;
// {{ 5 "_LocalTipCounterRead" "InitLocals"
// }} ""
// {{{ 1526 1 0 "b9013fa9_68ec_4009_8771bb61250267dc" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Read tip counter:  "), i_str_TipCounter);
// }} ""
// {{{ 1527 1 0 "72dc9b1f_2f28_454b_a2d0aa11bd98b46b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bln_SimMode = Util::GetSimulationMode();
// }} ""
// {{ 1528 1 0 "c3cf1b55_05e4_44fa_a39bdaf9104394be" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_SimMode == 1)
{
// }} ""
// {{{ 1529 1 0 "554bc948_5b89_436a_92753a6d9a9bb46e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_TipCounter = StrConcat2(Translate("SIM_"), i_str_TipCounter);
// }} ""
// {{ 1530 1 0 "c3cf1b55_05e4_44fa_a39bdaf9104394be" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1531 1 0 "dec3f95c_ad18_4ca9_a6f5a5a0e550ae3e" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipCounterFolderPath(str_TipCounterFolder);
// }} ""
// {{{ 1532 1 0 "1108cfb8_e4cc_4017_b58ddbcda30e1c32" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_RemoveInvalidCharacters(i_str_TipCounter);
// }} ""
// {{{ 1533 1 0 "6c52abc9_9d85_4d73_87685444aff598ec" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipCounter = StrConcat4(str_TipCounterFolder, i_str_TipCounter, Translate(".txt"), Translate(""));
// }} ""
// {{{ 1534 1 0 "9a0c8423_5564_4a99_9e7693253baf2bbe" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bln_FileExists = HSLExtensions::File::Exists(str_TipCounter);
// }} ""
// {{ 1535 1 0 "de9e5522_bd6b_4945_b9f7749e2f18ec01" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_FileExists == 0)
{
// }} ""
// {{{ 1536 1 0 "377a78ea_d5ab_46c4_865644e325c976c7" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 1537 1 0 "be8da422_246d_4d8e_a2fa0e7c9286e908" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Now creating tip counter:  "), i_str_TipCounter);
// }} ""
// {{ 1538 1 0 "de9e5522_bd6b_4945_b9f7749e2f18ec01" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{{ 1539 1 0 "c759dad7_6e02_4a25_af47283de2295495" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_TipSequence);
// }} ""
// {{{ 1540 1 0 "40fa33f3_c6cc_4e09_807853b2ed2af18f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Now reading tip counter:  "), i_str_TipCounter);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition;
   string str_Temp;
   file ReadTipCounter;

   ReadTipCounter.RemoveFields();
   ReadTipCounter.AddField("LAB_ID",str_LabID,hslString);
   ReadTipCounter.AddField("POS_ID",str_PosID,hslString);

   ReadTipCounter.SetExtendedProperties("HDR=YES");
   ReadTipCounter.SetExtendedProperties("Text");
   ReadTipCounter.SetDelimiter(hslTabDelimited);
   ReadTipCounter.Open(str_TipCounter, hslAppend);
   

   while(ReadTipCounter.Eof() == 0)
   {
      ReadTipCounter.ReadRecord();

      if(ML_STAR.IsValidLabwareForCurrentDeckLayout(str_LabID))
      {
         io_seq_TipSequence.Add(str_LabID,str_PosID);
      }
   }

   ReadTipCounter.Close();
   ReadTipCounter.RemoveFields();

   io_seq_TipSequence.SetCurrentPosition(1);
}
// {{ 1542 1 0 "de9e5522_bd6b_4945_b9f7749e2f18ec01" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "_LocalTipCounterRead" "End"
}
// }} ""
// {{{ 5 "TipCounter_SetShow" "Begin"
function TipCounter_SetShow( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_int_TimeOut, variable i_int_StartPosition, variable i_int_EndPosition ) void {
// }} ""
private variable _strFunctionName;
private variable l_strSequenceName;
private variable l_intTotalPositions;
private variable l_intAvailable;
private variable l_strError;
private variable l_intTipType;
private variable l_strInstrumentClass;
private variable l_strLabID;
private variable l_intEmptyCheck;
// {{ 5 "TipCounter_SetShow" "InitLocals"
// }} ""
// {{ 1113 1 0 "fb2b9e71_e930_469b_8caa9819b65a26a7" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 1114 1 0 "ecb55238_39ef_4e6a_aaafa9e0c567cb59" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 1116 1 0 "0da5c76a_5b94_4b2d_9d63978914846608" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 1117 1 0 "fb2b9e71_e930_469b_8caa9819b65a26a7" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1118 1 0 "75e91eaa_6fca_4365_aa00667af6b6c93e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_OFFSET_GLOBAL::INIT::InitializeVariables();
// }} ""
// {{{ 1119 1 0 "c33027d9_1dc3_401a_846a9f725b7a9c9b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::InitTipCountingLibrary();
// }} ""
// {{{ 1120 1 0 "3cf8fd64_ff07_4c3a_8ed9b83b2a3b6240" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_TipCounter = StrConcat2(i_str_TipCounter, Translate(""));
// }} ""
// {{ 1121 1 0 "c98e22ba_44a2_44cb_8028c70655e3ed9d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (i_str_TipCounter == "")
{
// }} ""
// {{{ 1122 1 0 "109ad012_a1b6_4bff_a4c38558217e6c49" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strError = StrConcat4(Translate("Tip counter '"), i_str_TipCounter, Translate("' is invalid!"), Translate(""));
// }} ""
// {{{ 1123 1 0 "e359a53c_a8d7_4a59_b671559248057664" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
ErrRaise(101, l_strError);
// }} ""
// {{ 1124 1 0 "c98e22ba_44a2_44cb_8028c70655e3ed9d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 1125 1 0 "e68a2085_603c_4576_b07c37a717414937" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(io_seq_TipSequence);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 1126 1 0 "efe02e4f_9fba_4bf1_94f731a6f59fca55" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
l_strLabID = Translate("");
// }} ""
// {{ 1127 1 0 "2b42ec5a_d8d9_4c44_bc7e9d023cbc42f9" "{B31F353B-5D80-11d4-A5EB-0050DA737D89}"
l_intEmptyCheck = io_seq_TipSequence.GetCurrentPosition();
// }} ""
{
   sequence sequenceObj;

   ML_STAR.CopyResetSequence(io_seq_TipSequence.GetName(), sequenceObj);
   l_strLabID = sequenceObj.GetLabwareId();

   if(l_intEmptyCheck == 0) ML_STAR.CopyResetSequence(io_seq_TipSequence.GetName(), io_seq_TipSequence);
}
// {{{ 1129 1 0 "ec09b446_e5cb_46ea_b34d7c7943ff2404" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetSequenceName(ML_STAR, io_seq_TipSequence, l_strSequenceName, l_intTotalPositions);
// }} ""
// {{{ 1130 1 0 "4d425b7a_a8b2_4df3_af75c5ebd4f4c637" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(ML_STAR, l_strLabID, l_intTipType);
// }} ""
// {{ 1131 1 0 "f81b6d9d_3eaa_4028_ae599aeb9562ba85" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_intTipType != -1)
{
// }} ""
// {{{ 1132 1 0 "d538d340_b634_4801_967b85458cb58604" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE04(Translate("     Start and End position ::  "), i_int_StartPosition, Translate(" - "), i_int_EndPosition);
// }} ""
// {{{ 1133 1 0 "f8f3c273_9ac5_41cf_92c98e0ef10456e7" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strInstrumentClass = DevGetInstrumentName(ML_STAR);
// }} ""
// {{{ 1134 1 0 "7c72e7ac_b6e5_4b49_a0765312cc53642f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CheckTipCounterName(i_str_TipCounter);
// }} ""
// {{{ 1135 1 0 "24c4b78a_1114_408a_8db2fbb6d1cab259" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Read tip counter:  "), i_str_TipCounter);
// }} ""
// {{{ 1136 1 0 "016644af_a5cc_4629_ba9278ee030a9e43" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::CreateNewHxElementCounter(io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1137 1 0 "cdd3df33_c314_4f82_b9421936524c9c45" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::ReadFromHxElementCounter(ML_STAR, io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1138 1 0 "90a184be_8010_4e33_81b10715add3ba5f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::EditSequence2(ML_STAR, io_seq_TipSequence, BOOLEON::FALSE, i_int_StartPosition, i_int_EndPosition, i_int_TimeOut);
// }} ""
// {{{ 1139 1 0 "7df6a44b_52e9_48ec_bfecdba09e565cb3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::WriteHxElementCounter(io_seq_TipSequence, l_intTipType, i_str_TipCounter, l_strInstrumentClass);
// }} ""
// {{{ 1140 1 0 "55d5e758_d461_425a_886d5e45286ea4b6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_intAvailable = SeqGetTotal(io_seq_TipSequence);
// }} ""
// {{{ 1141 1 0 "342d79c8_ae66_421a_8e4197088f614e0f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE08(l_strSequenceName, Translate(" :: "), l_intAvailable, Translate(" / "), l_intTotalPositions, Translate(""), Translate(""), Translate(""));
// }} ""
// {{{ 1142 1 0 "901e4536_b168_4be3_bcc395a7a25a56f9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, io_seq_TipSequence, 5, Translate(""));
// }} ""
// {{ 1143 1 0 "f81b6d9d_3eaa_4028_ae599aeb9562ba85" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1144 1 0 "0a523a60_8738_4272_887e95578cd7f542" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("COULD NOT DETERMINE TIP TYPE!"));
// }} ""
// {{ 1145 1 0 "f81b6d9d_3eaa_4028_ae599aeb9562ba85" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 1146 1 0 "0792faca_5c5f_4269_aee80f0afaf068be" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 1147 1 0 "417e245f_6270_4b86_912c2f860d16f40f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 1148 1 0 "0792faca_5c5f_4269_aee80f0afaf068be" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "TipCounter_SetShow" "End"
}
// }} ""
// {{{ 5 "_ConvertToInteger" "Begin"
private function _ConvertToInteger( variable & io_Value ) void {
// }} ""
// {{ 5 "_ConvertToInteger" "InitLocals"
// }} ""
// {{{ 1412 1 0 "28c4ea7b_48bb_4b10_b72ed76d4a8739d8" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
io_Value = StrConcat2(io_Value, Translate(""));
// }} ""
// {{{ 1413 1 0 "fdd205cd_aef4_4e23_864df13ce8ffdad8" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
io_Value = StrIVal(io_Value);
// }} ""
// {{{ 5 "_ConvertToInteger" "End"
}
// }} ""
// {{{ 5 "Optimized1mLTipPickup" "Begin"
function Optimized1mLTipPickup( device & ML_STAR, sequence & io_seq_TipSequence, sequence i_seq_ControlSequence, variable i_str_TipCounter, variable & o_str_ChannelPattern ) void {
// }} ""
private variable _strFunctionName;
private variable flt_YRaster;
private variable int_TotalPositionsRemaining;
private variable bool_FileExists;
private variable str_TempSortingFilePath;
private variable int_TotalChannels;
private variable int_TipsNeeded;
private sequence seq_RemainingSequence;
private variable arr_YMin[];
private variable arr_YMax[];
private file WriteFile;
private variable bln_Used;
private file SortFile;
private variable arr_GroupedLabID[];
private variable arr_GroupedXCoords[];
private variable arr_GroupedCounts[];
private variable int_TotalOptions;
private file UpdateFile;
private variable arr_GroupNumber[];
private variable int_SeqIndex;
private variable str_LabID;
private variable str_PosID;
private variable flt_NotUsed;
private variable flt_CurrentX;
private variable flt_CurrentY;
private variable flt_TargetX;
private variable flt_PreviousY;
private variable bln_OptimizationNeeded;
private variable bln_EnoughTipsLoaded;
private dialog customDialog7F76208478B54fc8976FBA49C9208278;
private variable str_TipMessage;
private variable flt_TipCapacity;
private variable str_TipName;
// {{ 5 "Optimized1mLTipPickup" "InitLocals"
o_str_ChannelPattern = 0;
// }} ""
// {{ 371 1 0 "cf769fd9_4d98_4f21_a2b9368ec5cfa97d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 372 1 0 "ff8050e6_b88e_4228_a60ff028c843a5e1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 374 1 0 "1bfca4ff_1962_47a7_b7c1ddf1ddc030b3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 375 1 0 "cf769fd9_4d98_4f21_a2b9368ec5cfa97d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 376 1 0 "b9d758ba_677a_4b5e_92b90e3685e20ad2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_ChannelPattern = Translate("");
// }} ""
// {{{ 377 1 0 "156754fb_8da1_43d2_825b4c4dffaa029e" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get1mLChannelCount(ML_STAR, int_TotalChannels);
// }} ""
// {{{ 378 1 0 "5afb9412_01d6_4879_8c743dc9df5bdc73" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetChannelLimits(ML_STAR, 0, arr_YMax, arr_YMin, flt_YRaster);
// }} ""
// {{{ 379 1 0 "45220874_539f_468b_9f7a55a957b1d600" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, i_seq_ControlSequence);
// }} ""
// {{{ 380 1 0 "1005b078_4044_4658_8981b4fffa21c769" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TotalPositionsRemaining = SeqGetTotal(i_seq_ControlSequence);
// }} ""
// {{ 381 1 0 "5f76d4f9_92b7_4969_b55f32145837dbc1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_TipsNeeded = int_TotalPositionsRemaining;
// }} ""
// {{ 382 1 0 "4a665744_325a_4e7a_aa31b3655ac0e9b3" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipsNeeded > int_TotalChannels)
{
// }} ""
// {{ 383 1 0 "c2cb78a6_52c6_4141_924a59525840fea7" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_TipsNeeded = int_TotalChannels;
// }} ""
// {{ 384 1 0 "4a665744_325a_4e7a_aa31b3655ac0e9b3" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 385 1 0 "17cf1abe_7b93_43ee_81a508eb844a2143" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipsNeeded == 0)
{
// }} ""
// {{ 386 1 0 "63439744_55f2_49ab_b217da8e54088a74" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 387 1 0 "3315c365_3ae1_4327_9d31c3693f828e44" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 388 1 0 "63439744_55f2_49ab_b217da8e54088a74" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 389 1 0 "86aed8e3_27e5_467b_b310446b10d182d4" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return;
// }} ""
// {{ 390 1 0 "17cf1abe_7b93_43ee_81a508eb844a2143" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 391 1 0 "ae6b6124_40fe_46bd_809f9670a8c06b08" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (BOOLEON::TRUE == BOOLEON::TRUE)
{
// }} ""
// {{{ 392 1 0 "6944e0f4_6f68_4b06_85c4fb84577a019d" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCheck(ML_STAR, io_seq_TipSequence, i_str_TipCounter, int_TipsNeeded);
// }} ""
// {{{ 393 1 0 "1dd2f6b0_ab60_461f_ae83822e28dd8398" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqCopySequence(seq_RemainingSequence, io_seq_TipSequence);
// }} ""
// {{{ 394 1 0 "617ab7cc_9e9c_458d_98aa0f5dec9cc6c8" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, seq_RemainingSequence);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 395 1 0 "94190447_1bdf_448e_9df45e9d72e50462" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_SortSequenceYPriority(ML_STAR, seq_RemainingSequence);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 396 1 0 "47330eff_16bd_4b9e_bdf343b61c9051e2" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 397 1 0 "e78cd55d_95d2_48cf_8db3d599cc5b7400" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 398 1 0 "0aec118a_dea6_4574_b6a2c8fdb684bc28" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 399 1 0 "d1f23c98_04ec_42b5_bea7f08d4100d537" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 400 1 0 "0aec118a_dea6_4574_b6a2c8fdb684bc28" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 401 1 0 "8e38af26_704f_4815_89f1a86387cb40eb" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
BuildChannelPattern(int_TipsNeeded, int_TotalChannels, o_str_ChannelPattern);
// }} ""
// {{ 402 1 0 "749c8882_11da_4bd4_894f906d8a80947d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 403 1 0 "c3ff48b9_a775_4329_a37e794b8cf8430f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::FALSE;
// }} ""
// {{ 404 1 0 "dad70b1d_09df_42e6_b8ec46aae962a94a" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_SeqIndex = 0; int_SeqIndex < int_TipsNeeded;)
{
int_SeqIndex = int_SeqIndex + 1;
// }} ""
// {{{ 405 1 0 "2b6551e2_bdf7_48a0_852307ef9f81754a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(seq_RemainingSequence);
// }} ""
// {{{ 406 1 0 "35ec9408_8796_4326_b46a77a6a9ad0e27" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PosID = SeqGetPositionId(seq_RemainingSequence);
// }} ""
// {{{ 407 1 0 "61ee662c_376c_4e3e_965d07ff027cc318" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqIncrement(seq_RemainingSequence, 1);
// }} ""
// {{{ 408 1 0 "ce4264d4_1bdf_4d89_aab5c8c450008a72" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_CurrentX, flt_CurrentY, flt_NotUsed, flt_NotUsed);
// }} ""
// {{ 409 1 0 "79637ec8_74a6_49d5_9045d6fcd7e556a9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY <= arr_YMax.ElementAt( int_SeqIndex -1))
{
// }} ""
// {{ 410 1 0 "33523935_7b56_45f3_b9026b7df89b012d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY >= arr_YMin.ElementAt( int_SeqIndex -1))
{
// }} ""
// {{ 411 1 0 "8cb3784d_5c2d_4cf7_bb5f00482b9a3399" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_SeqIndex == 1)
{
// }} ""
// {{ 412 1 0 "96538746_c20a_433f_ac2a6dc03ee4ba8d" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TargetX = flt_CurrentX;
// }} ""
// {{ 413 1 0 "b03df9f7_83fe_4cb1_8e398f6257747414" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_CurrentY;
// }} ""
// {{ 414 1 0 "8cb3784d_5c2d_4cf7_bb5f00482b9a3399" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 415 1 0 "c8c14864_7529_4468_bd4b29ce78871f53" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentX != flt_TargetX)
{
// }} ""
// {{ 416 1 0 "90650163_913a_4d98_b1b6f04390cd2cbb" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 417 1 0 "1b6a59ae_e5e8_492d_9ac76d982f927c2e" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 418 1 0 "c8c14864_7529_4468_bd4b29ce78871f53" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 419 1 0 "05930ba5_d41c_4739_bb01300f043a71e5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY > flt_PreviousY)
{
// }} ""
// {{ 420 1 0 "8d9062f3_3aa0_4fe2_977f5c49b7b4db34" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 421 1 0 "7975ce62_8579_4363_9a4c4e683e032fc6" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 422 1 0 "05930ba5_d41c_4739_bb01300f043a71e5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 423 1 0 "69887eb8_174b_4fdf_a72c4ad2d66d5065" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_CurrentY;
// }} ""
// {{ 424 1 0 "8cb3784d_5c2d_4cf7_bb5f00482b9a3399" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 425 1 0 "33523935_7b56_45f3_b9026b7df89b012d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 426 1 0 "36ba7e44_9265_4924_b0f688c96af2cc5e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 427 1 0 "9d903474_f5f6_420a_81bb265ef0e4f237" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 428 1 0 "33523935_7b56_45f3_b9026b7df89b012d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 429 1 0 "79637ec8_74a6_49d5_9045d6fcd7e556a9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 430 1 0 "3a0c7e50_9b3d_485e_bbf918d5fd692d31" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 431 1 0 "67b48904_c3c2_4713_aa445d42ce5c5d2c" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 432 1 0 "79637ec8_74a6_49d5_9045d6fcd7e556a9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 433 1 0 "dc610b9b_bbfc_41e1_bc7be416ce52850c" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_PreviousY - flt_YRaster;
// }} ""
// {{ 434 1 0 "dad70b1d_09df_42e6_b8ec46aae962a94a" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 435 1 0 "10b42ed3_8589_467b_a0869326693f1e11" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_RemainingSequence.SetCurrentPosition(1);
// }} ""
// {{ 436 1 0 "749c8882_11da_4bd4_894f906d8a80947d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 437 1 0 "f51a2f33_2ef9_42fb_97fe75ace8133887" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_OptimizationNeeded == BOOLEON::TRUE)
{
// }} ""
// {{{ 438 1 0 "1d18bd64_4344_4c3b_b260debc70c5039d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 439 1 0 "90fdc995_df18_4438_9c5f2ae004ed0bda" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 440 1 0 "c7cce388_17ea_474b_8ed176e1bbc3cdb1" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 441 1 0 "90fdc995_df18_4438_9c5f2ae004ed0bda" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 442 1 0 "fbfbd48b_efd7_4555_bea9746d989d85e2" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequence(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 443 1 0 "bc37981f_03fe_4815_856ee700ccccb605" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequenceRaster(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE, flt_YRaster);
// }} ""
// {{ 444 1 0 "dc1954a1_445f_44c1_84c2549e0da10194" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX;

   WriteFile.RemoveFields();
   WriteFile.AddField("INDEX", int_PositionCount, hslInteger);
   WriteFile.AddField("USED", bln_Used, hslInteger);
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   WriteFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   WriteFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_RemainingSequence.GetTotal();

   WriteFile.SetExtendedProperties("HDR=YES");
   WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite);
   
   int_PositionCount = 1;   
   int_Group = 0;
   flt_CurrentX = -100.0;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_RemainingSequence.SetCurrentPosition(i);

      str_LabID = seq_RemainingSequence.GetLabwareId();
      str_PosID = seq_RemainingSequence.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);

      if(flt_CurrentX != flt_X_Coord)
      {
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
         int_ChannelIndex = 1;
      }

      if(int_ChannelIndex > int_TotalChannels)
      {
         int_ChannelIndex = 1;
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
      }
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   WriteFile.Close();
   WriteFile.RemoveFields();
}
// {{ 446 1 0 "ed0b5112_55e4_4635_997daa9456cb2658" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 447 1 0 "1f202f8e_a990_441f_b6f545ad0450e1e3" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedLabID.SetSize(0);
// }} ""
// {{ 448 1 0 "907f4b7f_9e51_40d2_a2e46ca8010f4791" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedXCoords.SetSize(0);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 449 1 0 "e73b9a24_949f_43dc_84ffcc0f9a64ce1c" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupNumber.SetSize(0);
// }} ""
// {{ 450 1 0 "8507f2f7_3be3_459c_a1b5a42fc6b401ea" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedCounts.SetSize(0);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, int_Group;

SortFile.RemoveFields();

      //str_SQL = "SELECT [GROUP], Y_COORD, COUNT(*) AS N FROM (SELECT * FROM SORT ORDER BY Y_COORD DESC, X_COORD ASC) GROUP BY [GROUP], Y_COORD ORDER BY Y_COORD DESC";
      str_SQL = "SELECT [GROUP], N FROM (SELECT [GROUP], COUNT(*) AS N FROM SORT GROUP BY [GROUP]) ORDER BY [GROUP] ASC";
      //SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("GROUP", int_Group, hslFloat);
      SortFile.AddField("N", int_Count, hslInteger);

      int_TotalValues = seq_RemainingSequence.GetTotal();

      SortFile.SetExtendedProperties("HDR=YES");
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   
      str_LabID = "";
      flt_Y_Coord = 0.0;

      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         arr_GroupNumber.AddAsLast(int_Group);
         arr_GroupedCounts.AddAsLast(int_Count);
      }

      SortFile.Close();
      SortFile.RemoveFields();

}
// {{ 452 1 0 "584ea2f0_d870_443c_94dd6ed0d13e5d68" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 453 1 0 "64f2fc95_b796_4657_87124cdadf71ae30" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalOptions=arr_GroupedCounts.GetSize();
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 454 1 0 "68443eba_7a48_4dc1_b0f3684344378a07" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Counts           Group"), arr_GroupedCounts, arr_GroupNumber);
// }} ""
// {{{ 455 1 0 "535f0b9e_b6aa_490a_bf8dfaf9d5761b76" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_3(Translate("Counts     Lab          X"), arr_GroupedCounts, arr_GroupedLabID, arr_GroupedXCoords);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 456 1 0 "422bb0dd_c8d3_4465_9229dc15d5b2c97a" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount;

   bln_UseOptimization = hslFalse;

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("GROUP", int_Group, hslInteger);

   str_SQL = "SELECT INDEX, LAB_ID, X_COORD, Y_COORD, [GROUP] FROM SORT ORDER BY LAB_ID ASC, Y_COORD DESC, X_COORD ASC";
   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      //Util::Lookup(arr_GroupedCounts,int_Group,a);
      //Trace("Group:  ", int_Group,"  Count:  ",arr_GroupedCounts.GetAt(int_Group-1),"  Tips needed:  ",int_TipsNeeded);
      if(arr_GroupedCounts.GetAt(int_Group-1) >= int_TipsNeeded)
      {
         int_Group = StrConcat2(int_Group,"");
         bln_UseOptimization = hslTrue;
         break;
      }
   }

   //int_Index = StrConcat2(int_Index,"");   

   SortFile.Close();
   SortFile.RemoveFields();

//Trace("Lab ID:  ",str_LabID,"  X Coord:  ",flt_XCoord);
//Trace("Group:  ",int_Group);
//Trace("Use Optimization:  ",bln_UseOptimization);
if(bln_UseOptimization == hslTrue)
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD, [GROUP] FROM SORT WHERE [GROUP] = " + int_Group + " ORDER BY X_COORD ASC, Y_COORD DESC";

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("GROUP",int_Group, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   i = 0;
   str_InValue = "(";
   while(SortFile.Eof() == 0)
   {
      i = i + 1;
      if(i > int_TipsNeeded) break;
      SortFile.ReadRecord();
      if(i > 1) str_InValue = str_InValue + ", ";
      str_InValue = StrConcat2(str_InValue , int_Index);
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   UpdateFile.RemoveFields();
   str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
   UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   UpdateFile.Close();
   UpdateFile.RemoveFields();
}
else
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD FROM SORT ORDER BY X_COORD ASC, Y_COORD DESC";
   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

      i = 0;
   str_InValue = "(";
   int_ChannelCount = 1;
   int_UpdateCount = 0;
   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      i = i + 1;
      if(int_ChannelCount > int_TipsNeeded) break;
      if(flt_Y_Coord <= arr_YMax.GetAt(int_ChannelCount-1))
      {
         if(flt_Y_Coord >= arr_YMin.GetAt(int_ChannelCount-1))
         {
            if(int_ChannelCount > 1) str_InValue = str_InValue + ", ";
            str_InValue = StrConcat2(str_InValue , int_Index);
            int_ChannelCount = int_ChannelCount + 1;
            int_UpdateCount = int_UpdateCount + 1;
         }
      }
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_UpdateCount>0)
   {
      UpdateFile.RemoveFields();
      str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;

      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }
}

}
// {{ 458 1 0 "79ca8ef7_0859_4630_9edbcfc4a7206bb0" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 459 1 0 "8aa6a639_609a_4ac9_90b1aeeee2dbc418" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_TipSequence);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL;

   SortFile.RemoveFields();

   str_SQL = "SELECT USED, LAB_ID, POS_ID FROM SORT ORDER BY USED DESC, LAB_ID ASC, X_COORD ASC, Y_COORD DESC";

   SortFile.AddField("USED", bln_Used, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("POS_ID", str_PosID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      SeqAdd(io_seq_TipSequence, Translate(str_LabID), Translate(str_PosID));
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 461 1 0 "aa643804_178c_4baf_84594dbef4d47f6c" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
io_seq_TipSequence.SetCurrentPosition(1);
// }} ""
// {{ 462 1 0 "603f136b_cea4_408a_89602343754e6caa" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_EnoughTipsLoaded = BOOLEON::TRUE;
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL;

   SortFile.RemoveFields();

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE USED = 2";

   SortFile.AddField("N", int_Count, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_Count < int_TipsNeeded) bln_EnoughTipsLoaded = hslFalse;
}
// {{ 464 1 0 "2d293935_3f70_4483_81a5583e1cb4ffb9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_EnoughTipsLoaded == BOOLEON::FALSE)
{
// }} ""
// {{ 465 1 0 "45ce0a0b_c565_49a7_856bcda016d43338" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{{ 466 1 0 "27043be1_606e_480d_934ba065d7f07b19" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(ML_STAR, io_seq_TipSequence, flt_TipCapacity);
// }} ""
// {{ 467 1 0 "d42dfe54_4b07_4e2b_baae65c3945b678f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 468 1 0 "052611b9_47dc_4c48_870452e835113684" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 469 1 0 "d42dfe54_4b07_4e2b_baae65c3945b678f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 470 1 0 "67df56f1_3c0c_427a_abd0c4c16332cad9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 471 1 0 "78154304_1a25_4eae_8b9b75d22d615ece" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 472 1 0 "4a741716_8aee_4a29_9872c9785017bc55" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialog7F76208478B54fc8976FBA49C9208278.InitCustomDialog( "4a741716_8aee_4a29_9872c9785017bc55" );
customDialog7F76208478B54fc8976FBA49C9208278.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialog7F76208478B54fc8976FBA49C9208278.ShowCustomDialog();
// }} ""
// {{{ 473 1 0 "c75a23cc_72d8_41ff_a89e6be443eecb3c" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 474 1 0 "78888d10_3cd1_4681_864a8b09d8e4fd05" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(ML_STAR, io_seq_TipSequence, i_str_TipCounter, 99999);
// }} ""
// {{ 475 1 0 "2d293935_3f70_4483_81a5583e1cb4ffb9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 476 1 0 "46cd72e6_d4cd_43a9_b9b3050e93669a9b" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 477 1 0 "2d293935_3f70_4483_81a5583e1cb4ffb9" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 478 1 0 "dc1954a1_445f_44c1_84c2549e0da10194" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 479 1 0 "f51a2f33_2ef9_42fb_97fe75ace8133887" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 480 1 0 "6edd3fab_47cf_4d12_8c1c0dc9e7ffb4ca" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 481 1 0 "f51a2f33_2ef9_42fb_97fe75ace8133887" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 482 1 0 "ae6b6124_40fe_46bd_809f9670a8c06b08" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 483 1 0 "1a0e64cf_770c_4136_a06f09b7186be979" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 484 1 0 "e1697e79_74b0_462b_8fe1066a5eb13603" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 485 1 0 "1a0e64cf_770c_4136_a06f09b7186be979" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "Optimized1mLTipPickup" "End"
}
// }} ""
// {{{ 5 "_SortSequenceYPriority" "Begin"
private function _SortSequenceYPriority( device & Instrument, sequence & io_Sequence ) void {
// }} ""
private variable str_TempSortingFilePath;
private variable str_SQL_Sort;
// {{ 5 "_SortSequenceYPriority" "InitLocals"
// }} ""
// {{{ 1572 1 0 "803725d1_f690_4985_96c7c2207e9a9e1b" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 1573 1 0 "7c7872d1_05ae_4674_a2ab5208f42f12c2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_SQL_Sort = StrConcat4(Translate("SELECT * FROM SORT ORDER BY Y_COORD DESC, X_COORD ASC"), Translate(""), Translate(""), Translate(""));
// }} ""
{
   variable int_CurrentPosition;
   variable int_TotalSequencePositions;
   sequence seq_AdjustedSequence;
   variable i;

   file WriteFile;
   file ReadFile;
   variable str_LabID;
   variable str_PosID;
   variable flt_X;
   variable flt_Y;
   variable arr_Coordinates[];

   int_CurrentPosition = io_Sequence.GetCurrentPosition();

   seq_AdjustedSequence.CopySequence(io_Sequence);

   int_TotalSequencePositions = io_Sequence.GetTotal();

   SeqRemoveAll(io_Sequence);

   WriteFile.RemoveFields();
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y, hslFloat);

   if(WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite))
   {

      for(i = int_CurrentPosition; i <= int_TotalSequencePositions;)
      {
         if(int_CurrentPosition == 0) break;
         seq_AdjustedSequence.SetCurrentPosition(i);

         if(seq_AdjustedSequence.GetLabwareId() != "" && seq_AdjustedSequence.GetPositionId() != "") 
         {
            str_LabID = seq_AdjustedSequence.GetLabwareId();
            str_PosID = seq_AdjustedSequence.GetPositionId();
            Instrument.GetLabwarePosition(str_LabID, arr_Coordinates, str_PosID);
            flt_X = arr_Coordinates[0];
            flt_Y = arr_Coordinates[1];

            WriteFile.WriteRecord();
         }

         i = i + 1;
      }

   }

   WriteFile.Close();
   WriteFile.RemoveFields();

   ReadFile.RemoveFields();
   ReadFile.AddField("LAB_ID", str_LabID, hslString, 255);
   ReadFile.AddField("POS_ID", str_PosID, hslString, 255);
   ReadFile.AddField("X_COORD", flt_X, hslFloat);
   ReadFile.AddField("Y_COORD", flt_Y, hslFloat);

   if(ReadFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead, str_SQL_Sort))
   {
      while(ReadFile.Eof() == 0)
      {
         ReadFile.ReadRecord();
         io_Sequence.Add(str_LabID,str_PosID);
      }
   }

   else
   {
      Trace("ERROR OCCURRED DURING SORT");
      io_Sequence.CopySequence(seq_AdjustedSequence);
   }

   ReadFile.Close();
   ReadFile.RemoveFields();

   io_Sequence.SetCurrentPosition(1);
}
// {{{ 5 "_SortSequenceYPriority" "End"
}
// }} ""
// {{{ 5 "Optimized1mLTipPickup2" "Begin"
function Optimized1mLTipPickup2( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_str_ChannelPattern ) void {
// }} ""
private dialog customDialog658827E8DE2440068F918232E0BE9E71;
private variable flt_NotUsed;
private variable flt_CurrentX;
private variable flt_TipCapacity;
private variable flt_CurrentY;
private variable int_TotalOptions;
private variable flt_YRaster;
private variable _strFunctionName;
private variable bln_OptimizationNeeded;
private variable str_LabID;
private variable bool_FileExists;
private variable str_TipMessage;
private variable flt_PreviousY;
private variable str_TempSortingFilePath;
private variable flt_TargetX;
private variable int_TotalChannels;
private variable str_PosID;
private variable int_TipsNeeded;
private variable bln_EnoughTipsLoaded;
private variable str_TipName;
private sequence seq_RemainingSequence;
private variable arr_GroupedXCoords[];
private variable arr_GroupNumber[];
private variable arr_YMin[];
private variable arr_YMax[];
private variable arr_GroupedCounts[];
private variable arr_GroupedLabID[];
private file WriteFile;
private file SortFile;
private file UpdateFile;
private variable int_ChannelIndex;
private variable str_Value;
private variable int_ChannelValue;
private variable arr_ChannelPattern[];
private variable int_ChannelSet;
private variable int_ChannelActive;
// {{ 5 "Optimized1mLTipPickup2" "InitLocals"
// }} ""
// {{ 487 1 0 "cdb3c4ca_9b54_47f5_8feb9ee5138801a5" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 488 1 0 "563544f0_c56d_41a9_ae612efa8687d6ba" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 490 1 0 "57f52d1a_e3e0_4d3f_88801a288e9a007e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 491 1 0 "cdb3c4ca_9b54_47f5_8feb9ee5138801a5" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 492 1 0 "0b616dbb_f6d9_4a6e_8a847cf550c9f32c" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get1mLChannelCount(ML_STAR, int_TotalChannels);
// }} ""
// {{{ 493 1 0 "fdfd3c55_9d35_4122_8eb48505668df95c" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetChannelLimits(ML_STAR, 0, arr_YMax, arr_YMin, flt_YRaster);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
Trace("Y Raster:  ",flt_YRaster);
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 495 1 0 "b71cc68f_c409_42a2_a87bd97686458802" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TipsNeeded = StrReplace(i_str_ChannelPattern, Translate("1"), Translate("1"));
// }} ""
// {{{ 496 1 0 "9f511a89_db68_4569_924f290ffa33c6f3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_ChannelPattern = StrFillRight(i_str_ChannelPattern, Translate("0"), int_TotalChannels);
// }} ""
// {{ 497 1 0 "7d355a12_b981_4e61_942ad4f394952877" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_ChannelPattern.SetSize(0);
// }} ""
// {{ 498 1 0 "43d5b84f_b786_415d_94e5b3e189af5df2" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{{ 499 1 0 "7c53d8de_7150_4c56_886bb4e3a7acfa56" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_Value = StrLeft(i_str_ChannelPattern, int_ChannelIndex);
// }} ""
// {{{ 500 1 0 "92a4b972_e06a_4bd4_9e1c4ae28970ac5f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_Value = StrRight(str_Value, 1);
// }} ""
// {{{ 501 1 0 "804fc4e8_cc19_4cb7_aa5008874601b56e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_ChannelValue = StrIVal(str_Value);
// }} ""
// {{ 502 1 0 "3027a339_f53d_4aaa_ad5a52c45eab3b17" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.AddAsLast(int_ChannelValue);
// }} ""
// {{ 503 1 0 "43d5b84f_b786_415d_94e5b3e189af5df2" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 504 1 0 "9174e60b_e94f_4834_85f8ebfd5abf27cd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipsNeeded == 0)
{
// }} ""
// {{ 505 1 0 "88109134_74b2_48db_a529dcd83f51010e" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 506 1 0 "a89bd446_2d40_4d22_842d0c12b7e768aa" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 507 1 0 "88109134_74b2_48db_a529dcd83f51010e" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 508 1 0 "16788fd8_b828_4959_bc393f013cf3aea5" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return;
// }} ""
// {{ 509 1 0 "9174e60b_e94f_4834_85f8ebfd5abf27cd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 510 1 0 "03cef2d1_bc58_485c_b41d56df5f8075ca" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (BOOLEON::TRUE == BOOLEON::TRUE)
{
// }} ""
// {{{ 511 1 0 "cbc03f36_02a2_4bfc_9a8e292f350e3df3" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCheck(ML_STAR, io_seq_TipSequence, i_str_TipCounter, int_TipsNeeded);
// }} ""
// {{{ 512 1 0 "405313dd_38c6_4c4b_9049d089880bffd3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqCopySequence(seq_RemainingSequence, io_seq_TipSequence);
// }} ""
// {{{ 513 1 0 "0bc40078_74b5_4256_9f9eb59ff667330f" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, seq_RemainingSequence);
// }} ""
// {{{ 514 1 0 "57c4edf1_7690_490e_a107753e3aadd57b" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 515 1 0 "3bcb2dbf_903a_4368_8d34ee2b12c83270" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 516 1 0 "5488d803_904f_42ca_848237e69f0339ca" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 517 1 0 "84db3794_ee40_4eaa_a607bc8ddef2777a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 518 1 0 "5488d803_904f_42ca_848237e69f0339ca" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 519 1 0 "2495df25_cdf2_474f_a3e90193fe859802" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 520 1 0 "65aa762f_7f53_4a51_8560476952f46705" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::FALSE;
// }} ""
// {{ 521 1 0 "264d727b_f2fe_492e_a4d74ef8dfe9a1c0" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelSet = 1;
// }} ""
// {{ 522 1 0 "ee4a3e84_216c_4268_a4f011fedb2d6bbc" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 523 1 0 "b7b70f16_e7f4_4f90_b4524775b39d1bee" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
int_ChannelActive=arr_ChannelPattern.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 524 1 0 "373e70b8_f96e_4b53_804b0b01d33db2de" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelActive == 1)
{
// }} ""
// {{{ 525 1 0 "655bf6d1_4845_4f5b_af3052422def5756" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(seq_RemainingSequence);
// }} ""
// {{{ 526 1 0 "47fc717d_aa65_48e7_9fecd85d5c8072ad" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PosID = SeqGetPositionId(seq_RemainingSequence);
// }} ""
// {{{ 527 1 0 "b0fda1e6_3695_4890_83a0f0d8269b6a32" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqIncrement(seq_RemainingSequence, 1);
// }} ""
// {{{ 528 1 0 "4fe8a834_700c_49bd_b8d217ce06571b6c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_CurrentX, flt_CurrentY, flt_NotUsed, flt_NotUsed);
// }} ""
// {{ 529 1 0 "2fbd8bd9_5cc1_4cd5_a1e24ada492706b1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY <= arr_YMax.ElementAt( int_ChannelIndex -1))
{
// }} ""
// {{ 530 1 0 "e0e015c6_9934_4e9e_be95f00476885623" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY >= arr_YMin.ElementAt( int_ChannelIndex -1))
{
// }} ""
// {{ 531 1 0 "1f2f21bb_3d73_4b40_85741cfb63f33fbd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelSet == 1)
{
// }} ""
// {{ 532 1 0 "bb3dc4c6_647f_4965_89b35f0858521806" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TargetX = flt_CurrentX;
// }} ""
// {{ 533 1 0 "790f828b_4132_4a49_a34422ef962470b1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_CurrentY;
// }} ""
// {{ 534 1 0 "f87cba77_faa5_48ee_9f66f2d860b8abc8" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelSet = int_ChannelSet + 1;
// }} ""
// {{ 535 1 0 "1f2f21bb_3d73_4b40_85741cfb63f33fbd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 536 1 0 "717b86b5_baf7_4b49_9bdd289fa38df516" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentX != flt_TargetX)
{
// }} ""
// {{ 537 1 0 "d198ae37_4647_42ec_b69a190baa337b8f" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 538 1 0 "55a05b80_a0ee_47ed_b05896f26575d6c8" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 539 1 0 "717b86b5_baf7_4b49_9bdd289fa38df516" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 540 1 0 "93548fbc_f579_4768_b4eb213caea83f9a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY > flt_PreviousY)
{
// }} ""
// {{ 541 1 0 "1b3c45dc_b1d6_4deb_8a32ee870a7bde20" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 542 1 0 "41af9497_1a2d_4b2a_b7933d0d1cee67fa" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 543 1 0 "93548fbc_f579_4768_b4eb213caea83f9a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 544 1 0 "dbb78f91_d9a1_42ab_b070697f4ffd350f" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelSet = int_ChannelSet + 1;
// }} ""
// {{ 545 1 0 "1f2f21bb_3d73_4b40_85741cfb63f33fbd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 546 1 0 "e0e015c6_9934_4e9e_be95f00476885623" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 547 1 0 "8ea9e78e_83ce_4064_85a1f87eec789d70" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 548 1 0 "792e2fe3_eba4_44c6_825ce7ee92c9df9d" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 549 1 0 "e0e015c6_9934_4e9e_be95f00476885623" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 550 1 0 "2fbd8bd9_5cc1_4cd5_a1e24ada492706b1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 551 1 0 "820f6f77_3af9_43ce_90a75bb8e40edd7c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 552 1 0 "573b243d_7294_4c50_bf97c0fced02ac60" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 553 1 0 "2fbd8bd9_5cc1_4cd5_a1e24ada492706b1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 554 1 0 "373e70b8_f96e_4b53_804b0b01d33db2de" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 555 1 0 "e5e4792d_a4b2_4abb_99380ff2ee4f5bf9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE06(Translate("Channel Active:  "), int_ChannelActive, Translate("  Previous Y:  "), flt_PreviousY, Translate("  Current X:  "), flt_CurrentX);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 556 1 0 "f2d63b90_86ec_4553_9047a5e3cef33e61" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_PreviousY - flt_YRaster;
// }} ""
// {{ 557 1 0 "ee4a3e84_216c_4268_a4f011fedb2d6bbc" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 558 1 0 "08e74d1e_3c7e_4200_8cbb8a8deca650b7" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_RemainingSequence.SetCurrentPosition(1);
// }} ""
// {{ 559 1 0 "2495df25_cdf2_474f_a3e90193fe859802" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 560 1 0 "7854e589_4fdd_43de_84fb880873e27a69" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_OptimizationNeeded == BOOLEON::TRUE)
{
// }} ""
// {{ 561 1 0 "098ed406_17ab_4912_8f2fb1e8cd51c6cc" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("OPTIMIZE NEEDED!"));
// }} ""
// {{{ 562 1 0 "d8d859ee_660e_43da_84699fd605d64dff" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 563 1 0 "aee86a20_71d6_4bb2_8504a889e69fa2b8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 564 1 0 "60751214_c59d_4322_98994bf85951b0fb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 565 1 0 "aee86a20_71d6_4bb2_8504a889e69fa2b8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 566 1 0 "808ac042_a174_4a1f_b6645fab91c5de1a" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequence(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 567 1 0 "f3cafa71_06b7_448d_990d51b13c774fc9" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequenceRaster(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE, flt_YRaster);
// }} ""
// {{ 568 1 0 "6a0710f2_f8b0_4fa9_8928e4a77eb178d3" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX, bln_Used;

   WriteFile.RemoveFields();
   WriteFile.AddField("INDEX", int_PositionCount, hslInteger);
   WriteFile.AddField("USED", bln_Used, hslInteger);
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   WriteFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   WriteFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_RemainingSequence.GetTotal();

   WriteFile.SetExtendedProperties("HDR=YES");
   WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite);
   
   int_PositionCount = 1;   
   int_Group = 0;
   flt_CurrentX = -100.0;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_RemainingSequence.SetCurrentPosition(i);

      str_LabID = seq_RemainingSequence.GetLabwareId();
      str_PosID = seq_RemainingSequence.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);

      if(flt_CurrentX != flt_X_Coord)
      {
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
         int_ChannelIndex = 1;
      }

      if(int_ChannelIndex > int_TotalChannels)
      {
         int_ChannelIndex = 1;
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
      }
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   WriteFile.Close();
   WriteFile.RemoveFields();
}
// {{ 570 1 0 "80f8aff9_1680_41ed_bebe9481bdbfbaee" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 571 1 0 "10fd002c_f9a1_478a_868cafe5c805156e" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedLabID.SetSize(0);
// }} ""
// {{ 572 1 0 "4586008a_a09d_4747_8a1f23bd449dfb3b" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedXCoords.SetSize(0);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 573 1 0 "6a263613_f8d4_4865_960763ccf6b2b0a0" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupNumber.SetSize(0);
// }} ""
// {{ 574 1 0 "609c2f57_99d8_4160_96fb4d1b1973f533" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedCounts.SetSize(0);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, int_Group;

SortFile.RemoveFields();

      //str_SQL = "SELECT [GROUP], Y_COORD, COUNT(*) AS N FROM (SELECT * FROM SORT ORDER BY Y_COORD DESC, X_COORD ASC) GROUP BY [GROUP], Y_COORD ORDER BY Y_COORD DESC";
      str_SQL = "SELECT [GROUP], N FROM (SELECT [GROUP], COUNT(*) AS N FROM SORT GROUP BY [GROUP]) ORDER BY [GROUP] ASC";
      //SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("GROUP", int_Group, hslFloat);
      SortFile.AddField("N", int_Count, hslInteger);

      int_TotalValues = seq_RemainingSequence.GetTotal();

      SortFile.SetExtendedProperties("HDR=YES");
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   
      str_LabID = "";
      flt_Y_Coord = 0.0;

      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         arr_GroupNumber.AddAsLast(int_Group);
         arr_GroupedCounts.AddAsLast(int_Count);
      }

      SortFile.Close();
      SortFile.RemoveFields();

}
// {{ 576 1 0 "2cab2f9f_eeba_4ae9_b5e1bd6e2e73a6cf" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 577 1 0 "548470ae_b18c_4bbf_89fc273c28443be8" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalOptions=arr_GroupedCounts.GetSize();
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 578 1 0 "e910ba33_5e56_41f2_86fbf3bba64c765a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Counts           Group"), arr_GroupedCounts, arr_GroupNumber);
// }} ""
// {{{ 579 1 0 "eb0124f9_2cb7_4b57_81d752cafeb41399" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_3(Translate("Counts     Lab          X"), arr_GroupedCounts, arr_GroupedLabID, arr_GroupedXCoords);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 580 1 0 "b68e66e1_2733_430e_ae9e1f3d5aa9c256" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount, int_ChannelIndex;
   variable flt_PreviousY;

   bln_UseOptimization = hslFalse;

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("GROUP", int_Group, hslInteger);

   str_SQL = "SELECT INDEX, LAB_ID, X_COORD, Y_COORD, [GROUP] FROM SORT ORDER BY LAB_ID ASC, Y_COORD DESC, X_COORD ASC";
   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {

      SortFile.ReadRecord();
      //Util::Lookup(arr_GroupedCounts,int_Group,a);
      //Trace("Group:  ", int_Group,"  Count:  ",arr_GroupedCounts.GetAt(int_Group-1),"  Tips needed:  ",int_TipsNeeded);
      if(arr_GroupedCounts.GetAt(int_Group-1) >= int_TipsNeeded)
      {
         int_Group = StrConcat2(int_Group,"");
         bln_UseOptimization = hslTrue;
         break;
      }
   }

   //int_Index = StrConcat2(int_Index,"");   

   SortFile.Close();
   SortFile.RemoveFields();

//Trace("Lab ID:  ",str_LabID,"  X Coord:  ",flt_X_Coord);
//Trace("Group:  ",int_Group);
//Trace("Use Optimization:  ",bln_UseOptimization);
if(bln_UseOptimization == hslTrue)
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD, [GROUP] FROM SORT WHERE [GROUP] = " + int_Group + " ORDER BY X_COORD ASC, Y_COORD DESC";

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   SortFile.AddField("GROUP",int_Group, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   i = 0;
   int_ChannelIndex = 1;
   str_InValue = "(";
   flt_PreviousY = 9999.9;
   while(SortFile.Eof() == 0)
   {
      if(i > int_TipsNeeded) break;
      SortFile.ReadRecord();
      if(arr_ChannelPattern.GetAt(int_ChannelIndex-1)==1)
      {
         if(i==0) flt_PreviousY = flt_Y_Coord + flt_YRaster;
         if(flt_Y_Coord <= flt_PreviousY - flt_YRaster)
         {
            i = i + 1;
            if(i > 1) str_InValue = str_InValue + ", ";
            str_InValue = StrConcat2(str_InValue , int_Index);
            int_ChannelIndex = int_ChannelIndex + 1;
         }
      }
      else
      {
         int_ChannelIndex = int_ChannelIndex + 1;
      }
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   UpdateFile.RemoveFields();
   str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
   UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   UpdateFile.Close();
   UpdateFile.RemoveFields();
}
else
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD FROM SORT ORDER BY X_COORD ASC, Y_COORD DESC";
   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

      i = 0;
   str_InValue = "(";
   int_ChannelCount = 1;
   int_UpdateCount = 0;
   int_ChannelIndex = 1;
   while(SortFile.Eof() == 0)
   {
      //loop(int_TotalChannels)
      //{
         //if(int_ChannelIndex > int_TotalChannels) break;
         //if(arr_ChannelPattern.GetAt(int_ChannelIndex)==1)
         //{
            //break;
         //}
         //int_ChannelIndex = int_ChannelIndex + 1;
      //}

      if(int_ChannelIndex > int_TotalChannels) break;
      SortFile.ReadRecord();
      i = i + 1;
      if(int_ChannelCount > int_TipsNeeded) break;
//Trace(flt_Y_Coord,"  <= ",arr_YMax.GetAt(int_ChannelIndex-1));
//Trace(flt_Y_Coord,"  >= ",arr_YMin.GetAt(int_ChannelIndex-1));
      if(flt_Y_Coord <= arr_YMax.GetAt(int_ChannelIndex-1))
      {
         if(flt_Y_Coord >= arr_YMin.GetAt(int_ChannelIndex-1))
         {
            if(int_ChannelCount > 1) str_InValue = str_InValue + ", ";
            str_InValue = StrConcat2(str_InValue , int_Index);
            int_ChannelCount = int_ChannelCount + 1;
            int_UpdateCount = int_UpdateCount + 1;
            int_ChannelIndex = int_ChannelIndex + 1;
         }
      }
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_UpdateCount>0)
   {
      UpdateFile.RemoveFields();
      str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;

      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }
}

}
// {{ 582 1 0 "b976ae82_e2ef_466e_903b9e5fe3855d7a" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 583 1 0 "75adf795_ed7e_44f5_9cde833b75a5554e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_TipSequence);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used;

   SortFile.RemoveFields();

   str_SQL = "SELECT USED, LAB_ID, POS_ID FROM SORT ORDER BY USED DESC, LAB_ID ASC, X_COORD ASC, Y_COORD DESC";

   SortFile.AddField("USED", bln_Used, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("POS_ID", str_PosID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      SeqAdd(io_seq_TipSequence, Translate(str_LabID), Translate(str_PosID));
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 585 1 0 "4b2f3034_1a2f_44c5_83786a54370344c9" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
io_seq_TipSequence.SetCurrentPosition(1);
// }} ""
// {{ 586 1 0 "63297389_5f1f_46c7_aa98ad06e79d7182" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_EnoughTipsLoaded = BOOLEON::TRUE;
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL;

   SortFile.RemoveFields();

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE USED = 2";

   SortFile.AddField("N", int_Count, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_Count < int_TipsNeeded) bln_EnoughTipsLoaded = hslFalse;
}
// {{ 588 1 0 "18c0b053_e0d6_4199_93cce7d4942f651e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_EnoughTipsLoaded == BOOLEON::FALSE)
{
// }} ""
// {{ 589 1 0 "d3e34f56_86d1_40e5_ad11ab7018ee241c" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{{ 590 1 0 "fdc18aaa_0d09_4ae8_87653b7e6178016c" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(ML_STAR, io_seq_TipSequence, flt_TipCapacity);
// }} ""
// {{ 591 1 0 "b96623d3_e3ba_47ef_8d6e732718f6e43f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 592 1 0 "8533f1cf_d148_4381_bf5ee1460e9064d0" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 593 1 0 "b96623d3_e3ba_47ef_8d6e732718f6e43f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 594 1 0 "3ae4d71f_7a3d_4aab_b7edaace45dff159" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 595 1 0 "21edea81_604d_4e6f_ae5aae7f5681cb3d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 596 1 0 "a41a6d9e_88e5_4b6c_b3c5f24c0807ae2c" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialog658827E8DE2440068F918232E0BE9E71.InitCustomDialog( "a41a6d9e_88e5_4b6c_b3c5f24c0807ae2c" );
customDialog658827E8DE2440068F918232E0BE9E71.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialog658827E8DE2440068F918232E0BE9E71.ShowCustomDialog();
// }} ""
// {{{ 597 1 0 "71d91bd6_7f17_42a6_aa68f619895fc8d7" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 598 1 0 "0ad23c4d_b42f_4f0a_b0d6a222081c3b05" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(ML_STAR, io_seq_TipSequence, i_str_TipCounter, 99999);
// }} ""
// {{ 599 1 0 "18c0b053_e0d6_4199_93cce7d4942f651e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 600 1 0 "d2ef1cbb_ecd0_45ff_aa919933c7e6c6d0" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 601 1 0 "18c0b053_e0d6_4199_93cce7d4942f651e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 602 1 0 "6a0710f2_f8b0_4fa9_8928e4a77eb178d3" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 603 1 0 "7854e589_4fdd_43de_84fb880873e27a69" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 604 1 0 "3b4a7163_735a_492e_b46667a639fb058a" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 605 1 0 "7854e589_4fdd_43de_84fb880873e27a69" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 606 1 0 "03cef2d1_bc58_485c_b41d56df5f8075ca" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 607 1 0 "050a82a9_18cd_4697_9d045659ccf23341" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 608 1 0 "7741a637_31fc_4cd8_8ac87d2a9dd08fe3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 609 1 0 "050a82a9_18cd_4697_9d045659ccf23341" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "Optimized1mLTipPickup2" "End"
}
// }} ""
// {{{ 5 "Optimized5mLTipPickup" "Begin"
function Optimized5mLTipPickup( device & ML_STAR, sequence & io_seq_TipSequence, sequence i_seq_ControlSequence, variable i_str_TipCounter, variable & o_str_ChannelPattern ) void {
// }} ""
private dialog customDialog1E713D506B7B49588AC668FAFBEF1C52;
private variable flt_NotUsed;
private variable flt_CurrentX;
private variable flt_TipCapacity;
private variable flt_CurrentY;
private variable flt_YRaster;
private variable int_TotalOptions;
private variable bln_OptimizationNeeded;
private variable _strFunctionName;
private variable int_TotalPositionsRemaining;
private variable str_LabID;
private variable bool_FileExists;
private variable str_TipMessage;
private variable flt_PreviousY;
private variable str_TempSortingFilePath;
private variable flt_TargetX;
private variable int_SeqIndex;
private variable int_TotalChannels;
private variable str_PosID;
private variable int_TipsNeeded;
private variable bln_EnoughTipsLoaded;
private variable str_TipName;
private sequence seq_RemainingSequence;
private variable arr_GroupedXCoords[];
private variable arr_GroupNumber[];
private variable arr_YMin[];
private variable arr_YMax[];
private variable arr_GroupedCounts[];
private variable arr_GroupedLabID[];
private file SortFile;
private file UpdateFile;
private file WriteFile;
private variable bln_Used;
// {{ 5 "Optimized5mLTipPickup" "InitLocals"
o_str_ChannelPattern = 0;
// }} ""
// {{ 611 1 0 "81227204_1229_454f_aff2a7559ca862b5" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 612 1 0 "c419db86_0f77_4e53_bee258c18052c0e2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 614 1 0 "cd2061c9_cf0d_4672_b9d9cfec69d3b69e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 615 1 0 "81227204_1229_454f_aff2a7559ca862b5" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 616 1 0 "79558700_b2a9_42d8_9adab93c5c4eea5c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_str_ChannelPattern = Translate("");
// }} ""
// {{{ 617 1 0 "d42ff746_a3da_47d8_b4d62df67ecf6c83" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get5mLChannelCount(ML_STAR, int_TotalChannels);
// }} ""
// {{{ 618 1 0 "3b966059_e21f_4b65_9752cbec5dee9e47" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetChannelLimits(ML_STAR, 1, arr_YMax, arr_YMin, flt_YRaster);
// }} ""
// {{{ 619 1 0 "bf47843b_c941_4e5c_865dad7d9ef707e2" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, i_seq_ControlSequence);
// }} ""
// {{{ 620 1 0 "2bc367f3_bdeb_4f2c_89c9adb60c1a6d67" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TotalPositionsRemaining = SeqGetTotal(i_seq_ControlSequence);
// }} ""
// {{ 621 1 0 "6201ed1b_06ee_4afc_ba887c363e469720" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_TipsNeeded = int_TotalPositionsRemaining;
// }} ""
// {{ 622 1 0 "9413cc48_692f_49a3_81b88124b877d143" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipsNeeded > int_TotalChannels)
{
// }} ""
// {{ 623 1 0 "a532ee10_1c66_44e7_8e90a34004ff1488" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_TipsNeeded = int_TotalChannels;
// }} ""
// {{ 624 1 0 "9413cc48_692f_49a3_81b88124b877d143" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 625 1 0 "1cfe24db_003c_4464_a32c602e728eb354" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipsNeeded == 0)
{
// }} ""
// {{ 626 1 0 "c423331e_0891_4dec_a83a4b12b6aecf76" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 627 1 0 "17f667cc_7997_42fb_972748312f394213" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 628 1 0 "c423331e_0891_4dec_a83a4b12b6aecf76" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 629 1 0 "e664d1f4_a200_49ec_8f6518012f426e60" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return;
// }} ""
// {{ 630 1 0 "1cfe24db_003c_4464_a32c602e728eb354" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 631 1 0 "e405a64e_09ba_4dc6_9e3bea0f3a0a70b4" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_Used = 0;
// }} ""
// {{ 632 1 0 "0e8d2cd5_8312_4e5f_b3608e8ee30e87b6" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (BOOLEON::TRUE == BOOLEON::TRUE)
{
// }} ""
// {{{ 633 1 0 "8a5f61bc_b4ef_4627_8050829f1648d89b" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCheck(ML_STAR, io_seq_TipSequence, i_str_TipCounter, int_TipsNeeded);
// }} ""
// {{{ 634 1 0 "91ee650a_d59d_4eb2_8a269965017b4c5e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqCopySequence(seq_RemainingSequence, io_seq_TipSequence);
// }} ""
// {{{ 635 1 0 "b0aff417_e40b_4903_b726f96169297671" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, seq_RemainingSequence);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 636 1 0 "46fb52fd_8855_4505_a29f943efba905d7" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_SortSequenceYPriority(ML_STAR, seq_RemainingSequence);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 637 1 0 "6656a50c_5bea_42c2_b15c0332872f8f3f" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 638 1 0 "f15b98fe_2302_4c77_aac91bd6c70ce1e9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 639 1 0 "302ee04c_6026_448e_a9e980c7578be133" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 640 1 0 "a86b6301_3447_40c5_8b8315efe972ec48" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 641 1 0 "302ee04c_6026_448e_a9e980c7578be133" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 642 1 0 "feec5c10_21ad_453e_bb5e9dfc110b70ab" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
BuildChannelPattern(int_TipsNeeded, int_TotalChannels, o_str_ChannelPattern);
// }} ""
// {{ 643 1 0 "69ec4e8a_b4ad_467f_afc9b493cabcf686" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 644 1 0 "eb66c58b_0dd2_4da6_a960bbd3e04fed31" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::FALSE;
// }} ""
// {{ 645 1 0 "6256bd18_c4c7_41ed_ab7d7d6006bfd848" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_SeqIndex = 0; int_SeqIndex < int_TipsNeeded;)
{
int_SeqIndex = int_SeqIndex + 1;
// }} ""
// {{{ 646 1 0 "425fcf04_d590_47fd_8b0deb8dc8a1f5b6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(seq_RemainingSequence);
// }} ""
// {{{ 647 1 0 "58acd061_c305_4e72_9d74311e84c9cdde" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PosID = SeqGetPositionId(seq_RemainingSequence);
// }} ""
// {{{ 648 1 0 "953360ee_289b_45a1_ab09d036e0936046" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqIncrement(seq_RemainingSequence, 1);
// }} ""
// {{{ 649 1 0 "30a33945_e176_4034_bec6d22bba61e4c6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_CurrentX, flt_CurrentY, flt_NotUsed, flt_NotUsed);
// }} ""
// {{ 650 1 0 "8ec86416_84cb_4a82_b2f9eb2de6927692" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_SeqIndex == 1)
{
// }} ""
// {{ 651 1 0 "3dc4efd4_9c68_470c_8f564df88246a9f8" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TargetX = flt_CurrentX;
// }} ""
// {{ 652 1 0 "0ce7b2e4_698f_4f4a_aa44ff98bd70baf2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_CurrentY;
// }} ""
// {{ 653 1 0 "8ec86416_84cb_4a82_b2f9eb2de6927692" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 654 1 0 "2ae83690_355a_46ab_8bd395ed6711ddaf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentX != flt_TargetX)
{
// }} ""
// {{ 655 1 0 "bb3d5baf_babe_4333_b36b83092e1a4830" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 656 1 0 "7dfa5307_4c35_4a4a_9708ca12d2a0a70d" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 657 1 0 "2ae83690_355a_46ab_8bd395ed6711ddaf" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 658 1 0 "77184d01_be1a_4566_ae7aea74adcbc336" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY > flt_PreviousY)
{
// }} ""
// {{ 659 1 0 "06ade6e0_9ea3_415d_997cd31bba6b2a80" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 660 1 0 "cd229ec2_cab4_4781_83f5f1569628a7a7" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 661 1 0 "77184d01_be1a_4566_ae7aea74adcbc336" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 662 1 0 "9c6f54dc_112e_40d2_93d25640817a1b23" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_CurrentY;
// }} ""
// {{ 663 1 0 "8ec86416_84cb_4a82_b2f9eb2de6927692" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 664 1 0 "acdb2a96_f55b_4f72_a784f1de2f7c1d7c" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_PreviousY - flt_YRaster;
// }} ""
// {{ 665 1 0 "6256bd18_c4c7_41ed_ab7d7d6006bfd848" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 666 1 0 "608cdbfb_7f85_421b_bb1842e53bed6bc0" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_RemainingSequence.SetCurrentPosition(1);
// }} ""
// {{ 667 1 0 "69ec4e8a_b4ad_467f_afc9b493cabcf686" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 668 1 0 "36a71cd3_4521_4ae3_9bab2783dc4e9442" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_OptimizationNeeded == BOOLEON::TRUE)
{
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 669 1 0 "7816e576_69f2_4b58_a9ee001468cb4653" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequence(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 670 1 0 "ca0039e1_d751_4125_968e43b3f38b47d9" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequenceRaster(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE, flt_YRaster);
// }} ""
// {{ 671 1 0 "728066be_b08d_4a76_af138a50280c9c4f" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX;

   WriteFile.RemoveFields();
   WriteFile.AddField("INDEX", int_PositionCount, hslInteger);
   WriteFile.AddField("USED", bln_Used, hslInteger);
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   WriteFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   WriteFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_RemainingSequence.GetTotal();

   WriteFile.SetExtendedProperties("HDR=YES");
   WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite);
   
   int_PositionCount = 1;   
   int_Group = 0;
   flt_CurrentX = -100.0;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_RemainingSequence.SetCurrentPosition(i);

      str_LabID = seq_RemainingSequence.GetLabwareId();
      str_PosID = seq_RemainingSequence.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);

      if(flt_CurrentX != flt_X_Coord)
      {
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
         int_ChannelIndex = 1;
      }

      if(int_ChannelIndex > int_TotalChannels)
      {
         int_ChannelIndex = 1;
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
      }
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   WriteFile.Close();
   WriteFile.RemoveFields();
}
// {{ 673 1 0 "44874661_3057_42ad_8ee4bcf17d7ea056" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 674 1 0 "bd47444d_65ee_4b48_9a73dd4f4431251d" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedLabID.SetSize(0);
// }} ""
// {{ 675 1 0 "70514244_2892_437c_9b3ad7be20572bf2" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedXCoords.SetSize(0);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 676 1 0 "db2e03b1_9a4c_46b3_92c8bc3a84947e86" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupNumber.SetSize(0);
// }} ""
// {{ 677 1 0 "05b87f22_9cd7_4f9e_806cf7d6d44c2258" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedCounts.SetSize(0);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, int_Group;

SortFile.RemoveFields();

      //str_SQL = "SELECT [GROUP], Y_COORD, COUNT(*) AS N FROM (SELECT * FROM SORT ORDER BY Y_COORD DESC, X_COORD ASC) GROUP BY [GROUP], Y_COORD ORDER BY Y_COORD DESC";
      str_SQL = "SELECT [GROUP], N FROM (SELECT [GROUP], COUNT(*) AS N FROM SORT GROUP BY [GROUP]) ORDER BY [GROUP] ASC";
      //SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("GROUP", int_Group, hslFloat);
      SortFile.AddField("N", int_Count, hslInteger);

      int_TotalValues = seq_RemainingSequence.GetTotal();

      SortFile.SetExtendedProperties("HDR=YES");
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   
      str_LabID = "";
      flt_Y_Coord = 0.0;

      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         arr_GroupNumber.AddAsLast(int_Group);
         arr_GroupedCounts.AddAsLast(int_Count);
      }

      SortFile.Close();
      SortFile.RemoveFields();

}
// {{ 679 1 0 "0f4e381a_4f78_4de2_87a621682b61848a" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 680 1 0 "879b54d2_f4cd_4c14_a33e6613503ffdba" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalOptions=arr_GroupedCounts.GetSize();
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 681 1 0 "7d83b81b_6cd7_4612_aed30673d2f27357" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Counts           Group"), arr_GroupedCounts, arr_GroupNumber);
// }} ""
// {{{ 682 1 0 "a5b12a53_9a27_47be_81ee38358baa3abd" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_3(Translate("Counts     Lab          X"), arr_GroupedCounts, arr_GroupedLabID, arr_GroupedXCoords);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 683 1 0 "e9ce2f09_c300_427e_963b7548177035d1" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount;

   bln_UseOptimization = hslFalse;

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("GROUP", int_Group, hslInteger);

   str_SQL = "SELECT INDEX, LAB_ID, X_COORD, Y_COORD, [GROUP] FROM SORT ORDER BY LAB_ID ASC, Y_COORD DESC, X_COORD ASC";
   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      //Util::Lookup(arr_GroupedCounts,int_Group,a);
      //Trace("Group:  ", int_Group,"  Count:  ",arr_GroupedCounts.GetAt(int_Group-1),"  Tips needed:  ",int_TipsNeeded);
      if(arr_GroupedCounts.GetAt(int_Group-1) >= int_TipsNeeded)
      {
         int_Group = StrConcat2(int_Group,"");
         bln_UseOptimization = hslTrue;
         break;
      }
   }

   //int_Index = StrConcat2(int_Index,"");   

   SortFile.Close();
   SortFile.RemoveFields();

//Trace("Lab ID:  ",str_LabID,"  X Coord:  ",flt_XCoord);
//Trace("Group:  ",int_Group);
//Trace("Use Optimization:  ",bln_UseOptimization);
if(bln_UseOptimization == hslTrue)
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD, [GROUP] FROM SORT WHERE [GROUP] = " + int_Group + " ORDER BY X_COORD ASC, Y_COORD DESC";

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("GROUP",int_Group, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   i = 0;
   str_InValue = "(";
   while(SortFile.Eof() == 0)
   {
      i = i + 1;
      if(i > int_TipsNeeded) break;
      SortFile.ReadRecord();
      if(i > 1) str_InValue = str_InValue + ", ";
      str_InValue = StrConcat2(str_InValue , int_Index);
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   UpdateFile.RemoveFields();
   str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
   UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   UpdateFile.Close();
   UpdateFile.RemoveFields();
}
else
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD FROM SORT ORDER BY X_COORD ASC, Y_COORD DESC";
   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

      i = 0;
   str_InValue = "(";
   int_ChannelCount = 1;
   int_UpdateCount = 0;
   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      i = i + 1;
      if(int_ChannelCount > int_TipsNeeded) break;
      if(flt_Y_Coord <= arr_YMax.GetAt(int_ChannelCount-1))
      {
         if(flt_Y_Coord >= arr_YMin.GetAt(int_ChannelCount-1))
         {
            if(int_ChannelCount > 1) str_InValue = str_InValue + ", ";
            str_InValue = StrConcat2(str_InValue , int_Index);
            int_ChannelCount = int_ChannelCount + 1;
            int_UpdateCount = int_UpdateCount + 1;
         }
      }
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_UpdateCount>0)
   {
      UpdateFile.RemoveFields();
      str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;

      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }
}

}
// {{ 685 1 0 "7c3696e4_adf3_4717_b55164fce00a4bb6" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 686 1 0 "4bb57610_25dc_445d_bd201a01ee739345" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_TipSequence);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL;

   SortFile.RemoveFields();

   str_SQL = "SELECT USED, LAB_ID, POS_ID FROM SORT ORDER BY USED DESC, LAB_ID ASC, X_COORD ASC, Y_COORD DESC";

   SortFile.AddField("USED", bln_Used, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("POS_ID", str_PosID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      SeqAdd(io_seq_TipSequence, Translate(str_LabID), Translate(str_PosID));
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 688 1 0 "c0b07f18_4e9c_4e0c_a68e42525457a476" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
io_seq_TipSequence.SetCurrentPosition(1);
// }} ""
// {{ 689 1 0 "9d43c71f_c5da_4730_b763ffa6c487b769" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_EnoughTipsLoaded = BOOLEON::TRUE;
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL;

   SortFile.RemoveFields();

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE USED = 2";

   SortFile.AddField("N", int_Count, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_Count < int_TipsNeeded) bln_EnoughTipsLoaded = hslFalse;
}
// {{ 691 1 0 "89920c34_bfb3_4586_9464ec6aa07b0230" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_EnoughTipsLoaded == BOOLEON::FALSE)
{
// }} ""
// {{ 692 1 0 "94173776_caf2_4321_aeea6f0f792d7ea1" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{{ 693 1 0 "1dec8f3f_b362_485d_abd3b8ae1e4272df" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(ML_STAR, io_seq_TipSequence, flt_TipCapacity);
// }} ""
// {{ 694 1 0 "1c11c7c5_5aa0_4dc1_b2f85d50e62ce4d2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 695 1 0 "0bf86617_42c7_4285_94e1577425e812e7" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 696 1 0 "1c11c7c5_5aa0_4dc1_b2f85d50e62ce4d2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 697 1 0 "58a38c4b_92a6_42a7_a47dcf3c36a271b3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 698 1 0 "1b137450_161c_4f6b_9bd20fec8f57fe9e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 699 1 0 "da7de0ca_2bef_4fc4_8589ca882ee7f96e" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialog1E713D506B7B49588AC668FAFBEF1C52.InitCustomDialog( "da7de0ca_2bef_4fc4_8589ca882ee7f96e" );
customDialog1E713D506B7B49588AC668FAFBEF1C52.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialog1E713D506B7B49588AC668FAFBEF1C52.ShowCustomDialog();
// }} ""
// {{{ 700 1 0 "b5c484ee_b08d_423d_873ee7719b679440" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 701 1 0 "c4fb84ed_90dc_47da_b22019a3eef9ae44" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(ML_STAR, io_seq_TipSequence, i_str_TipCounter, 99999);
// }} ""
// {{ 702 1 0 "89920c34_bfb3_4586_9464ec6aa07b0230" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 703 1 0 "c7e438f8_d0f4_4231_a81e2242716722ef" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 704 1 0 "89920c34_bfb3_4586_9464ec6aa07b0230" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 705 1 0 "728066be_b08d_4a76_af138a50280c9c4f" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 706 1 0 "36a71cd3_4521_4ae3_9bab2783dc4e9442" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 707 1 0 "e7b6a0bd_1d3a_429d_83254849cb88942b" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 708 1 0 "36a71cd3_4521_4ae3_9bab2783dc4e9442" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 709 1 0 "0e8d2cd5_8312_4e5f_b3608e8ee30e87b6" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 710 1 0 "78c26513_64e9_47e4_88225fcf24008900" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 711 1 0 "4ee94b00_c0fc_4d63_9013be008ff1f35a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 712 1 0 "78c26513_64e9_47e4_88225fcf24008900" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "Optimized5mLTipPickup" "End"
}
// }} ""
// {{{ 5 "DefragTipRacks1mL" "Begin"
function DefragTipRacks1mL( device & ML_STAR, sequence & io_seq_Tips ) void {
// }} ""
private variable _strFunctionName;
private sequence seq_TipsEmpty;
private sequence seq_TipsRemaining;
private variable arr_LabIDs[];
private variable int_RemainingLabIDs;
private variable int_Index;
private variable str_LabID;
private sequence seq_Temp;
private variable int_NumInSeq;
private variable i;
private variable int_Position;
private variable str_PosID;
private file WriteFile;
private variable bool_FileExists;
private variable str_TempSortingFilePath;
private variable arr_PartialLabID[];
private variable arr_PartialCount[];
private file SortFile;
private variable flt_YRaster;
private variable int_TotalChannels;
private variable arr_YMin[];
private variable arr_YMax[];
private variable int_TotalPartial;
private sequence seq_TipsPickUp;
private variable int_ChannelIndex;
private variable int_LabIndex;
private variable flt_YMax;
private variable flt_YMin;
private variable int_ChannelsSet;
private variable arr_ChannelPattern[];
private variable str_CurrentLabID;
private variable bln_ValueFound;
private variable arr_PickUpIndex[];
private variable int_TotalSet;
private variable int_ChannelEnabled;
private sequence seq_TipsPutDown;
private variable str_ChannelPattern;
private variable int_TotalUpdates;
private variable arr_PutDownIndex[];
private variable arr_UsedIndex[];
private variable arr_PickUpLabware[];
// {{ 5 "DefragTipRacks1mL" "InitLocals"
// }} ""
// {{ 8 1 0 "82ac5c0b_e232_409f_8485a846dd506e07" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 9 1 0 "0417947e_1b01_4b14_9ccccf59a1fb6d6b" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 11 1 0 "b3940cc0_caaa_4573_b383125dee48d123" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 12 1 0 "82ac5c0b_e232_409f_8485a846dd506e07" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 13 1 0 "e7884955_1425_4cb4_b1bf078bd0d01929" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get1mLChannelCount(ML_STAR, int_TotalChannels);
// }} ""
// {{{ 14 1 0 "a621c8f1_99f7_478c_a195843ba77ed1cc" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetChannelLimits(ML_STAR, 0, arr_YMax, arr_YMin, flt_YRaster);
// }} ""
// {{{ 15 1 0 "24d41d46_c4e2_4cb9_95dac332bbb3154a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsRemaining);
// }} ""
// {{{ 16 1 0 "ccc19882_1dfb_457f_89bae2051f5990de" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqCopySequence(seq_TipsRemaining, io_seq_Tips);
// }} ""
// {{{ 17 1 0 "163b6df4_d097_4300_9d56ed151bbba33a" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, seq_TipsRemaining);
// }} ""
// {{{ 18 1 0 "05a19cd3_0ed8_4cbe_97557908beefdb69" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 19 1 0 "6985a598_7362_4490_b4647702c97b5d52" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(str_TempSortingFilePath, Translate("TEMP_SORT_FILE"), Translate("TEMP_DEFRAG_FILE"));
// }} ""
Trace(str_TempSortingFilePath);
// {{{ 21 1 0 "a63eefeb_d453_4ce1_82f6a75ddd92efe4" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 22 1 0 "61035017_203d_41bd_8b0a4a64d8b3b846" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 23 1 0 "d9730cd0_a0ac_4d2d_802199f3e2f98167" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 24 1 0 "61035017_203d_41bd_8b0a4a64d8b3b846" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 25 1 0 "8cc2b861_4a30_4b25_8ab703a2ae74e28f" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 26 1 0 "b30f4632_7fa5_4449_9fd66715d8c1c328" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqGetLabwareIds(seq_TipsRemaining, arr_LabIDs);
// }} ""
// {{ 27 1 0 "9abfe334_f238_49a4_9f8653d0ea539ff9" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_RemainingLabIDs=arr_LabIDs.GetSize();
// }} ""
// {{ 28 1 0 "a32e8c83_1c14_4481_b4159e58398945fb" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_Index = 0; int_Index < int_RemainingLabIDs;)
{
int_Index = int_Index + 1;
// }} ""
// {{ 29 1 0 "bedf85ca_064c_4014_824f324c2cf3307c" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
str_LabID=arr_LabIDs.GetAt(int_Index-1);
// }} ""
// {{{ 30 1 0 "46b56233_0bf4_4454_9f2b4a0a70743f52" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetDefaultSequence(ML_STAR, str_LabID, 1, seq_Temp);
// }} ""
// {{{ 31 1 0 "6048e11a_5592_42ef_baa131b16e1e79f2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_NumInSeq = SeqGetTotal(seq_Temp);
// }} ""
// {{ 32 1 0 "6725ab43_1a56_410e_81af7fa0b9205564" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(i = 0; i < int_NumInSeq;)
{
i = i + 1;
// }} ""
// {{ 33 1 0 "139be0bf_db3d_416f_aa769709c16b4171" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_Temp.SetCurrentPosition(i);
// }} ""
// {{{ 34 1 0 "1c741253_cfeb_4074_8c0fae78c325aa2b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(seq_Temp);
// }} ""
// {{{ 35 1 0 "181d801f_1ccb_40d6_9d725f57e5f412dd" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PosID = SeqGetPositionId(seq_Temp);
// }} ""
// {{{ 36 1 0 "0e6d111d_ac49_456b_97f659df4a680bfe" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_Position = SeqLookupPosition(seq_TipsRemaining, str_LabID, str_PosID, 1, 1);
// }} ""
// {{ 37 1 0 "6520b8bc_9b23_4b18_a61dea27050fb0e8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_Position == 0)
{
// }} ""
// {{{ 38 1 0 "73f37f11_ed21_4b3b_8e51a2a45e0b05e3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqAdd(seq_TipsEmpty, str_LabID, str_PosID);
// }} ""
// {{ 39 1 0 "6520b8bc_9b23_4b18_a61dea27050fb0e8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 40 1 0 "6725ab43_1a56_410e_81af7fa0b9205564" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 41 1 0 "a32e8c83_1c14_4481_b4159e58398945fb" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 42 1 0 "a117943b_d83f_4eb6_96d650148f86a31a" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TipsEmpty.SetCurrentPosition(1);
// }} ""
// {{ 43 1 0 "c437962b_4d0c_47b6_9ba78e6c740dce61" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 44 1 0 "02be81e3_92f7_4657_a8580f20513ff18e" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX, bln_Used;

   WriteFile.RemoveFields();
   WriteFile.AddField("INDEX", int_PositionCount, hslInteger);
   WriteFile.AddField("USED", bln_Used, hslInteger);
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   WriteFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   WriteFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_TipsRemaining.GetTotal();

   WriteFile.SetExtendedProperties("HDR=YES");
   WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite);
   
   int_PositionCount = 1;   
   int_Group = 0;
   bln_Used = 1;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_TipsRemaining.SetCurrentPosition(i);

      str_LabID = seq_TipsRemaining.GetLabwareId();
      str_PosID = seq_TipsRemaining.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   int_TotalValues = seq_TipsEmpty.GetTotal();
   bln_Used = 0;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_TipsEmpty.SetCurrentPosition(i);

      str_LabID = seq_TipsEmpty.GetLabwareId();
      str_PosID = seq_TipsEmpty.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   WriteFile.Close();
   WriteFile.RemoveFields();
}
// {{ 46 1 0 "02be81e3_92f7_4657_a8580f20513ff18e" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 47 1 0 "bcd0fc00_dc63_4b8e_bbc89c072daded5b" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (BOOLEON::TRUE == BOOLEON::TRUE)
{
// }} ""
// {{ 48 1 0 "2b53981a_47c8_424c_9301b18bd3ba2202" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 49 1 0 "264b750a_1530_437c_acc90d906a5e20ab" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_ChannelPattern.SetSize(0);
// }} ""
// {{ 50 1 0 "9a4c4c53_6b3b_4076_a5affe15dc0e7e28" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialLabID.SetSize(0);
// }} ""
// {{ 51 1 0 "561cee02_6208_46b3_b328844659382709" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialCount.SetSize(0);
// }} ""
// {{ 52 1 0 "2618c78f_149e_4fe2_a0c277f0469c1a18" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 53 1 0 "75f43671_ac76_41b5_ad7e0fc8fe54cbdb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsEmpty);
// }} ""
// {{{ 54 1 0 "b642a966_d681_4516_9f271e63dd59e876" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsPickUp);
// }} ""
// {{{ 55 1 0 "be87ee20_e2ee_49a7_b5d90ad6f6b6d967" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsPutDown);
// }} ""
// {{ 56 1 0 "46e15b6d_544e_4fb4_bfffaec39ea9535d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used;

   SortFile.RemoveFields();

   str_SQL = "SELECT LAB_ID, COUNT(*) AS N FROM SORT WHERE USED = 1 GROUP BY LAB_ID ORDER BY COUNT(*) ASC";

   SortFile.AddField("N", int_Count, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      if(int_Count < 96)
      {
         arr_PartialLabID.AddAsLast(str_LabID);
         arr_PartialCount.AddAsLast(int_Count);
      }
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 58 1 0 "46e15b6d_544e_4fb4_bfffaec39ea9535d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 59 1 0 "504a2d8b_27d9_4eeb_ac60373c952591a6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Partial Racks           Count"), arr_PartialLabID, arr_PartialCount);
// }} ""
// {{ 60 1 0 "70c3c442_ca97_4d08_b7614f18a905105e" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalPartial=arr_PartialCount.GetSize();
// }} ""
// {{ 61 1 0 "68e999b0_ce10_49ea_99ad425cd690ca30" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_TotalPartial = int_TotalPartial - 1;
// }} ""
// {{ 62 1 0 "0a416d97_c85c_493f_a67f717302e6b3af" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TotalPartial <= 0)
{
// }} ""
// {{ 63 1 0 "bcb5b16e_34c2_4d5b_8191b361261124df" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 64 1 0 "0a416d97_c85c_493f_a67f717302e6b3af" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 65 1 0 "6304ecd1_bfb2_4d8b_b42e51c2533ba657" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelsSet = 0;
// }} ""
// {{ 66 1 0 "e84b9b5d_0d5f_4e3b_9291c67fb33bdf9f" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PickUpIndex.SetSize(0);
// }} ""
// {{ 67 1 0 "6f96e507_0192_4a4d_982a72662260bf1a" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PutDownIndex.SetSize(0);
// }} ""
// {{ 68 1 0 "a46644d8_9c18_4ed9_b9bd153e83f018f5" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_UsedIndex.SetSize(0);
// }} ""
// {{ 69 1 0 "a305b781_3a08_441f_a7c3afa28b30bcf1" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PickUpLabware.SetSize(0);
// }} ""
// {{ 70 1 0 "f080e335_80e9_4b1d_81ac2fcde90afcf4" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 71 1 0 "a9a0dd4d_af05_46a5_b90fb44e2f029e3b" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_ValueFound = BOOLEON::FALSE;
// }} ""
// {{ 72 1 0 "91e03bbe_d9ae_407a_9263e799e10a1118" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMax=arr_YMax.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 73 1 0 "85c448fc_15c6_4b2b_877fb65aa727b74e" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMin=arr_YMin.GetAt(int_ChannelIndex-1);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 74 1 0 "7424863f_c227_47d2_944b7767d13a1eb0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
flt_YMax = StrConcat2(flt_YMax, Translate(""));
// }} ""
// {{{ 75 1 0 "230ae61e_da67_4254_af2bb98d4e47329e" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
flt_YMin = StrConcat2(flt_YMin, Translate(""));
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 76 1 0 "7d98a8d3_32e4_4990_8565a02f4d9cbff5" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_LabIndex = 0; int_LabIndex < int_TotalPartial;)
{
int_LabIndex = int_LabIndex + 1;
// }} ""
// {{ 77 1 0 "346edca1_4416_4798_b03ccb6dc328dacb" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
str_CurrentLabID=arr_PartialLabID.GetAt(int_LabIndex-1);
// }} ""
// {{ 78 1 0 "6dd2541c_ef0d_43bc_af834ed3fb141be0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used, int_Index, a;

   SortFile.RemoveFields();

   SortFile.AddField("N", int_Count, hslInteger);
   flt_YMax = StrConcat2(flt_YMax, "");
   flt_YMin = StrConcat2(flt_YMin, "");

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 1 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin;

   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();
   SortFile.Close();
   SortFile.RemoveFields();

   if(int_Count > 0)
   {
      SortFile.AddField("INDEX", int_Index, hslInteger);
      SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("POS_ID", str_PosID, hslString, 255);

      str_SQL = "SELECT INDEX, LAB_ID, POS_ID FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 1 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin + " ORDER BY X_COORD ASC, Y_COORD DESC";
//Trace(str_SQL);      
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         if(!Util::Lookup(arr_UsedIndex,int_Index,a))
         {
            SeqAdd(seq_TipsPickUp, Translate(str_LabID), Translate(str_PosID));
            int_ChannelsSet = int_ChannelsSet + 1;
            arr_ChannelPattern.AddAsLast(1);
            arr_PickUpIndex.AddAsLast(int_Index);
            arr_UsedIndex.AddAsLast(int_Index);
            arr_PickUpLabware.AddAsLast(str_LabID);
            bln_ValueFound = hslTrue;
            break;
         }
      }
      SortFile.Close();
      SortFile.RemoveFields();
   }
}
// {{ 80 1 0 "6dd2541c_ef0d_43bc_af834ed3fb141be0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 81 1 0 "b4b3f25b_3623_4c06_8c8583643d1bf90c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelsSet == int_TotalChannels)
{
// }} ""
// {{ 82 1 0 "915f8589_98f5_49fa_b80b05b24fc27b75" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 83 1 0 "b4b3f25b_3623_4c06_8c8583643d1bf90c" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 84 1 0 "2fdd4062_9165_4534_aa6be3619c997b57" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::TRUE)
{
// }} ""
// {{ 85 1 0 "691a09ba_d1f1_4737_9b288b414f227d0d" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 86 1 0 "2fdd4062_9165_4534_aa6be3619c997b57" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 87 1 0 "7d98a8d3_32e4_4990_8565a02f4d9cbff5" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 88 1 0 "e1791715_0bc5_4e10_8afb8861ba529720" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::FALSE)
{
// }} ""
// {{ 89 1 0 "693eac53_1423_4e89_b5edcdc30c4de4c1" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.AddAsLast(0);
// }} ""
// {{ 90 1 0 "e1791715_0bc5_4e10_8afb8861ba529720" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 91 1 0 "ba6519af_6c15_439a_a450b189f858d6ef" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelsSet == int_TotalChannels)
{
// }} ""
// {{ 92 1 0 "92bfc96a_e6af_4c12_b1fe092c24a756ce" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 93 1 0 "ba6519af_6c15_439a_a450b189f858d6ef" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 94 1 0 "f080e335_80e9_4b1d_81ac2fcde90afcf4" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 95 1 0 "79910aa8_0a72_4ef2_9ab5b0bcab486e88" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TipsPickUp.SetCurrentPosition(1);
// }} ""
// {{ 96 1 0 "61ab4f51_de92_4e58_8cd8e27e2c1e6e37" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalSet=arr_ChannelPattern.GetSize();
// }} ""
// {{ 97 1 0 "c2e9404e_c829_4f46_a808a5f80e951b99" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 98 1 0 "2c91d11e_c2fe_45bb_b3f449998c367a8d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelIndex > int_TotalSet)
{
// }} ""
// {{ 99 1 0 "d1cf4ff7_fd7a_481d_a5205a60f5c61f89" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.AddAsLast(0);
// }} ""
// {{ 100 1 0 "2c91d11e_c2fe_45bb_b3f449998c367a8d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 101 1 0 "c2e9404e_c829_4f46_a808a5f80e951b99" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 102 1 0 "87cb5d1e_d310_41ee_b62ac0da1dea0001" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 103 1 0 "f8f5c817_2fd8_45b5_9516f0c9ecf31d9c" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialLabID.SetSize(0);
// }} ""
// {{ 104 1 0 "0621fd72_449e_44cc_b55644f2053719e3" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialCount.SetSize(0);
// }} ""
// {{ 105 1 0 "ad2f5d13_201f_439c_998d01cebb814900" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used;

   SortFile.RemoveFields();

   str_SQL = "SELECT LAB_ID, COUNT(*) AS N FROM SORT WHERE USED = 0 GROUP BY LAB_ID ORDER BY COUNT(*) ASC";

   SortFile.AddField("N", int_Count, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      if(int_Count < 96)
      {
         arr_PartialLabID.AddAsLast(str_LabID);
         arr_PartialCount.AddAsLast(int_Count);
      }
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 107 1 0 "ad2f5d13_201f_439c_998d01cebb814900" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 108 1 0 "4fa8c471_82dc_499e_8e2380224e8993a9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Partial Racks           Count"), arr_PartialLabID, arr_PartialCount);
// }} ""
// {{ 109 1 0 "7e0a0780_e774_4d46_a48efd38a4b59981" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalPartial=arr_PartialCount.GetSize();
// }} ""
// {{ 110 1 0 "19fc9c68_5a39_4457_9919096773cdea24" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_TotalPartial = int_TotalPartial - 1;
// }} ""
// {{ 111 1 0 "594442dd_b661_4419_aad3b2c2bdc695c3" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TotalPartial <= 0)
{
// }} ""
// {{ 112 1 0 "3894c497_daae_411d_b259bd59007957b7" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 113 1 0 "594442dd_b661_4419_aad3b2c2bdc695c3" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 114 1 0 "6265782a_e810_42e6_991b6d5cb8633f1c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelsSet = 0;
// }} ""
// {{ 115 1 0 "bc805cd6_4ada_4c2e_9b4040c540e82ed5" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 116 1 0 "446300dd_24d0_4c4d_96470659a0bed927" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
int_ChannelEnabled=arr_ChannelPattern.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 117 1 0 "9404ff2c_3b13_4cd2_8f440013b9bd734e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelEnabled == 1)
{
// }} ""
// {{ 118 1 0 "c9e131ae_0500_4cb6_b544874a3d5bdaf7" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_ValueFound = BOOLEON::FALSE;
// }} ""
// {{ 119 1 0 "d08cea0a_14c8_497f_a7c577dc159d2f6a" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMax=arr_YMax.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 120 1 0 "68f113a3_3471_47e6_ba192a3ab51cb5dc" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMin=arr_YMin.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 121 1 0 "6359b0d2_bbf9_45c7_b295a4b996b436a7" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_LabIndex = 0; int_LabIndex < int_TotalPartial;)
{
int_LabIndex = int_LabIndex + 1;
// }} ""
// {{ 122 1 0 "080ed07d_9615_485d_98f399712b68d765" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
str_CurrentLabID=arr_PartialLabID.GetAt(int_LabIndex-1);
// }} ""
// {{ 123 1 0 "44d52496_3bae_4713_8b9e441f64d82cbf" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used, int_Index, a;

   SortFile.RemoveFields();

   SortFile.AddField("N", int_Count, hslInteger);
   flt_YMax = StrConcat2(flt_YMax, "");
   flt_YMin = StrConcat2(flt_YMin, "");

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 0 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin;

   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();
   SortFile.Close();
   SortFile.RemoveFields();
//Trace("Count:  ",int_Count);
   if(int_Count > 0)
   {
      SortFile.AddField("INDEX", int_Index, hslInteger);
      SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("POS_ID", str_PosID, hslString, 255);
      
      str_SQL = "SELECT INDEX, LAB_ID, POS_ID FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 0 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin + " ORDER BY X_COORD DESC, Y_COORD DESC";
//Trace(str_SQL);      
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         if(!Util::Lookup(arr_UsedIndex,int_Index,a))
         {
               SeqAdd(seq_TipsPutDown, Translate(str_LabID), Translate(str_PosID));
               int_ChannelsSet = int_ChannelsSet + 1;
               arr_PutDownIndex.AddAsLast(int_Index);
               arr_UsedIndex.AddAsLast(int_Index);
               bln_ValueFound = hslTrue;
//Trace("Add position:  ",str_PosID);
               break;

//Trace("Lab ID:  ",str_LabID,"  Channel pickup Lab:  ",arr_PickUpLabware.GetAt(int_ChannelsSet));
            //if(arr_PickUpLabware.GetAt(int_ChannelsSet)!= str_CurrentLabID)
            //{
               //SeqAdd(seq_TipsPutDown, Translate(str_LabID), Translate(str_PosID));
               //int_ChannelsSet = int_ChannelsSet + 1;
               //arr_PutDownIndex.AddAsLast(int_Index);
               //arr_UsedIndex.AddAsLast(int_Index);
               //bln_ValueFound = hslTrue;
               //break;
            //}
            //else
            //{
               //arr_ChannelPattern.SetAt(int_ChannelIndex-1,0);
               //break;
            //}
         }
      }
      SortFile.Close();
      SortFile.RemoveFields();
   }
}
// {{ 125 1 0 "44d52496_3bae_4713_8b9e441f64d82cbf" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 126 1 0 "8e4c72b6_f87b_4853_8963156ad409109f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::FALSE)
{
// }} ""
// {{ 127 1 0 "1e4c6712_30ce_4f41_93644c887ce6e21d" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.SetAt(int_ChannelIndex-1, 0);
// }} ""
// {{ 128 1 0 "8e4c72b6_f87b_4853_8963156ad409109f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 129 1 0 "05c4a168_1ff8_44dd_a6f113cac237c6f8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelsSet == int_TotalChannels)
{
// }} ""
// {{ 130 1 0 "3eadc9c5_001b_448f_83ec29b8078196ce" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 131 1 0 "05c4a168_1ff8_44dd_a6f113cac237c6f8" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 132 1 0 "34dfa80b_625e_4899_bfcc2e7ac00b7eb2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::TRUE)
{
// }} ""
// {{ 133 1 0 "cd0d7e1e_7475_40dd_8743fc6bcb6c27b0" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 134 1 0 "34dfa80b_625e_4899_bfcc2e7ac00b7eb2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 135 1 0 "6359b0d2_bbf9_45c7_b295a4b996b436a7" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 136 1 0 "9404ff2c_3b13_4cd2_8f440013b9bd734e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 137 1 0 "bc805cd6_4ada_4c2e_9b4040c540e82ed5" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 138 1 0 "2907c2cd_b97f_4239_ba758f8299dd0edf" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TipsPutDown.SetCurrentPosition(1);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 139 1 0 "c69b1d73_3a6a_463d_bce9eb1498bf87ec" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceSequence(seq_TipsPickUp);
// }} ""
// {{{ 140 1 0 "313ae523_e88e_413f_b84648d1ab2fab31" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceSequence(seq_TipsPutDown);
// }} ""
// {{{ 141 1 0 "c692832c_eb7f_4e63_acf81a57d37dee77" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray(Translate("Channel Active"), arr_ChannelPattern);
// }} ""
// {{{ 142 1 0 "f516251d_08bd_41b8_a1d4cbcf171d70fc" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray(Translate("Pick up Index"), arr_PickUpIndex);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 143 1 0 "b8cd58b6_5cf7_422f_a1634c89f489d801" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
str_ChannelPattern = Translate("");
// }} ""
// {{ 144 1 0 "eb101996_05f3_4b97_bfceb1c094a4ee09" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{{ 145 1 0 "d4efa251_4b43_4be9_8580dba065761fbb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern = StrConcat4(str_ChannelPattern, arr_ChannelPattern.ElementAt( int_ChannelIndex -1), Translate(""), Translate(""));
// }} ""
// {{ 146 1 0 "eb101996_05f3_4b97_bfceb1c094a4ee09" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{{ 147 1 0 "9d7ae1f0_7bb1_4c22_8505886774f2aaa3" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Channel Pattern:  "), str_ChannelPattern);
// }} ""
// {{ 148 1 0 "b83e9be6_d630_44eb_a491f530f6362e79" "ML_STAR:{541143FA-7FA2-11D3-AD85-0004ACB1DCB2}"
{
	variable arrRetValues[];
	arrRetValues = ML_STAR._541143FA_7FA2_11D3_AD85_0004ACB1DCB2("b83e9be6_d630_44eb_a491f530f6362e79"); // TipPickUp
}
// }} ""
// {{ 149 1 0 "cd58fb8a_b0ce_4174_b40c8257faa3d377" "ML_STAR:{541143FC-7FA2-11D3-AD85-0004ACB1DCB2}"
{
	variable arrRetValues[];
	arrRetValues = ML_STAR._541143FC_7FA2_11D3_AD85_0004ACB1DCB2("cd58fb8a_b0ce_4174_b40c8257faa3d377"); // TipEject
}
// }} ""
// {{ 150 1 0 "9b46c20c_45bc_400b_9a25a5e40476af19" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalUpdates=arr_PickUpIndex.GetSize();
// }} ""
// {{ 151 1 0 "c6778974_fa7a_45fa_84be277b9465c358" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount;
   file UpdateFile;

   UpdateFile.RemoveFields();

   str_InValue = "(";

   int_UpdateCount = 0;
   for(i=0;i<int_TotalChannels;i++)
   {
      if(arr_ChannelPattern.GetAt(i) == 1)
      {
         int_Index = arr_PickUpIndex.GetAt(int_UpdateCount);
         if(int_UpdateCount > 0) str_InValue = str_InValue + ", ";
         str_InValue = StrConcat2(str_InValue , int_Index);
         int_ChannelCount = int_ChannelCount + 1;
         int_UpdateCount = int_UpdateCount + 1;
         if(int_UpdateCount>int_TotalUpdates) break;
      }
   }

   str_InValue = str_InValue + ")";

   if(int_UpdateCount > 0)
   {
      str_SQL = "UPDATE SORT SET USED = -1 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }
}
// {{ 153 1 0 "c6778974_fa7a_45fa_84be277b9465c358" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 154 1 0 "a557f854_5c3a_484e_9a8b35fe94226963" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalUpdates=arr_PutDownIndex.GetSize();
// }} ""
// {{ 155 1 0 "f27812b0_2b97_47a0_94bf892f0c9ccc14" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount;
   file UpdateFile;

   UpdateFile.RemoveFields();

   str_InValue = "(";

   int_UpdateCount = 0;
   for(i=0;i<int_TotalChannels;i++)
   {
      if(arr_ChannelPattern.GetAt(i) == 1)
      {
         int_Index = arr_PutDownIndex.GetAt(int_UpdateCount);
         if(int_UpdateCount > 0) str_InValue = str_InValue + ", ";
         str_InValue = StrConcat2(str_InValue , int_Index);
         int_ChannelCount = int_ChannelCount + 1;
         int_UpdateCount = int_UpdateCount + 1;
         if(int_UpdateCount>int_TotalUpdates) break;
      }
   }

   str_InValue = str_InValue + ")";

   if(int_UpdateCount > 0)
   {
      str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }

}
// {{ 157 1 0 "f27812b0_2b97_47a0_94bf892f0c9ccc14" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 158 1 0 "bcd0fc00_dc63_4b8e_bbc89c072daded5b" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 159 1 0 "0f79010c_947a_42e0_b72121f20be34d8c" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 160 1 0 "2b5fd35d_b21b_4912_9d6b436776fd1452" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_Tips);
// }} ""
// {{{ 161 1 0 "d34d628a_4f2d_4754_a14bed5ed84ac313" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsEmpty);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX, bln_Used;
   file ReadFile;

   ReadFile.RemoveFields();
   ReadFile.AddField("INDEX", int_PositionCount, hslInteger);
   ReadFile.AddField("USED", bln_Used, hslInteger);
   ReadFile.AddField("LAB_ID", str_LabID, hslString, 255);
   ReadFile.AddField("POS_ID", str_PosID, hslString, 255);
   ReadFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   ReadFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   ReadFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   ReadFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_TipsRemaining.GetTotal();

   ReadFile.SetExtendedProperties("HDR=YES");
   ReadFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead);
   
   int_PositionCount = 1;   
   int_Group = 0;
   bln_Used = 1;
   while(ReadFile.Eof() == 0)
   {
      ReadFile.ReadRecord();
      if(bln_Used > 0)
      {
         SeqAdd(io_seq_Tips, Translate(str_LabID), Translate(str_PosID));
      }
      else
      {
         SeqAdd(seq_TipsEmpty, Translate(str_LabID), Translate(str_PosID));
      }
   }

   ReadFile.Close();
   ReadFile.RemoveFields();
}
// {{ 163 1 0 "df596191_eb8b_4f57_825eaa977076f242" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
io_seq_Tips.SetCurrentPosition(1);
// }} ""
// {{{ 164 1 0 "25cce0f0_2d6d_45b4_b570a1d732284edc" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, io_seq_Tips, 5, Translate("With Tips"));
// }} ""
// {{{ 165 1 0 "e8aac9a4_8a66_45c2_b979e011c5f1542c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, seq_TipsEmpty, 4, Translate("No Tips"));
// }} ""
// {{ 166 1 0 "0f79010c_947a_42e0_b72121f20be34d8c" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 167 1 0 "6bffd842_42a6_4ff6_915e3aae07c5f0a6" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 168 1 0 "495fdce1_dccf_48cc_85a0070d57f7503b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 169 1 0 "6bffd842_42a6_4ff6_915e3aae07c5f0a6" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "DefragTipRacks1mL" "End"
}
// }} ""
// {{{ 5 "DefragTipRacks5mL" "Begin"
function DefragTipRacks5mL( device & ML_STAR, sequence & io_seq_Tips ) void {
// }} ""
private variable int_ChannelEnabled;
private variable str_ChannelPattern;
private variable i;
private variable flt_YMin;
private variable flt_YRaster;
private variable flt_YMax;
private variable int_NumInSeq;
private variable int_RemainingLabIDs;
private variable _strFunctionName;
private variable str_LabID;
private variable int_TotalPartial;
private variable int_Position;
private variable bool_FileExists;
private variable int_TotalSet;
private variable str_TempSortingFilePath;
private variable int_ChannelsSet;
private variable bln_ValueFound;
private variable int_TotalChannels;
private variable int_ChannelIndex;
private variable str_PosID;
private variable int_TotalUpdates;
private variable int_LabIndex;
private variable str_CurrentLabID;
private variable int_Index;
private sequence seq_TipsEmpty;
private sequence seq_Temp;
private sequence seq_TipsRemaining;
private sequence seq_TipsPickUp;
private sequence seq_TipsPutDown;
private variable arr_PutDownIndex[];
private variable arr_PartialCount[];
private variable arr_LabIDs[];
private variable arr_UsedIndex[];
private variable arr_PickUpIndex[];
private variable arr_ChannelPattern[];
private variable arr_PickUpLabware[];
private variable arr_YMin[];
private variable arr_YMax[];
private variable arr_PartialLabID[];
// {{ 5 "DefragTipRacks5mL" "InitLocals"
// }} ""
// {{ 171 1 0 "1146ff82_6bac_48a7_8800a3dca8b07b52" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 172 1 0 "bfd40927_28fd_4a8d_928e323df422c24a" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 174 1 0 "8c768196_1b81_4818_879edb456c726e38" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 175 1 0 "1146ff82_6bac_48a7_8800a3dca8b07b52" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 176 1 0 "d1a0b7e6_77b9_4d37_90f6d295f1eaedd2" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get5mLChannelCount(ML_STAR, int_TotalChannels);
// }} ""
// {{{ 177 1 0 "7d00a056_2c2c_4519_a43fadb24b88f418" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetChannelLimits(ML_STAR, 1, arr_YMax, arr_YMin, flt_YRaster);
// }} ""
// {{{ 178 1 0 "838213a9_e572_42d5_91ec15b312144760" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsRemaining);
// }} ""
// {{{ 179 1 0 "2e6f3065_f833_4541_bba008bc845256e2" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqCopySequence(seq_TipsRemaining, io_seq_Tips);
// }} ""
// {{{ 180 1 0 "d5736cca_6519_4c37_b4b3a1bae2a3a415" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, seq_TipsRemaining);
// }} ""
// {{{ 181 1 0 "7fb2acb0_4d90_4fd7_9799f4acb687f87c" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 182 1 0 "d35e7f49_9b8c_41af_96187e52e0e96255" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
StrReplace(str_TempSortingFilePath, Translate("TEMP_SORT_FILE"), Translate("TEMP_DEFRAG_FILE"));
// }} ""
Trace(str_TempSortingFilePath);
// {{{ 184 1 0 "c50671a9_62d3_4653_bd5f0dd58d1744f7" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 185 1 0 "04a637c6_b13a_4131_901001ae2886a749" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 186 1 0 "14701cc1_8390_455a_b474ca3a4847fd62" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 187 1 0 "04a637c6_b13a_4131_901001ae2886a749" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 188 1 0 "08ae7509_b74f_437e_a319cf80b8c110a7" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 189 1 0 "86afd601_7f55_4b4b_ae99d76b476c480f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqGetLabwareIds(seq_TipsRemaining, arr_LabIDs);
// }} ""
// {{ 190 1 0 "a97a707a_e58e_4265_a5679c1afe2a2819" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_RemainingLabIDs=arr_LabIDs.GetSize();
// }} ""
// {{ 191 1 0 "f119a988_ffb3_4109_bff582c24f20db1a" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_Index = 0; int_Index < int_RemainingLabIDs;)
{
int_Index = int_Index + 1;
// }} ""
// {{ 192 1 0 "669a611b_8b96_4734_bbb001fa3cedb2b7" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
str_LabID=arr_LabIDs.GetAt(int_Index-1);
// }} ""
// {{{ 193 1 0 "17c899e3_1a31_4531_a9b830e9e3b7a81e" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetDefaultSequence(ML_STAR, str_LabID, 1, seq_Temp);
// }} ""
// {{{ 194 1 0 "d13e2ca5_e80c_4ffe_8bbca3a4cd449456" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_NumInSeq = SeqGetTotal(seq_Temp);
// }} ""
// {{ 195 1 0 "05868a67_3d49_4717_a8157b1666305879" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(i = 0; i < int_NumInSeq;)
{
i = i + 1;
// }} ""
// {{ 196 1 0 "44c2c0ff_e55f_4b53_9649220d9fff4f28" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_Temp.SetCurrentPosition(i);
// }} ""
// {{{ 197 1 0 "a868e59e_832a_42cf_b6aec08c3288b781" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(seq_Temp);
// }} ""
// {{{ 198 1 0 "082251b8_50e1_4571_866985c4d588dd2b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PosID = SeqGetPositionId(seq_Temp);
// }} ""
// {{{ 199 1 0 "c2f6870c_d951_43e2_83770c80e4186df1" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_Position = SeqLookupPosition(seq_TipsRemaining, str_LabID, str_PosID, 1, 1);
// }} ""
// {{ 200 1 0 "37bce94a_08f5_41dc_a754b8ab34bdac72" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_Position == 0)
{
// }} ""
// {{{ 201 1 0 "83d1081b_f54b_43d5_a259a7d3bfafade9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqAdd(seq_TipsEmpty, str_LabID, str_PosID);
// }} ""
// {{ 202 1 0 "37bce94a_08f5_41dc_a754b8ab34bdac72" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 203 1 0 "05868a67_3d49_4717_a8157b1666305879" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 204 1 0 "f119a988_ffb3_4109_bff582c24f20db1a" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 205 1 0 "92a11ed4_f700_49d2_89eb8faea0ba558f" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TipsEmpty.SetCurrentPosition(1);
// }} ""
// {{ 206 1 0 "da4bbcbc_6407_4ebd_b344c706411d2667" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 207 1 0 "bc345184_104c_445a_ae08028ece365c8a" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX, bln_Used;
   file WriteFile;

   WriteFile.RemoveFields();
   WriteFile.AddField("INDEX", int_PositionCount, hslInteger);
   WriteFile.AddField("USED", bln_Used, hslInteger);
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   WriteFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   WriteFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_TipsRemaining.GetTotal();

   WriteFile.SetExtendedProperties("HDR=YES");
   WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite);
   
   int_PositionCount = 1;   
   int_Group = 0;
   bln_Used = 1;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_TipsRemaining.SetCurrentPosition(i);

      str_LabID = seq_TipsRemaining.GetLabwareId();
      str_PosID = seq_TipsRemaining.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   int_TotalValues = seq_TipsEmpty.GetTotal();
   bln_Used = 0;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_TipsEmpty.SetCurrentPosition(i);

      str_LabID = seq_TipsEmpty.GetLabwareId();
      str_PosID = seq_TipsEmpty.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   WriteFile.Close();
   WriteFile.RemoveFields();
}
// {{ 209 1 0 "bc345184_104c_445a_ae08028ece365c8a" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 210 1 0 "30394ad0_d105_4d52_b03d25bb3d7b58bc" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (BOOLEON::TRUE == BOOLEON::TRUE)
{
// }} ""
// {{ 211 1 0 "661b4da3_1559_4562_ac12bb3e8098414e" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 212 1 0 "2c538ce3_261a_4b6f_b629d9814533c2f9" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_ChannelPattern.SetSize(0);
// }} ""
// {{ 213 1 0 "87fbe777_b062_4ac8_a4e52a97a414b24f" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialLabID.SetSize(0);
// }} ""
// {{ 214 1 0 "d339514f_0972_4694_9ff668cb76e5dfd8" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialCount.SetSize(0);
// }} ""
// {{ 215 1 0 "3f18207e_9056_4a55_ac0560556ceb8ccc" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 216 1 0 "d5c68273_c25e_4520_88451847540aab2d" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsEmpty);
// }} ""
// {{{ 217 1 0 "26f7876a_046f_429d_beba442f759ed8d0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsPickUp);
// }} ""
// {{{ 218 1 0 "a32339db_d892_434c_876c4afb3795c33f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsPutDown);
// }} ""
// {{ 219 1 0 "13532881_39cc_4b80_989852d0c70baa76" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used;
   file SortFile;

   SortFile.RemoveFields();

   str_SQL = "SELECT LAB_ID, COUNT(*) AS N FROM SORT WHERE USED = 1 GROUP BY LAB_ID ORDER BY COUNT(*) ASC";

   SortFile.AddField("N", int_Count, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      if(int_Count < 96)
      {
         arr_PartialLabID.AddAsLast(str_LabID);
         arr_PartialCount.AddAsLast(int_Count);
      }
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 221 1 0 "13532881_39cc_4b80_989852d0c70baa76" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 222 1 0 "5a210ffc_8ad0_489b_ab3f1729598d3cdd" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Partial Racks           Count"), arr_PartialLabID, arr_PartialCount);
// }} ""
// {{ 223 1 0 "0c496107_7eb3_42aa_a26f443157c01622" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalPartial=arr_PartialCount.GetSize();
// }} ""
// {{ 224 1 0 "92c0b003_0123_4bac_a8e3cc72e732de65" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_TotalPartial = int_TotalPartial - 1;
// }} ""
// {{ 225 1 0 "525ada1d_545f_4b8e_a5f6096a326a09f4" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TotalPartial <= 0)
{
// }} ""
// {{ 226 1 0 "9aa6e6e0_895a_43fd_b70dd4550b6592be" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 227 1 0 "525ada1d_545f_4b8e_a5f6096a326a09f4" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 228 1 0 "3f2d8a37_c7ab_4c60_a3c46f0d2bd58e25" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelsSet = 0;
// }} ""
// {{ 229 1 0 "b0ec7482_d032_49d1_ac2bd6fcb8304c13" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PickUpIndex.SetSize(0);
// }} ""
// {{ 230 1 0 "9e90e365_35e6_4269_b3dddd742eb192fe" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PutDownIndex.SetSize(0);
// }} ""
// {{ 231 1 0 "5bd4833b_1468_4f53_9c7e59d900809cc2" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_UsedIndex.SetSize(0);
// }} ""
// {{ 232 1 0 "d718517a_866b_4b4c_91d9d8cd01c79cc9" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PickUpLabware.SetSize(0);
// }} ""
// {{ 233 1 0 "342873d6_9866_467b_a8aa1a30b9dc8480" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 234 1 0 "2b914764_f551_437c_807e1b0f20383d38" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_ValueFound = BOOLEON::FALSE;
// }} ""
// {{ 235 1 0 "15be03e6_4adf_4a3f_90857e708313552b" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMax=arr_YMax.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 236 1 0 "dbd69943_50df_4cb4_bc22efec00534d44" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMin=arr_YMin.GetAt(int_ChannelIndex-1);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 237 1 0 "6f0a301b_01bc_44f0_ba3f3599e0ed6ac8" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
flt_YMax = StrConcat2(flt_YMax, Translate(""));
// }} ""
// {{{ 238 1 0 "6edd03bb_7acd_427b_bb531deff0e6f4b5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
flt_YMin = StrConcat2(flt_YMin, Translate(""));
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 239 1 0 "60a16d48_ce29_445f_9a9cf46c49867abb" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_LabIndex = 0; int_LabIndex < int_TotalPartial;)
{
int_LabIndex = int_LabIndex + 1;
// }} ""
// {{ 240 1 0 "3f457565_e51f_453c_b59661220551bc83" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
str_CurrentLabID=arr_PartialLabID.GetAt(int_LabIndex-1);
// }} ""
// {{ 241 1 0 "03e4e997_6db8_4b89_81b7626fc384414b" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used, int_Index, a;
   file SortFile;

   SortFile.RemoveFields();

   SortFile.AddField("N", int_Count, hslInteger);
   flt_YMax = StrConcat2(flt_YMax, "");
   flt_YMin = StrConcat2(flt_YMin, "");

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 1 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin;

   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();
   SortFile.Close();
   SortFile.RemoveFields();

   if(int_Count > 0)
   {
      SortFile.AddField("INDEX", int_Index, hslInteger);
      SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("POS_ID", str_PosID, hslString, 255);

      str_SQL = "SELECT INDEX, LAB_ID, POS_ID FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 1 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin + " ORDER BY X_COORD ASC, Y_COORD DESC";
//Trace(str_SQL);      
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         if(!Util::Lookup(arr_UsedIndex,int_Index,a))
         {
            SeqAdd(seq_TipsPickUp, Translate(str_LabID), Translate(str_PosID));
            int_ChannelsSet = int_ChannelsSet + 1;
            arr_ChannelPattern.AddAsLast(1);
            arr_PickUpIndex.AddAsLast(int_Index);
            arr_UsedIndex.AddAsLast(int_Index);
            arr_PickUpLabware.AddAsLast(str_LabID);
            bln_ValueFound = hslTrue;
            break;
         }
      }
      SortFile.Close();
      SortFile.RemoveFields();
   }
}
// {{ 243 1 0 "03e4e997_6db8_4b89_81b7626fc384414b" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 244 1 0 "f34fc3c5_ddac_4fe5_b89dc5cae395b778" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelsSet == int_TotalChannels)
{
// }} ""
// {{ 245 1 0 "fc5ba594_0ded_4080_8929084a4e7916e1" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 246 1 0 "f34fc3c5_ddac_4fe5_b89dc5cae395b778" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 247 1 0 "9616560d_2d52_45d8_824c9187e0ce97ca" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::TRUE)
{
// }} ""
// {{ 248 1 0 "fccdef14_cfe7_431a_ab783957e03fa50f" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 249 1 0 "9616560d_2d52_45d8_824c9187e0ce97ca" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 250 1 0 "60a16d48_ce29_445f_9a9cf46c49867abb" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 251 1 0 "4402dd3c_aa15_47b3_b84363db2b4e0c0f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::FALSE)
{
// }} ""
// {{ 252 1 0 "8171262a_78f8_46fe_8f26935c31fd5087" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.AddAsLast(0);
// }} ""
// {{ 253 1 0 "4402dd3c_aa15_47b3_b84363db2b4e0c0f" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 254 1 0 "b227142b_f2a9_4fdf_b478418a1b8a74fd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelsSet == int_TotalChannels)
{
// }} ""
// {{ 255 1 0 "2cbf7c16_2a5b_4aee_81b39ff7043910aa" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 256 1 0 "b227142b_f2a9_4fdf_b478418a1b8a74fd" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 257 1 0 "342873d6_9866_467b_a8aa1a30b9dc8480" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 258 1 0 "eb07a9ee_eb19_43ff_9c1ff1a61bd91aed" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TipsPickUp.SetCurrentPosition(1);
// }} ""
// {{ 259 1 0 "1ee6513b_953e_4af0_8f254d90bbf2b66a" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalSet=arr_ChannelPattern.GetSize();
// }} ""
// {{ 260 1 0 "5d9773cf_b749_411a_b311da1f1fd081de" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 261 1 0 "f2fad619_fec9_4708_ba683c5acec56048" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelIndex > int_TotalSet)
{
// }} ""
// {{ 262 1 0 "2a055ff0_77a7_4a2f_9fb4de4de500a64b" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.AddAsLast(0);
// }} ""
// {{ 263 1 0 "f2fad619_fec9_4708_ba683c5acec56048" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 264 1 0 "5d9773cf_b749_411a_b311da1f1fd081de" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 265 1 0 "122df66b_0ca3_42a4_89d88c28c547dea9" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 266 1 0 "c1693d0c_6b52_447e_ba87fd39beb0224c" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialLabID.SetSize(0);
// }} ""
// {{ 267 1 0 "d9a0a5b2_9a49_4e6a_83eb6ad190a3c921" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_PartialCount.SetSize(0);
// }} ""
// {{ 268 1 0 "bf251e5a_07f2_4987_bf3f871b504bd15f" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used;
   file SortFile;

   SortFile.RemoveFields();

   str_SQL = "SELECT LAB_ID, COUNT(*) AS N FROM SORT WHERE USED = 0 GROUP BY LAB_ID ORDER BY COUNT(*) ASC";

   SortFile.AddField("N", int_Count, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      if(int_Count < 96)
      {
         arr_PartialLabID.AddAsLast(str_LabID);
         arr_PartialCount.AddAsLast(int_Count);
      }
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 270 1 0 "bf251e5a_07f2_4987_bf3f871b504bd15f" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 271 1 0 "4d589e1d_5495_4d42_8205da39f83bccbd" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Partial Racks           Count"), arr_PartialLabID, arr_PartialCount);
// }} ""
// {{ 272 1 0 "fcfcb534_044f_4a41_aa57497aecc0f543" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalPartial=arr_PartialCount.GetSize();
// }} ""
// {{ 273 1 0 "e2793c7e_118f_4d0d_92c7271474c2bc25" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_TotalPartial = int_TotalPartial - 1;
// }} ""
// {{ 274 1 0 "62ff2218_ed6a_4688_b708014e01841c78" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TotalPartial <= 0)
{
// }} ""
// {{ 275 1 0 "5b3b9fef_1ad7_479a_a1f8619cd4c7e7bf" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 276 1 0 "62ff2218_ed6a_4688_b708014e01841c78" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 277 1 0 "c8c65a59_2beb_42e9_a12a874e3524cdca" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelsSet = 0;
// }} ""
// {{ 278 1 0 "27e00e40_edca_4cce_a9f0774c9117f8c3" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 279 1 0 "66fe9258_bf1d_4f91_bc6dd658787c4e04" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
int_ChannelEnabled=arr_ChannelPattern.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 280 1 0 "166c40df_aa1f_4d13_9d394cd0a4102ac2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelEnabled == 1)
{
// }} ""
// {{ 281 1 0 "55b1b11e_dbe3_4338_bc5bb3abec57886e" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_ValueFound = BOOLEON::FALSE;
// }} ""
// {{ 282 1 0 "24e1052a_3e4d_469e_b955a31e36ea9580" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMax=arr_YMax.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 283 1 0 "33551843_06bc_4921_907eb35179e77273" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
flt_YMin=arr_YMin.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 284 1 0 "1904157b_781f_44b6_a1c71dbfdf3373c4" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_LabIndex = 0; int_LabIndex < int_TotalPartial;)
{
int_LabIndex = int_LabIndex + 1;
// }} ""
// {{ 285 1 0 "531ece5b_9730_444a_967f9d67ab971e48" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
str_CurrentLabID=arr_PartialLabID.GetAt(int_LabIndex-1);
// }} ""
// {{ 286 1 0 "25c79887_7fdd_4218_97f4d227d74be16d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used, int_Index, a;
   file SortFile;

   SortFile.RemoveFields();

   SortFile.AddField("N", int_Count, hslInteger);
   flt_YMax = StrConcat2(flt_YMax, "");
   flt_YMin = StrConcat2(flt_YMin, "");

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 0 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin;

   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();
   SortFile.Close();
   SortFile.RemoveFields();
//Trace("Count:  ",int_Count);
   if(int_Count > 0)
   {
      SortFile.AddField("INDEX", int_Index, hslInteger);
      SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("POS_ID", str_PosID, hslString, 255);
      
      str_SQL = "SELECT INDEX, LAB_ID, POS_ID FROM SORT WHERE LAB_ID = '" + str_CurrentLabID + "' AND USED = 0 AND Y_COORD <= " + flt_YMax + " AND Y_COORD >= "+ flt_YMin + " ORDER BY X_COORD DESC, Y_COORD DESC";
//Trace(str_SQL);      
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         if(!Util::Lookup(arr_UsedIndex,int_Index,a))
         {
               SeqAdd(seq_TipsPutDown, Translate(str_LabID), Translate(str_PosID));
               int_ChannelsSet = int_ChannelsSet + 1;
               arr_PutDownIndex.AddAsLast(int_Index);
               arr_UsedIndex.AddAsLast(int_Index);
               bln_ValueFound = hslTrue;
//Trace("Add position:  ",str_PosID);
               break;

//Trace("Lab ID:  ",str_LabID,"  Channel pickup Lab:  ",arr_PickUpLabware.GetAt(int_ChannelsSet));
            //if(arr_PickUpLabware.GetAt(int_ChannelsSet)!= str_CurrentLabID)
            //{
               //SeqAdd(seq_TipsPutDown, Translate(str_LabID), Translate(str_PosID));
               //int_ChannelsSet = int_ChannelsSet + 1;
               //arr_PutDownIndex.AddAsLast(int_Index);
               //arr_UsedIndex.AddAsLast(int_Index);
               //bln_ValueFound = hslTrue;
               //break;
            //}
            //else
            //{
               //arr_ChannelPattern.SetAt(int_ChannelIndex-1,0);
               //break;
            //}
         }
      }
      SortFile.Close();
      SortFile.RemoveFields();
   }
}
// {{ 288 1 0 "25c79887_7fdd_4218_97f4d227d74be16d" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 289 1 0 "1fa65b4a_c2ad_4ac7_bdfb768814347978" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::FALSE)
{
// }} ""
// {{ 290 1 0 "a9c5d6f0_0c6c_47a6_b24d79a09e241827" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.SetAt(int_ChannelIndex-1, 0);
// }} ""
// {{ 291 1 0 "1fa65b4a_c2ad_4ac7_bdfb768814347978" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 292 1 0 "3cb178b5_95b4_4cbb_a04377cb2908a478" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelsSet == int_TotalChannels)
{
// }} ""
// {{ 293 1 0 "f30313a3_79f3_4a70_ad43869b8526a46e" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 294 1 0 "3cb178b5_95b4_4cbb_a04377cb2908a478" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 295 1 0 "a688deb6_95fb_4beb_a378f67fb0e07760" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_ValueFound == BOOLEON::TRUE)
{
// }} ""
// {{ 296 1 0 "68a00408_e390_40e3_94a95de6072947ce" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 297 1 0 "a688deb6_95fb_4beb_a378f67fb0e07760" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 298 1 0 "1904157b_781f_44b6_a1c71dbfdf3373c4" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 299 1 0 "166c40df_aa1f_4d13_9d394cd0a4102ac2" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 300 1 0 "27e00e40_edca_4cce_a9f0774c9117f8c3" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 301 1 0 "b8ccc1a1_5af2_474a_8d1768957e6a81fa" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_TipsPutDown.SetCurrentPosition(1);
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 302 1 0 "81a9c1a6_2899_4d66_aedfe2f4d360ea8c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceSequence(seq_TipsPickUp);
// }} ""
// {{{ 303 1 0 "7672f7d1_511a_4ef5_a9749485566f3a05" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceSequence(seq_TipsPutDown);
// }} ""
// {{{ 304 1 0 "d5f7bbd6_7f0f_4114_b82d631ff6bbfdfe" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray(Translate("Channel Active"), arr_ChannelPattern);
// }} ""
// {{{ 305 1 0 "fa5dcf75_836c_4b10_bb3b3e9c67cd56d5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray(Translate("Pick up Index"), arr_PickUpIndex);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 306 1 0 "e9938fcb_3861_4257_83d8c6af117edbb3" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
str_ChannelPattern = Translate("");
// }} ""
// {{ 307 1 0 "a26fac44_de43_4c9b_b8cfc164ad99bf94" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{{ 308 1 0 "a22dd98b_facb_4a22_9ed23162dd82dd75" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_ChannelPattern = StrConcat4(str_ChannelPattern, arr_ChannelPattern.ElementAt( int_ChannelIndex -1), Translate(""), Translate(""));
// }} ""
// {{ 309 1 0 "a26fac44_de43_4c9b_b8cfc164ad99bf94" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{{ 310 1 0 "11567802_dea6_4364_869802634c56e2ce" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Channel Pattern:  "), str_ChannelPattern);
// }} ""
// {{ 311 1 0 "92bd7a52_620d_4b33_8cecf0309009da37" "ML_STAR:{AFA41E7B-21AC-4a24-804E-41716114FEC3}"
{
	variable arrRetValues[];
	arrRetValues = ML_STAR._AFA41E7B_21AC_4a24_804E_41716114FEC3("92bd7a52_620d_4b33_8cecf0309009da37"); // XLTipPickUp
}
// }} ""
// {{ 312 1 0 "30183972_a0b0_4195_a293839433f4a960" "ML_STAR:{7F970BA7-528E-4283-807A-325DED0C065A}"
{
	variable arrRetValues[];
	arrRetValues = ML_STAR._7F970BA7_528E_4283_807A_325DED0C065A("30183972_a0b0_4195_a293839433f4a960"); // XLTipEject
}
// }} ""
// {{ 313 1 0 "a3a8df75_ac2b_4dce_b9cd41b8b06b5918" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalUpdates=arr_PickUpIndex.GetSize();
// }} ""
// {{ 314 1 0 "d0df8add_0b3e_46a5_ab815cbe30de2d24" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount;
   file UpdateFile;

   UpdateFile.RemoveFields();

   str_InValue = "(";

   int_UpdateCount = 0;
   for(i=0;i<int_TotalChannels;i++)
   {
      if(arr_ChannelPattern.GetAt(i) == 1)
      {
         int_Index = arr_PickUpIndex.GetAt(int_UpdateCount);
         if(int_UpdateCount > 0) str_InValue = str_InValue + ", ";
         str_InValue = StrConcat2(str_InValue , int_Index);
         int_ChannelCount = int_ChannelCount + 1;
         int_UpdateCount = int_UpdateCount + 1;
         if(int_UpdateCount>int_TotalUpdates) break;
      }
   }

   str_InValue = str_InValue + ")";

   if(int_UpdateCount > 0)
   {
      str_SQL = "UPDATE SORT SET USED = -1 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }
}
// {{ 316 1 0 "d0df8add_0b3e_46a5_ab815cbe30de2d24" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 317 1 0 "6ad9c6e9_63a7_4741_b83cd1d5039cc665" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalUpdates=arr_PutDownIndex.GetSize();
// }} ""
// {{ 318 1 0 "4695ae77_fba0_4d56_af0ede6bd9978b63" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount;
   file UpdateFile;

   UpdateFile.RemoveFields();

   str_InValue = "(";

   int_UpdateCount = 0;
   for(i=0;i<int_TotalChannels;i++)
   {
      if(arr_ChannelPattern.GetAt(i) == 1)
      {
         int_Index = arr_PutDownIndex.GetAt(int_UpdateCount);
         if(int_UpdateCount > 0) str_InValue = str_InValue + ", ";
         str_InValue = StrConcat2(str_InValue , int_Index);
         int_ChannelCount = int_ChannelCount + 1;
         int_UpdateCount = int_UpdateCount + 1;
         if(int_UpdateCount>int_TotalUpdates) break;
      }
   }

   str_InValue = str_InValue + ")";

   if(int_UpdateCount > 0)
   {
      str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }

}
// {{ 320 1 0 "4695ae77_fba0_4d56_af0ede6bd9978b63" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 321 1 0 "30394ad0_d105_4d52_b03d25bb3d7b58bc" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 322 1 0 "351305e6_d4dc_4ac5_90901332eb584cb7" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 323 1 0 "247abfa1_508f_4a5c_b3f98afd392e1931" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_Tips);
// }} ""
// {{{ 324 1 0 "b3650eea_b182_4707_b1b18d3bd4a929a6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(seq_TipsEmpty);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX, bln_Used;
   file ReadFile;

   ReadFile.RemoveFields();
   ReadFile.AddField("INDEX", int_PositionCount, hslInteger);
   ReadFile.AddField("USED", bln_Used, hslInteger);
   ReadFile.AddField("LAB_ID", str_LabID, hslString, 255);
   ReadFile.AddField("POS_ID", str_PosID, hslString, 255);
   ReadFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   ReadFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   ReadFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   ReadFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_TipsRemaining.GetTotal();

   ReadFile.SetExtendedProperties("HDR=YES");
   ReadFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead);
   
   int_PositionCount = 1;   
   int_Group = 0;
   bln_Used = 1;
   while(ReadFile.Eof() == 0)
   {
      ReadFile.ReadRecord();
      if(bln_Used > 0)
      {
         SeqAdd(io_seq_Tips, Translate(str_LabID), Translate(str_PosID));
      }
      else
      {
         SeqAdd(seq_TipsEmpty, Translate(str_LabID), Translate(str_PosID));
      }
   }

   ReadFile.Close();
   ReadFile.RemoveFields();
}
// {{ 326 1 0 "1bc1a5af_867c_489f_ade7740f2fcd5601" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
io_seq_Tips.SetCurrentPosition(1);
// }} ""
// {{{ 327 1 0 "4226b44e_0f2d_4e11_b6f24b1a917e7025" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, io_seq_Tips, 5, Translate("With Tips"));
// }} ""
// {{{ 328 1 0 "98de9c99_d096_44da_a43b17dd265e2ce0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DeckVisualize::UpdateUsedPositions(ML_STAR, seq_TipsEmpty, 4, Translate("No Tips"));
// }} ""
// {{ 329 1 0 "351305e6_d4dc_4ac5_90901332eb584cb7" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 330 1 0 "d3d93bf2_7358_4104_97caaae9491cbeaf" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 331 1 0 "6ad71463_9136_498b_883a3072a555fe8a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 332 1 0 "d3d93bf2_7358_4104_97caaae9491cbeaf" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "DefragTipRacks5mL" "End"
}
// }} ""
// {{{ 5 "Optimized5mLTipPickup2" "Begin"
function Optimized5mLTipPickup2( device & ML_STAR, sequence & io_seq_TipSequence, variable i_str_TipCounter, variable i_str_ChannelPattern ) void {
// }} ""
private dialog customDialogD6E91AF203E543c7804E065769839332;
private variable int_ChannelSet;
private variable flt_NotUsed;
private variable flt_CurrentX;
private variable flt_CurrentY;
private variable flt_TipCapacity;
private variable flt_YRaster;
private variable int_TotalOptions;
private variable _strFunctionName;
private variable bln_OptimizationNeeded;
private variable str_LabID;
private variable bool_FileExists;
private variable flt_PreviousY;
private variable str_TipMessage;
private variable flt_TargetX;
private variable str_TempSortingFilePath;
private variable int_ChannelActive;
private variable int_TotalChannels;
private variable int_ChannelValue;
private variable int_ChannelIndex;
private variable int_TipsNeeded;
private variable bln_EnoughTipsLoaded;
private variable str_PosID;
private variable str_Value;
private variable str_TipName;
private sequence seq_RemainingSequence;
private variable arr_GroupedXCoords[];
private variable arr_GroupNumber[];
private variable arr_ChannelPattern[];
private variable arr_YMin[];
private variable arr_YMax[];
private variable arr_GroupedCounts[];
private variable arr_GroupedLabID[];
// {{ 5 "Optimized5mLTipPickup2" "InitLocals"
// }} ""
// {{ 714 1 0 "87fac8de_eb41_437c_9d54ac067e1414d0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 715 1 0 "bd04db41_859b_4d6d_b6fc631ae437ee1d" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 717 1 0 "de5e993e_e70e_418d_bfef3d37284a4d0a" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 718 1 0 "87fac8de_eb41_437c_9d54ac067e1414d0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 719 1 0 "4829ea73_449c_4d89_b959c8a72ba41a4b" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
Get5mLChannelCount(ML_STAR, int_TotalChannels);
// }} ""
// {{{ 720 1 0 "15ced722_ce0d_4885_ad64198917ec2408" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetChannelLimits(ML_STAR, 1, arr_YMax, arr_YMin, flt_YRaster);
// }} ""
// {{{ 721 1 0 "aff02788_116e_4cd7_95a58816d96f0c0b" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_TipsNeeded = StrReplace(i_str_ChannelPattern, Translate("1"), Translate("1"));
// }} ""
// {{{ 722 1 0 "244ea944_17f3_49b0_8b533bf27f24197c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
i_str_ChannelPattern = StrFillRight(i_str_ChannelPattern, Translate("0"), int_TotalChannels);
// }} ""
// {{ 723 1 0 "ee35b2e3_d22a_4950_b68825bfecd9db32" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_ChannelPattern.SetSize(0);
// }} ""
// {{ 724 1 0 "8ec59276_1a70_4ab4_a3729421d1c688a1" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{{ 725 1 0 "88ee7f36_4b73_4be0_a81e232579f752c9" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_Value = StrLeft(i_str_ChannelPattern, int_ChannelIndex);
// }} ""
// {{{ 726 1 0 "8b1fd738_6bcb_4b02_943a9480ca256ba4" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_Value = StrRight(str_Value, 1);
// }} ""
// {{{ 727 1 0 "03f35a53_a324_4d8d_b267b9b2969fb139" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
int_ChannelValue = StrIVal(str_Value);
// }} ""
// {{ 728 1 0 "6d21d8e3_b318_48b1_bf20dccb62a046f6" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
arr_ChannelPattern.AddAsLast(int_ChannelValue);
// }} ""
// {{ 729 1 0 "8ec59276_1a70_4ab4_a3729421d1c688a1" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 730 1 0 "29efdf4f_456c_4b73_a8b2fe99c3865a05" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_TipsNeeded == 0)
{
// }} ""
// {{ 731 1 0 "01226fab_1c70_47b8_bd9aa678c03764f0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 732 1 0 "790ee152_e566_40a3_82c5893715262b18" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 733 1 0 "01226fab_1c70_47b8_bd9aa678c03764f0" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 734 1 0 "25b12484_a8ec_4cc1_a95f57ca4a498186" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return;
// }} ""
// {{ 735 1 0 "29efdf4f_456c_4b73_a8b2fe99c3865a05" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 736 1 0 "29fa761c_e3d9_468d_9c101062787f26a8" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
while (BOOLEON::TRUE == BOOLEON::TRUE)
{
// }} ""
// {{{ 737 1 0 "9f0ac349_9daf_40fd_b27d5bfd9f6d5ae6" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCheck(ML_STAR, io_seq_TipSequence, i_str_TipCounter, int_TipsNeeded);
// }} ""
// {{{ 738 1 0 "1e9b9567_8535_4fdc_8da381e5eeb945b7" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqCopySequence(seq_RemainingSequence, io_seq_TipSequence);
// }} ""
// {{{ 739 1 0 "23873598_d72f_41dc_b5ddb1f786d28880" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::RemoveTruncatedSequencePositions(ML_STAR, seq_RemainingSequence);
// }} ""
// {{{ 740 1 0 "0fec3806_f601_42b6_9ee50f5e9534d908" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 741 1 0 "9ed69bc7_7cde_4dfb_8b22f2c2ae928cfe" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
bool_FileExists = HSLExtensions::File::Exists(str_TempSortingFilePath);
// }} ""
// {{ 742 1 0 "6debfd39_1031_454c_89baff5f0d55e7f5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bool_FileExists == 1)
{
// }} ""
// {{{ 743 1 0 "7791d9c4_47c2_48b0_97e139c13973d930" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
HSLExtensions::File::Delete(str_TempSortingFilePath);
// }} ""
// {{ 744 1 0 "6debfd39_1031_454c_89baff5f0d55e7f5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 745 1 0 "6757b6e1_fe0e_48ad_b9283f59b1a69603" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 746 1 0 "eb851f30_c750_406f_bef1624d9396755a" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::FALSE;
// }} ""
// {{ 747 1 0 "56d7646f_2d56_4d56_9c92d0da744d7777" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelSet = 1;
// }} ""
// {{ 748 1 0 "9c42db09_491b_4067_b41f98955d984b5b" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
{
for(int_ChannelIndex = 0; int_ChannelIndex < int_TotalChannels;)
{
int_ChannelIndex = int_ChannelIndex + 1;
// }} ""
// {{ 749 1 0 "9c862401_589b_4405_b6aa9f68e1e964f1" "{67A8F1C9-6546-41e9-AD2F-3C54F7818853}"
int_ChannelActive=arr_ChannelPattern.GetAt(int_ChannelIndex-1);
// }} ""
// {{ 750 1 0 "6e991536_e480_4e2a_b4ee22ec09bcb70e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelActive == 1)
{
// }} ""
// {{{ 751 1 0 "8b960903_20f6_4d75_abc2a4e91ce380b6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_LabID = SeqGetLabwareId(seq_RemainingSequence);
// }} ""
// {{{ 752 1 0 "9da95cf1_dbeb_4bf4_81ade911bff75b94" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_PosID = SeqGetPositionId(seq_RemainingSequence);
// }} ""
// {{{ 753 1 0 "1a6b43ae_0c85_4060_871f2d719dd99036" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqIncrement(seq_RemainingSequence, 1);
// }} ""
// {{{ 754 1 0 "6f2a327a_e380_4f0b_812177b24b090105" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_CurrentX, flt_CurrentY, flt_NotUsed, flt_NotUsed);
// }} ""
// {{ 755 1 0 "b4750ac9_ca16_4df3_ad85f55626fb792d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY <= arr_YMax.ElementAt( int_ChannelIndex -1))
{
// }} ""
// {{ 756 1 0 "494e7ef7_f44b_4a19_be7c02ecd4501b7b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY >= arr_YMin.ElementAt( int_ChannelIndex -1))
{
// }} ""
// {{ 757 1 0 "1b19a1f5_95c9_4527_a7149174ac9c5efe" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_ChannelSet == 1)
{
// }} ""
// {{ 758 1 0 "1c751fe7_dc09_4565_99d76a77153aa80c" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TargetX = flt_CurrentX;
// }} ""
// {{ 759 1 0 "176d1f49_ae6f_4bdf_8525fe1a0c4ad7f1" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_CurrentY;
// }} ""
// {{ 760 1 0 "1d51aa1d_451b_42a3_8f8f357f7e53abff" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelSet = int_ChannelSet + 1;
// }} ""
// {{ 761 1 0 "1b19a1f5_95c9_4527_a7149174ac9c5efe" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 762 1 0 "48afd576_6870_4a33_b08653db21db06e1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentX != flt_TargetX)
{
// }} ""
// {{ 763 1 0 "6ccd1a02_c966_4aae_93933f75323677b6" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 764 1 0 "ba1589bf_bdb9_4985_a22f5035d66cffd0" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 765 1 0 "48afd576_6870_4a33_b08653db21db06e1" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 766 1 0 "b1c46388_b048_403a_a28be1d16786a16a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_CurrentY > flt_PreviousY)
{
// }} ""
// {{ 767 1 0 "18e3c61c_a281_4b48_a56b776f5c7194ee" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 768 1 0 "28f0bd2a_2dd4_4190_ac7d769a5ade3784" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 769 1 0 "b1c46388_b048_403a_a28be1d16786a16a" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 770 1 0 "6ed35aa5_6cb3_4e53_b98506697635de8e" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
int_ChannelSet = int_ChannelSet + 1;
// }} ""
// {{ 771 1 0 "1b19a1f5_95c9_4527_a7149174ac9c5efe" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 772 1 0 "494e7ef7_f44b_4a19_be7c02ecd4501b7b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 773 1 0 "b810b5fe_3e27_4fee_9b3d70ec67b66f31" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 774 1 0 "9872bf4d_0481_43cb_9dfdb95901f695fa" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 775 1 0 "494e7ef7_f44b_4a19_be7c02ecd4501b7b" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 776 1 0 "b4750ac9_ca16_4df3_ad85f55626fb792d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 777 1 0 "f6572189_f56d_45f2_aa6382b1a19a4e63" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_OptimizationNeeded = BOOLEON::TRUE;
// }} ""
// {{ 778 1 0 "b7e04722_0b4f_40e0_8d5b84b19d343cec" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 779 1 0 "b4750ac9_ca16_4df3_ad85f55626fb792d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 780 1 0 "6e991536_e480_4e2a_b4ee22ec09bcb70e" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 781 1 0 "97bd1161_af43_43c9_b24a69f258246851" "{B31F3544-5D80-11d4-A5EB-0050DA737D89}"
flt_PreviousY = flt_PreviousY - flt_YRaster;
// }} ""
// {{ 782 1 0 "9c42db09_491b_4067_b41f98955d984b5b" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 783 1 0 "0482e0c0_7433_4d29_a4f92981bb47ee67" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
seq_RemainingSequence.SetCurrentPosition(1);
// }} ""
// {{ 784 1 0 "6757b6e1_fe0e_48ad_b9283f59b1a69603" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 785 1 0 "fbbe2532_e550_4fde_8264ba76f0d6e650" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_OptimizationNeeded == BOOLEON::TRUE)
{
// }} ""
// {{ 786 1 0 "6ca31729_f13e_41b2_92d511a618dc2caf" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("OPTIMIZE NEEDED!"));
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 787 1 0 "f886175d_69a4_49db_8cb42ec58ebbc954" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequence(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{{ 788 1 0 "83325d82_66fd_4547_9c6db08b914cbd54" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::SortSequenceRaster(ML_STAR, seq_RemainingSequence, BOOLEON::FALSE, flt_YRaster);
// }} ""
// {{ 789 1 0 "859f3e13_f5c4_42f8_a6f1bfae40c14bf6" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Group, int_ChannelIndex, flt_CurrentX, bln_Used;
   file WriteFile;

   WriteFile.RemoveFields();
   WriteFile.AddField("INDEX", int_PositionCount, hslInteger);
   WriteFile.AddField("USED", bln_Used, hslInteger);
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   WriteFile.AddField("Z_COORD", flt_Z_Coord, hslFloat);
   WriteFile.AddField("GROUP",int_Group,hslInteger);

   int_TotalValues = seq_RemainingSequence.GetTotal();

   WriteFile.SetExtendedProperties("HDR=YES");
   WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite);
   
   int_PositionCount = 1;   
   int_Group = 0;
   flt_CurrentX = -100.0;
   for(i = 0; i < int_TotalValues;)
   {
      i = i + 1;
      int_ChannelIndex = int_ChannelIndex + 1;

      seq_RemainingSequence.SetCurrentPosition(i);

      str_LabID = seq_RemainingSequence.GetLabwareId();
      str_PosID = seq_RemainingSequence.GetPositionId();
      DevGetLabwarePositionEx(ML_STAR, str_LabID, str_PosID, flt_X_Coord, flt_Y_Coord, flt_Z_Coord, flt_NotUsed);

      if(flt_CurrentX != flt_X_Coord)
      {
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
         int_ChannelIndex = 1;
      }

      if(int_ChannelIndex > int_TotalChannels)
      {
         int_ChannelIndex = 1;
         flt_CurrentX = flt_X_Coord;
         int_Group = int_Group + 1;
      }
            
      WriteFile.WriteRecord();

      int_PositionCount = int_PositionCount + 1;
   }

   WriteFile.Close();
   WriteFile.RemoveFields();
}
// {{ 791 1 0 "c8f768d4_2c95_4069_b2a1f0ef902350b0" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{ 792 1 0 "8cedafac_d69d_4d17_84bcaff9f102b7b6" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedLabID.SetSize(0);
// }} ""
// {{ 793 1 0 "ac37feb6_febb_460b_8ade1a224961c8c7" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedXCoords.SetSize(0);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 794 1 0 "c3405760_2bd3_4b76_b43baaeea9ea980f" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupNumber.SetSize(0);
// }} ""
// {{ 795 1 0 "9e863f3c_c20d_40dd_a8bdc0f83ea13c8d" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
arr_GroupedCounts.SetSize(0);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, int_Group;
   file SortFile;

SortFile.RemoveFields();

      //str_SQL = "SELECT [GROUP], Y_COORD, COUNT(*) AS N FROM (SELECT * FROM SORT ORDER BY Y_COORD DESC, X_COORD ASC) GROUP BY [GROUP], Y_COORD ORDER BY Y_COORD DESC";
      str_SQL = "SELECT [GROUP], N FROM (SELECT [GROUP], COUNT(*) AS N FROM SORT GROUP BY [GROUP]) ORDER BY [GROUP] ASC";
      //SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
      SortFile.AddField("GROUP", int_Group, hslFloat);
      SortFile.AddField("N", int_Count, hslInteger);

      int_TotalValues = seq_RemainingSequence.GetTotal();

      SortFile.SetExtendedProperties("HDR=YES");
      SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   
      str_LabID = "";
      flt_Y_Coord = 0.0;

      while(SortFile.Eof() == 0)
      {
         SortFile.ReadRecord();
         arr_GroupNumber.AddAsLast(int_Group);
         arr_GroupedCounts.AddAsLast(int_Count);
      }

      SortFile.Close();
      SortFile.RemoveFields();

}
// {{ 797 1 0 "48293e9c_6e04_405a_84309b9738de92d3" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 798 1 0 "a6cfbefc_9ba3_4103_85a07f2d56b3bc63" "{72EACF88-8D49-43e3-92C8-2F90E81E3260}"
int_TotalOptions=arr_GroupedCounts.GetSize();
// }} ""
/* {{ 1 "" "0" */ if(0){  /* }} "" */
// {{{ 799 1 0 "ce0dd410_a196_44cb_9e57d900b9a96d53" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_2(Translate("Counts           Group"), arr_GroupedCounts, arr_GroupNumber);
// }} ""
// {{{ 800 1 0 "8c69dcdb_71fd_4dd7_b7f48089ec2bf416" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
Util2::Debug::TraceArray_3(Translate("Counts     Lab          X"), arr_GroupedCounts, arr_GroupedLabID, arr_GroupedXCoords);
// }} ""
/* {{ 1 "" "1" */ } /* }} "" */
// {{ 801 1 0 "9be4a4c2_bf8b_48ad_8ca5e9a188d7f226" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_UseOptimization, int_Index, str_InValue, flt_XCoord, int_Group, a, int_ChannelCount, int_UpdateCount, int_ChannelIndex;
   variable flt_PreviousY;
   file SortFile, UpdateFile;

   bln_UseOptimization = hslFalse;

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("GROUP", int_Group, hslInteger);

   str_SQL = "SELECT INDEX, LAB_ID, X_COORD, Y_COORD, [GROUP] FROM SORT ORDER BY LAB_ID ASC, Y_COORD DESC, X_COORD ASC";
   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {

      SortFile.ReadRecord();
      //Util::Lookup(arr_GroupedCounts,int_Group,a);
      //Trace("Group:  ", int_Group,"  Count:  ",arr_GroupedCounts.GetAt(int_Group-1),"  Tips needed:  ",int_TipsNeeded);
      if(arr_GroupedCounts.GetAt(int_Group-1) >= int_TipsNeeded)
      {
         int_Group = StrConcat2(int_Group,"");
         bln_UseOptimization = hslTrue;
         break;
      }
   }

   //int_Index = StrConcat2(int_Index,"");   

   SortFile.Close();
   SortFile.RemoveFields();

//Trace("Lab ID:  ",str_LabID,"  X Coord:  ",flt_XCoord);
//Trace("Group:  ",int_Group);
//Trace("Use Optimization:  ",bln_UseOptimization);
if(bln_UseOptimization == hslTrue)
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD, [GROUP] FROM SORT WHERE [GROUP] = " + int_Group + " ORDER BY X_COORD ASC, Y_COORD DESC";

   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);
   SortFile.AddField("GROUP",int_Group, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   i = 0;
   int_ChannelIndex = 1;
   str_InValue = "(";
   flt_PreviousY = 9999.9;
   while(SortFile.Eof() == 0)
   {
      if(i > int_TipsNeeded) break;
      SortFile.ReadRecord();
      if(arr_ChannelPattern.GetAt(int_ChannelIndex-1)==1)
      {
         if(i==0) flt_PreviousY = flt_Y_Coord + flt_YRaster;
         if(flt_Y_Coord <= flt_PreviousY - flt_YRaster)
         {
            i = i + 1;
            if(i > 1) str_InValue = str_InValue + ", ";
            str_InValue = StrConcat2(str_InValue , int_Index);
            int_ChannelIndex = int_ChannelIndex + 1;
         }
      }
      else
      {
         int_ChannelIndex = int_ChannelIndex + 1;
      }
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   UpdateFile.RemoveFields();
   str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;
//Trace(str_SQL);
   UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
   UpdateFile.Close();
   UpdateFile.RemoveFields();
}
else
{
   str_SQL = "SELECT INDEX, LAB_ID, POS_ID, X_COORD, Y_COORD FROM SORT ORDER BY X_COORD ASC, Y_COORD DESC";
   SortFile.RemoveFields();
   SortFile.AddField("INDEX", int_Index, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("X_COORD", flt_X_Coord, hslFloat);
   SortFile.AddField("Y_COORD", flt_Y_Coord, hslFloat);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

      i = 0;
   str_InValue = "(";
   int_ChannelCount = 1;
   int_UpdateCount = 0;
   int_ChannelIndex = 1;
   while(SortFile.Eof() == 0)
   {
      //loop(int_TotalChannels)
      //{
         //if(int_ChannelIndex > int_TotalChannels) break;
         //if(arr_ChannelPattern.GetAt(int_ChannelIndex)==1)
         //{
            //break;
         //}
         //int_ChannelIndex = int_ChannelIndex + 1;
      //}

      if(int_ChannelIndex > int_TotalChannels) break;
      SortFile.ReadRecord();
      i = i + 1;
      if(int_ChannelCount > int_TipsNeeded) break;
      if(flt_Y_Coord <= arr_YMax.GetAt(int_ChannelIndex-1))
      {
         if(flt_Y_Coord >= arr_YMin.GetAt(int_ChannelIndex-1))
         {
            if(int_ChannelCount > 1) str_InValue = str_InValue + ", ";
            str_InValue = StrConcat2(str_InValue , int_Index);
            int_ChannelCount = int_ChannelCount + 1;
            int_UpdateCount = int_UpdateCount + 1;
            int_ChannelIndex = int_ChannelIndex + 1;
         }
      }
   }
   str_InValue = str_InValue + ")";

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_UpdateCount>0)
   {
      UpdateFile.RemoveFields();
      str_SQL = "UPDATE SORT SET USED = 2 WHERE INDEX IN" + str_InValue;

      UpdateFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);
      UpdateFile.Close();
      UpdateFile.RemoveFields();
   }
}

}
// {{ 803 1 0 "3bece2a4_9dd6_4778_bd06c7599f1d3ace" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 804 1 0 "3a977b08_3564_45df_91c33f05457dcb33" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
SeqRemoveAll(io_seq_TipSequence);
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL, bln_Used;
   file SortFile;

   SortFile.RemoveFields();

   str_SQL = "SELECT USED, LAB_ID, POS_ID FROM SORT ORDER BY USED DESC, LAB_ID ASC, X_COORD ASC, Y_COORD DESC";

   SortFile.AddField("USED", bln_Used, hslInteger);
   SortFile.AddField("LAB_ID", str_LabID, hslString, 255);
   SortFile.AddField("POS_ID", str_PosID, hslString, 255);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   while(SortFile.Eof() == 0)
   {
      SortFile.ReadRecord();
      SeqAdd(io_seq_TipSequence, Translate(str_LabID), Translate(str_PosID));
   }

   SortFile.Close();
   SortFile.RemoveFields();
}
// {{ 806 1 0 "5bf28083_bb1c_43d2_b8c0fc216a22e92b" "{B31F353A-5D80-11d4-A5EB-0050DA737D89}"
io_seq_TipSequence.SetCurrentPosition(1);
// }} ""
// {{ 807 1 0 "eaacfa85_3d66_4a6d_b7d870d3bf843ae6" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
bln_EnoughTipsLoaded = BOOLEON::TRUE;
// }} ""
{
   variable int_TotalValues, i,str_LabID,str_PosID,int_CurrentPosition,int_FilledLocation,int_Position,flt_X_Coord,flt_Y_Coord,flt_Z_Coord,flt_NotUsed;
   variable int_PositionCount, int_Count, str_SQL;
   file SortFile;

   SortFile.RemoveFields();

   str_SQL = "SELECT COUNT(*) AS N FROM SORT WHERE USED = 2";

   SortFile.AddField("N", int_Count, hslInteger);

   SortFile.SetExtendedProperties("HDR=YES");
   SortFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead,str_SQL);

   SortFile.ReadRecord();

   SortFile.Close();
   SortFile.RemoveFields();

   if(int_Count < int_TipsNeeded) bln_EnoughTipsLoaded = hslFalse;
}
// {{ 809 1 0 "ef12485d_bb0b_4181_a22816499d498bbc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (bln_EnoughTipsLoaded == BOOLEON::FALSE)
{
// }} ""
// {{ 810 1 0 "039a177b_40cb_4bb3_af57978991eda899" "{F07B0071-8EFC-11d4-A3BA-002035848439}"
MECC::TraceComment(Translate("------------------  Insufficient tips found"));
// }} ""
// {{{ 811 1 0 "1883f8ae_29e5_4db6_8417b79391d42d05" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCapacityCheck(ML_STAR, io_seq_TipSequence, flt_TipCapacity);
// }} ""
// {{ 812 1 0 "294e0dc4_ca45_4c83_ba87d6bcec1be239" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (flt_TipCapacity == 0.0)
{
// }} ""
// {{ 813 1 0 "4e463bb2_7e4d_4b19_a55e4e2d4959d7cc" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
flt_TipCapacity = Translate("Unknown");
// }} ""
// {{ 814 1 0 "294e0dc4_ca45_4c83_ba87d6bcec1be239" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 815 1 0 "fac49442_6e4a_4c6b_8a4a08b46f751654" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipName = StrConcat4(flt_TipCapacity, Translate(" uL Tips"), Translate(""), Translate(""));
// }} ""
// {{{ 816 1 0 "a5111bb6_067d_4858_91184d48301f3d88" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_TipMessage = StrConcat4(Translate("Please load more "), str_TipName, Translate(" on to the deck."), Translate(""));
// }} ""
// {{ 817 1 0 "b6e7b665_c03d_40fc_960a1862f829d164" "{998A7CCC-4374-484D-A6ED-E8A4F0EB71BA}"
customDialogD6E91AF203E543c7804E065769839332.InitCustomDialog( "b6e7b665_c03d_40fc_960a1862f829d164" );
customDialogD6E91AF203E543c7804E065769839332.SetCustomDialogProperty( "textBlock2.Text", str_TipMessage );
customDialogD6E91AF203E543c7804E065769839332.ShowCustomDialog();
// }} ""
// {{{ 818 1 0 "bc501567_2ef5_4b26_914e17dd7bf7efaa" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
ResetInputSequence(ML_STAR, io_seq_TipSequence);
// }} ""
// {{{ 819 1 0 "3468e5af_7036_4391_b63abae4629966d2" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
TipCounter_Edit(ML_STAR, io_seq_TipSequence, i_str_TipCounter, 99999);
// }} ""
// {{ 820 1 0 "ef12485d_bb0b_4181_a22816499d498bbc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 821 1 0 "ad529414_3513_43ce_9c83ac1ef00a14d2" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 822 1 0 "ef12485d_bb0b_4181_a22816499d498bbc" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 823 1 0 "859f3e13_f5c4_42f8_a6f1bfae40c14bf6" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 824 1 0 "fbbe2532_e550_4fde_8264ba76f0d6e650" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 825 1 0 "f16907cf_2348_4f67_ba32b1ead8fef794" "{B31F3533-5D80-11d4-A5EB-0050DA737D89}"
break;
// }} ""
// {{ 826 1 0 "fbbe2532_e550_4fde_8264ba76f0d6e650" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{ 827 1 0 "29fa761c_e3d9_468d_9c101062787f26a8" "{B31F3532-5D80-11d4-A5EB-0050DA737D89}"
}
}
// }} ""
// {{ 828 1 0 "19000815_ff51_4949_bda38d8c1eb83ef3" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 829 1 0 "f86f5175_4abf_4e88_bb4fa99ba8c49986" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 830 1 0 "19000815_ff51_4949_bda38d8c1eb83ef3" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "Optimized5mLTipPickup2" "End"
}
// }} ""
// {{{ 5 "TipCountNeeded_Reset" "Begin"
function TipCountNeeded_Reset( variable i_str_TipCounter ) void {
// }} ""
private variable int_Index;
// {{ 5 "TipCountNeeded_Reset" "InitLocals"
// }} ""
// {{ 1026 1 0 "634bac04_5879_48d9_b4394193206ce30d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (TT_GLOBAL_VARIABLES::TIP_COUNT::LIBRARY_INITIALIZED == BOOLEON::FALSE)
{
// }} ""
// {{{ 1027 1 0 "41edd52c_27de_4d5f_b2bee2989d6267f8" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TT_GLOBAL_VARIABLES::TIP_COUNT::InitializeVariables();
// }} ""
// {{ 1028 1 0 "080fd8d0_2090_4b46_b4b411c33a291e77" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.SetSize(0);
// }} ""
// {{ 1029 1 0 "6dd37ae8_3441_4a1a_a2de464247c25641" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER.SetSize(0);
// }} ""
// {{ 1030 1 0 "9a63a05f_3e00_4cd3_b55c6d9a5957ea84" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
TT_GLOBAL_VARIABLES::TIP_COUNT::LIBRARY_INITIALIZED = BOOLEON::TRUE;
// }} ""
// {{ 1031 1 0 "634bac04_5879_48d9_b4394193206ce30d" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1032 1 0 "4a4f7bbf_b9ef_4890_b5116d7d8ae6c1ce" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
int_Index = _Lookup(TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER, i_str_TipCounter);
// }} ""
// {{ 1033 1 0 "1cc3be18_65d7_427a_9345d0fb5437bdef" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (int_Index == 0)
{
// }} ""
// {{ 1034 1 0 "e48a9c97_4254_457f_be01cc0c85bc67f5" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 1035 1 0 "e5b80bf9_2d66_44e7_b2c8876480f77397" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNTER.AddAsLast(i_str_TipCounter);
// }} ""
// {{ 1036 1 0 "bfa86bc1_e72b_48a1_a8043e23a80f8964" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.AddAsLast(0);
// }} ""
// {{ 1037 1 0 "1cc3be18_65d7_427a_9345d0fb5437bdef" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
else
{
// }} ""
// {{ 1038 1 0 "cac50ff8_9da4_43aa_b796636119ff8ced" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{ 1039 1 0 "f6a5f903_43ac_4982_aa6494e01709c561" "{F17B7626-27CB-47f1-8477-8C4158339A6D}"
TT_GLOBAL_VARIABLES::TIP_COUNT::TIP_COUNT_NEEDED.SetAt(int_Index-1, 0);
// }} ""
// {{ 1040 1 0 "1cc3be18_65d7_427a_9345d0fb5437bdef" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 5 "TipCountNeeded_Reset" "End"
}
// }} ""
// {{{ 5 "ABSTRACT" "Begin"
private function ABSTRACT(  ) void {
// }} ""
// {{ 5 "ABSTRACT" "InitLocals"
// }} ""
// {{ 1 1 0 "57867926_0890_4408_8f082f9db5647dc1" "{F07B0071-8EFC-11d4-A3BA-002035848439}"

// }} ""
// {{{ 5 "ABSTRACT" "End"
}
// }} ""
// {{{ 5 "_GetSequenceName" "Begin"
private function _GetSequenceName( device & Instrument, sequence i_seq_SequenceToCheck, variable & o_strSequenceName, variable & o_intTotalPositions ) void {
// }} ""
// {{ 5 "_GetSequenceName" "InitLocals"
o_strSequenceName = 0;
o_intTotalPositions = 0;
// }} ""
// {{ 1460 1 0 "28fc9610_cc2c_42d7_bbd6ab2dad5fb555" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_intTotalPositions = 0;
// }} ""
// {{ 1461 1 0 "efa23306_d3c8_4d16_ad333351b08821e5" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_strSequenceName = 0;
// }} ""
{
   Instrument.CopyResetSequence(i_seq_SequenceToCheck.GetName(),i_seq_SequenceToCheck);
   o_strSequenceName = i_seq_SequenceToCheck.GetName();
   o_intTotalPositions = i_seq_SequenceToCheck.GetCount();
}
// {{{ 5 "_GetSequenceName" "End"
}
// }} ""
// {{{ 5 "GetTipCounter" "Begin"
function GetTipCounter( device & ML_STAR, sequence & io_seqTips, variable & o_strTipCounter ) void {
// }} ""
private variable l_strSequenceName;
private variable l_intTotalPositions;
private variable l_blnLiquidClassExists;
private variable _strFunctionName;
private variable l_intTipType;
private variable l_strInstrumentClass;
private variable l_arrListOfTipCounters[];
private variable l_strLabID;
// {{ 5 "GetTipCounter" "InitLocals"
o_strTipCounter = 0;
// }} ""
// {{ 340 1 0 "844ae7d3_ea89_4e60_acedc07ec3a79f82" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 341 1 0 "677eb5d4_158d_4704_9f58a9f6200b794d" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
_strFunctionName = Translate("");
// }} ""
_strFunctionName = GetFunctionName();
// {{{ 343 1 0 "7fe9af90_02e2_4ba5_b13d088fae177014" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::TRUE, BOOLEON::TRUE);
// }} ""
// {{ 344 1 0 "844ae7d3_ea89_4e60_acedc07ec3a79f82" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{ 345 1 0 "2c77ad10_79a5_4efd_a767213def5b1150" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_strTipCounter = Translate("");
// }} ""
// {{ 346 1 0 "f893709d_45d9_4a19_bf7b9c675b5f24e6" "{4900C1F7-0FB7-4033-8253-760BDB9354DC}"
l_arrListOfTipCounters.SetSize(0);
// }} ""
// {{{ 347 1 0 "6496c8c1_cfd3_4560_96a190fa02b4b336" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TIP_COUNTER::InitTipCountingLibrary();
// }} ""
// {{{ 348 1 0 "cd174bd2_acf6_4846_80f6fb30766270be" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetSequenceName(ML_STAR, io_seqTips, l_strSequenceName, l_intTotalPositions);
// }} ""
// {{ 349 1 0 "fc60b013_6647_4b7b_8d12ae96a4d65ae7" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_strTipCounter = l_strSequenceName;
// }} ""
// {{{ 350 1 0 "09a5c948_509c_46d5_a279cc9752bb88f6" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE08(Translate("     Sequence:  "), l_strSequenceName, Translate(""), Translate(""), Translate(""), Translate(""), Translate(""), Translate(""));
// }} ""
// {{{ 351 1 0 "a1d7d518_ddb8_4e9d_959f3016af083086" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strLabID = SeqGetLabwareId(io_seqTips);
// }} ""
// {{{ 352 1 0 "117c8f21_1919_4338_af6b7635c05c3032" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
_GetTipType(ML_STAR, l_strLabID, l_intTipType);
// }} ""
// {{{ 353 1 0 "79a58f67_177a_48b8_aae60cbdad2b79cb" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strInstrumentClass = DevGetInstrumentName(ML_STAR);
// }} ""
// {{{ 354 1 0 "f0db91b4_0b03_48f7_be002c776154f550" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
l_blnLiquidClassExists = _GetTipCounterName(l_strInstrumentClass, l_intTipType, o_strTipCounter);
// }} ""
// {{ 355 1 0 "8e14cfb5_100a_435e_a174296cd17fc585" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_blnLiquidClassExists == BOOLEON::FALSE)
{
// }} ""
// {{ 356 1 0 "725e5ebe_27b1_4695_bd08ce57b8f55949" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_strTipCounter = l_strSequenceName;
// }} ""
// {{ 357 1 0 "8e14cfb5_100a_435e_a174296cd17fc585" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 358 1 0 "a3fd4db0_a250_44b2_9e968937463af8c5" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE04(Translate("     "), Translate("Selected Tip Counter:  "), o_strTipCounter, Translate(""));
// }} ""
// {{ 359 1 0 "cbdd7c3b_8f61_48c8_b210e8414b19459c" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 360 1 0 "f871da57_1051_42ed_8c2664e1d5741e6c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::SUBMETHOD_BLOCK(_strFunctionName, BOOLEON::FALSE, BOOLEON::TRUE);
// }} ""
// {{ 361 1 0 "cbdd7c3b_8f61_48c8_b210e8414b19459c" "{586C3429-F931-405f-9938-928E22C90BFA}"

// }} ""
// {{{ 5 "GetTipCounter" "End"
}
// }} ""
// {{{ 5 "_GetTipCounterName" "Begin"
private function _GetTipCounterName( variable i_strInstrumentClass, variable i_intTipType, variable & o_strTipCounterName ) variable {
// }} ""
private variable l_strModified;
private variable l_intID;
private variable l_intNum;
private variable l_strLabwareType;
private variable l_strSystemFolder;
private variable l_strName;
private variable l_strSQL;
private variable l_strTipCounterDatabase;
private variable l_strSimulationModified;
private variable l_strInstrumentClass;
private file l_hdlFile;
// {{ 5 "_GetTipCounterName" "InitLocals"
o_strTipCounterName = 0;
// }} ""
// {{ 1487 1 0 "0858a27e_1423_4e2a_88b209f48af7f5fe" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_strTipCounterName = Translate("");
// }} ""
// {{{ 1488 1 0 "29336ebd_c831_426d_8445e5a9ac21224c" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strSystemFolder = FilGetSystemPath();
// }} ""
// {{{ 1489 1 0 "a401704e_f4ca_4323_bf38a9f0c0726713" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strTipCounterDatabase = StrConcat4(l_strSystemFolder, Translate("\\"), Translate("HxElementCounter"), Translate(".mdb"));
// }} ""
// {{{ 1490 1 0 "f773270a_02c8_419f_87a50e9a85b68e27" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strSQL = StrConcat8(Translate("SELECT COUNT(*) AS N FROM [ElementCounters] WHERE [InstrumentClass]= '"), i_strInstrumentClass, Translate("' AND [LabwareType] = '"), i_intTipType, Translate("'"), Translate(""), Translate(""), Translate(""));
// }} ""
// {{{ 1491 1 0 "2fc6b5fd_7947_4ad6_8b5334078bd2b0a0" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
TRACE::TRACE02(Translate("Database:  "), l_strTipCounterDatabase);
// }} ""
// {{ 1492 1 0 "e0f23421_6132_412d_991b47a4f5659095" "{B31F3534-5D80-11d4-A5EB-0050DA737D89}"
l_hdlFile.AddField("N", l_intNum, hslInteger);
if( 0 == l_hdlFile.Open(l_strTipCounterDatabase + " " + "ElementCounters", hslRead, l_strSQL) )
{
    MECC::RaiseRuntimeErrorEx(-1523711743, MECC::IDS::stepNameFileOpen, MECC::IDS::errorStepFileOpenFailed, l_strTipCounterDatabase, "HxMetEdCompCmd");
}
// }} ""
// {{ 1493 1 0 "bc92d284_bd18_4f37_a054c84e02c3d1e5" "{B31F3536-5D80-11d4-A5EB-0050DA737D89}"
if( 0 == l_hdlFile.ReadRecord() )
{
    MECC::RaiseRuntimeErrorEx(-1490157312, MECC::IDS::stepNameFileRead, MECC::IDS::errorStepFailed, "", "HxMetEdCompCmd");
}
// }} ""
// {{ 1494 1 0 "207055c2_0c18_4864_a9a4a31993940ff2" "{B31F3538-5D80-11d4-A5EB-0050DA737D89}"
if( 0 != l_hdlFile.Close() )
{
    MECC::RaiseRuntimeErrorEx(-1456602880, MECC::IDS::stepNameFileClose, MECC::IDS::errorStepFailed, "", "HxMetEdCompCmd");
}
l_hdlFile.RemoveFields();
// }} ""
// {{ 1495 1 0 "0e984316_c27f_4765_9eeafd0085f855f5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
if (l_intNum == 0)
{
// }} ""
// {{{ 1496 1 0 "3124b0d6_6232_4ca0_9d1304bfac90bec9" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (BOOLEON::FALSE);
// }} ""
// {{ 1497 1 0 "0e984316_c27f_4765_9eeafd0085f855f5" "{B31F3531-5D80-11d4-A5EB-0050DA737D89}"
}
// }} ""
// {{{ 1498 1 0 "7a9a2385_1f12_41fd_b3fcb548dc13093f" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
l_strSQL = StrConcat8(Translate("SELECT * FROM [ElementCounters] WHERE [InstrumentClass]= '"), i_strInstrumentClass, Translate("' AND [LabwareType] = '"), i_intTipType, Translate("' ORDER BY [ID] ASC"), Translate(""), Translate(""), Translate(""));
// }} ""
// {{ 1499 1 0 "3862bb82_6403_4ab3_972b5aee340931c2" "{B31F3534-5D80-11d4-A5EB-0050DA737D89}"
l_hdlFile.AddField("ID", l_intID, hslInteger);
l_hdlFile.AddField("Name", l_strName, hslString, 255);
l_hdlFile.AddField("InstrumentClass", l_strInstrumentClass, hslString, 50);
l_hdlFile.AddField("LabwareType", l_strLabwareType, hslString, 50);
l_hdlFile.AddField("Modified", l_strModified, hslInteger);
l_hdlFile.AddField("SimulationModified", l_strSimulationModified, hslInteger);
if( 0 == l_hdlFile.Open(l_strTipCounterDatabase + " " + "ElementCounters", hslRead, l_strSQL) )
{
    MECC::RaiseRuntimeErrorEx(-1523711743, MECC::IDS::stepNameFileOpen, MECC::IDS::errorStepFileOpenFailed, l_strTipCounterDatabase, "HxMetEdCompCmd");
}
// }} ""
// {{ 1500 1 0 "97e743ac_4563_46e7_872bd1f697e249c2" "{B31F3536-5D80-11d4-A5EB-0050DA737D89}"
if( 0 == l_hdlFile.ReadRecord() )
{
    MECC::RaiseRuntimeErrorEx(-1490157312, MECC::IDS::stepNameFileRead, MECC::IDS::errorStepFailed, "", "HxMetEdCompCmd");
}
// }} ""
// {{ 1501 1 0 "a74d3212_5bf6_433d_9c0e48679f083b89" "{B31F3538-5D80-11d4-A5EB-0050DA737D89}"
if( 0 != l_hdlFile.Close() )
{
    MECC::RaiseRuntimeErrorEx(-1456602880, MECC::IDS::stepNameFileClose, MECC::IDS::errorStepFailed, "", "HxMetEdCompCmd");
}
l_hdlFile.RemoveFields();
// }} ""
// {{ 1502 1 0 "7ff846f6_bbcb_4248_b1f2d168e850ece2" "{B31F3543-5D80-11d4-A5EB-0050DA737D89}"
o_strTipCounterName = l_strName;
// }} ""
// {{{ 1503 1 0 "4811a841_5e0e_4117_ac13fe2766115adb" "{9EC997CD-FD3B-4280-811B-49E99DCF062C}"
return (BOOLEON::TRUE);
// }} ""
// {{{ 5 "_GetTipCounterName" "End"
}
// }} ""
// {{{ 5 "_SortSequenceLabIDXY" "Begin"
private function _SortSequenceLabIDXY( device & Instrument, sequence & io_Sequence ) void {
// }} ""
private variable str_TempSortingFilePath;
private variable str_SQL_Sort;
// {{ 5 "_SortSequenceLabIDXY" "InitLocals"
// }} ""
// {{{ 1568 1 0 "8abd8950_d2f1_4e16_b70ee979a90dbb33" "{7C4EF7A7-39BE-406a-897F-71F3A35B4093}"
HELPERLIBRARY::GetTempSortingFilePath(str_TempSortingFilePath);
// }} ""
// {{{ 1569 1 0 "7e15759e_80c0_4634_b4e2d2946f5d5f30" "{C1F3C015-47B3-4514-9407-AC2E65043419}"
str_SQL_Sort = StrConcat4(Translate("SELECT * FROM SORT ORDER BY LAB_ID ASC, X_COORD ASC, Y_COORD DESC"), Translate(""), Translate(""), Translate(""));
// }} ""
{
   variable int_CurrentPosition;
   variable int_TotalSequencePositions;
   sequence seq_AdjustedSequence;
   variable i;

   file WriteFile;
   file ReadFile;
   variable str_LabID;
   variable str_PosID;
   variable flt_X;
   variable flt_Y;
   variable arr_Coordinates[];

   int_CurrentPosition = io_Sequence.GetCurrentPosition();

   seq_AdjustedSequence.CopySequence(io_Sequence);

   int_TotalSequencePositions = io_Sequence.GetTotal();

   SeqRemoveAll(io_Sequence);

   WriteFile.RemoveFields();
   WriteFile.AddField("LAB_ID", str_LabID, hslString, 255);
   WriteFile.AddField("POS_ID", str_PosID, hslString, 255);
   WriteFile.AddField("X_COORD", flt_X, hslFloat);
   WriteFile.AddField("Y_COORD", flt_Y, hslFloat);

   if(WriteFile.Open(str_TempSortingFilePath + " " + "SORT", hslWrite))
   {

      for(i = int_CurrentPosition; i <= int_TotalSequencePositions;)
      {
         if(int_CurrentPosition == 0) break;
         seq_AdjustedSequence.SetCurrentPosition(i);

         if(seq_AdjustedSequence.GetLabwareId() != "" && seq_AdjustedSequence.GetPositionId() != "") 
         {
            str_LabID = seq_AdjustedSequence.GetLabwareId();
            str_PosID = seq_AdjustedSequence.GetPositionId();
            Instrument.GetLabwarePosition(str_LabID, arr_Coordinates, str_PosID);
            flt_X = arr_Coordinates[0];
            flt_Y = arr_Coordinates[1];

            WriteFile.WriteRecord();
         }

         i = i + 1;
      }

   }

   WriteFile.Close();
   WriteFile.RemoveFields();

   ReadFile.RemoveFields();
   ReadFile.AddField("LAB_ID", str_LabID, hslString, 255);
   ReadFile.AddField("POS_ID", str_PosID, hslString, 255);
   ReadFile.AddField("X_COORD", flt_X, hslFloat);
   ReadFile.AddField("Y_COORD", flt_Y, hslFloat);

   if(ReadFile.Open(str_TempSortingFilePath + " " + "SORT", hslRead, str_SQL_Sort))
   {
      while(ReadFile.Eof() == 0)
      {
         ReadFile.ReadRecord();
         io_Sequence.Add(str_LabID,str_PosID);
      }
   }

   else
   {
      Trace("ERROR OCCURRED DURING SORT");
      io_Sequence.CopySequence(seq_AdjustedSequence);
   }

   ReadFile.Close();
   ReadFile.RemoveFields();

   io_Sequence.SetCurrentPosition(1);
}
// {{{ 5 "_SortSequenceLabIDXY" "End"
}
// }} ""
/* {{ 2 "SubmethodInsertLine" "" */ // }} ""
// {{{ 2 "LibraryNamespace" "End"
} // library namespace
// }} ""
// $$author=Bare_B$$valid=0$$time=2022-04-21 14:36$$checksum=d5e9c462$$length=083$$